"use strict";var ne=Object.create;var B=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var pe=(e,r)=>{for(var o in r)B(e,o,{get:r[o],enumerable:!0})},z=(e,r,o,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of se(r))!le.call(e,t)&&t!==o&&B(e,t,{get:()=>r[t],enumerable:!(n=ue(r,t))||n.enumerable});return e};var Q=(e,r,o)=>(o=e!=null?ne(de(e)):{},z(r||!e||!e.__esModule?B(o,"default",{value:e,enumerable:!0}):o,e)),ae=e=>z(B({},"__esModule",{value:!0}),e);var be={};pe(be,{InlineCombinatorDnD:()=>N,QueryBuilderDnD:()=>ye,QueryBuilderDndWithoutProvider:()=>oe,RuleDnD:()=>_,RuleGroupDnD:()=>V,useInlineCombinatorDnD:()=>L,useReactDnD:()=>M,useRuleDnD:()=>W,useRuleGroupDnD:()=>w});module.exports=ae(be);var F=Q(require("react")),Y=require("react"),T=require("react-querybuilder");var J=require("react"),b=require("react-querybuilder"),L=({path:e,canDrop:r,schema:o,useDrop:n,rules:t})=>{let l=(0,J.useRef)(null),s=(t??[])[e[e.length-1]-1],[{isOver:a,dropMonitorId:u},D]=n(()=>({accept:["rule","ruleGroup"],canDrop:d=>{let{path:p}=d;if(d&&typeof r=="function"&&!r({dragging:d,hovering:{...s,path:e,qbId:o.qbId}}))return!1;let m=(0,b.getParentPath)(e),R=(0,b.getParentPath)(p),h=e[e.length-1],x=p[p.length-1];return!((0,b.isAncestor)(p,e)||(0,b.pathsAreEqual)(p,e)||(0,b.pathsAreEqual)(m,R)&&h-1===x||o.independentCombinators&&(0,b.pathsAreEqual)(m,R)&&h===x-1)},collect:d=>({isOver:d.canDrop()&&d.isOver(),dropMonitorId:d.getHandlerId()??"",dropEffect:(d.getDropResult()??{}).dropEffect}),drop:()=>{let{qbId:d,getQuery:p,dispatchQuery:m}=o;return{type:"inlineCombinator",path:e,qbId:d,getQuery:p,dispatchQuery:m}}}),[e,o.independentCombinators]);return D(l),{dropRef:l,dropMonitorId:u,isOver:a}};var G=require("react"),Pe=require("react-querybuilder");var M=e=>{let[r,o]=(0,G.useState)(e??null);return(0,G.useEffect)(()=>{let n=!1;return r||(async()=>{let[l,s]=await Promise.all([import("react-dnd").catch(()=>null),import("react-dnd-html5-backend").catch(()=>null)]);n||l&&s&&o(()=>({...l,...s}))})(),()=>{n=!0}},[r]),r};var S=require("react"),v=require("react-querybuilder");var E=require("react-querybuilder"),A=({type:e,path:r,disabled:o,actions:n,schema:t,useDrag:l})=>l(()=>({type:e,item:()=>({...(0,E.findPath)(r,t.getQuery()),path:r,qbId:t.qbId}),canDrag:!o,collect:s=>({isDragging:!o&&s.isDragging(),dragMonitorId:s.getHandlerId()??""}),end:(s,a)=>{let u=a.getDropResult();if(!u)return;let D=(0,E.getParentPath)(u.path),d=u.path[u.path.length-1],p=u.type==="ruleGroup"?[...u.path,0]:u.type==="inlineCombinator"?[...D,d]:[...D,d+1];if(t.qbId!==u.qbId){let m=u.getQuery();m&&(u.dispatchQuery((0,E.insert)(m,s,p)),u.dropEffect!=="copy"&&n.onRuleRemove(s.path))}else n.moveRule(s.path,p,u.dropEffect==="copy")}}),[o,r]);var ie=["rule","ruleGroup"],W=e=>{let{path:r,rule:o,disabled:n,schema:t,actions:l,useDrag:s,useDrop:a,canDrop:u}=e,D=(0,S.useRef)(null),d=(0,S.useRef)(null),[{isDragging:p,dragMonitorId:m},R,h]=A({type:"rule",path:r,disabled:n,independentCombinators:t.independentCombinators,moveRule:l.moveRule,schema:t,actions:l,useDrag:s}),[{isOver:x,dropMonitorId:U,dropEffect:H},O]=a(()=>({accept:ie,canDrop:c=>{if(c&&typeof u=="function"&&!u({dragging:c,hovering:{...o,path:r,qbId:t.qbId}}))return!1;if(t.qbId!==c.qbId)return!0;let i=(0,v.getParentPath)(r),P=(0,v.getParentPath)(c.path),g=r[r.length-1],q=c.path[c.path.length-1];return!((0,v.isAncestor)(c.path,r)||(0,v.pathsAreEqual)(i,P)&&(g===q||g===q-1||t.independentCombinators&&g===q-2))},collect:c=>({isOver:c.canDrop()&&c.isOver(),dropMonitorId:c.getHandlerId()??"",dropEffect:(c.getDropResult()??{}).dropEffect}),drop:()=>{let{qbId:c,getQuery:i,dispatchQuery:P}=t;return{type:"rule",path:r,qbId:c,getQuery:i,dispatchQuery:P}}}),[n,t.independentCombinators,l.moveRule,r]);return R(d),h(O(D)),{isDragging:p,dragMonitorId:m,isOver:x,dropMonitorId:U,dndRef:D,dragRef:d,dropEffect:H}};var k=require("react"),I=require("react-querybuilder");var De=["rule","ruleGroup"],w=e=>{let{disabled:r,path:o,ruleGroup:n,schema:t,actions:l,useDrag:s,useDrop:a,canDrop:u}=e,D=(0,k.useRef)(null),d=(0,k.useRef)(null),p=(0,k.useRef)(null),[{isDragging:m,dragMonitorId:R},h,x]=A({type:"ruleGroup",path:o,disabled:r,independentCombinators:t.independentCombinators,moveRule:l.moveRule,schema:t,actions:l,useDrag:s}),[{isOver:U,dropMonitorId:H,dropEffect:O},c]=a(()=>({accept:De,canDrop:i=>{if(r||i&&typeof u=="function"&&!u({dragging:i,hovering:{...n,path:o,qbId:t.qbId}}))return!1;if(t.qbId!==i.qbId)return!0;let P=(0,I.getParentPath)(i.path),g=i.path[i.path.length-1];return!((0,I.isAncestor)(i.path,o)||(0,I.pathsAreEqual)(o,P)&&g===0||(0,I.pathsAreEqual)(o,i.path))},collect:i=>({isOver:i.canDrop()&&i.isOver(),dropMonitorId:i.getHandlerId()??"",dropEffect:(i.getDropResult()??{}).dropEffect}),drop:(i,P)=>{let{qbId:g,getQuery:q,dispatchQuery:te}=t;return P.getDropResult()??{type:"ruleGroup",path:o,qbId:g,getQuery:q,dispatchQuery:te}}}),[r,l.moveRule,o]);return o.length>0&&(h(d),x(D)),c(p),{isDragging:m,dragMonitorId:R,isOver:U,dropMonitorId:H,previewRef:D,dragRef:d,dropRef:p,dropEffect:O}};var K=require("react"),X=require("react-querybuilder"),{rule:ce,ruleGroup:me,combinatorSelector:fe}=X.defaultControlElements,y=(0,K.createContext)({baseControls:{rule:ce,ruleGroup:me,combinatorSelector:fe}});var N=({component:e,...r})=>{let{canDrop:o,useDrop:n}=(0,Y.useContext)(y),{dropRef:t,dropMonitorId:l,isOver:s}=L({...r,component:e,useDrop:n,canDrop:o}),a=s?T.standardClassnames.dndOver:"",u=`${T.standardClassnames.betweenRules}${a?` ${a}`:""}`;return F.createElement("div",{key:"dnd",ref:t,className:u,"data-dropmonitorid":l,"data-testid":T.TestID.inlineCombinator},F.createElement(e,{...r,testID:T.TestID.combinators}))};var C=Q(require("react")),j=require("react"),f=require("react-querybuilder");var $=Q(require("react")),Z=require("react");var _=e=>{let r=(0,Z.useContext)(y),{canDrop:o,useDrag:n,useDrop:t}=r,l=!!e.parentDisabled||!!e.disabled,s=W({...e,disabled:l,useDrag:n,useDrop:t,canDrop:o}),{rule:a}=r.baseControls;return $.createElement(y.Provider,{value:r},$.createElement(a,{...e,...s}))};var ee=Q(require("react")),re=require("react");var V=e=>{let r=(0,re.useContext)(y),{canDrop:o,useDrag:n,useDrop:t}=r,l=!!e.parentDisabled||!!e.disabled,s=w({...e,disabled:l,useDrag:n,useDrop:t,canDrop:o}),{ruleGroup:a}=r.baseControls;return ee.createElement(a,{...e,...s})};var ye=e=>{let{controlClassnames:r,controlElements:o,debugMode:n,enableDragAndDrop:t,enableMountQueryChange:l,translations:s,canDrop:a}=e,u=(0,f.useMergedContext)({controlClassnames:r,controlElements:o,debugMode:n,enableDragAndDrop:t??!0,enableMountQueryChange:l,translations:s??{}}),{enableDragAndDrop:D}=u,d=M(e.dnd),p=D&&d?"dnd":"no-dnd";if(!D||!d)return C.createElement(f.QueryBuilderContext.Provider,{key:p,value:{...u,enableDragAndDrop:!1,debugMode:n}},e.children);let{DndProvider:m,HTML5Backend:R}=d;return C.createElement(m,{key:p,backend:R,debugMode:n},C.createElement(f.QueryBuilderContext.Provider,{key:p,value:{...u,enableDragAndDrop:D,debugMode:n}},C.createElement(oe,{dnd:d,canDrop:a},e.children)))},oe=e=>{let r=(0,j.useContext)(f.QueryBuilderContext),o=(0,j.useContext)(y),n=M(e.dnd),t=(0,f.usePreferProp)(!1,e.debugMode,r.debugMode),l=(0,f.usePreferAnyProp)(void 0,e.canDrop,o.canDrop),s=(0,f.usePreferProp)(!0,e.enableDragAndDrop,r.enableDragAndDrop),a=s&&n?"dnd":"no-dnd";if(!s||!n)return C.createElement(f.QueryBuilderContext.Provider,{key:a,value:{...r,enableDragAndDrop:!1,debugMode:t}},e.children);let{DndContext:u,useDrag:D,useDrop:d}=n,p={rule:e.controlElements?.rule??r.controlElements?.rule??o.baseControls.rule,ruleGroup:e.controlElements?.ruleGroup??r.controlElements?.ruleGroup??o.baseControls.ruleGroup,combinatorSelector:e.controlElements?.combinatorSelector??r.controlElements?.combinatorSelector??o.baseControls.combinatorSelector},m={...r,controlElements:{...r.controlElements,ruleGroup:V,rule:_,inlineCombinator:N}};return C.createElement(u.Consumer,{key:a},()=>C.createElement(f.QueryBuilderContext.Provider,{key:a,value:m},C.createElement(y.Provider,{value:{useDrag:D,useDrop:d,baseControls:p,canDrop:l}},e.children)))};0&&(module.exports={InlineCombinatorDnD,QueryBuilderDnD,QueryBuilderDndWithoutProvider,RuleDnD,RuleGroupDnD,useInlineCombinatorDnD,useReactDnD,useRuleDnD,useRuleGroupDnD});
//# sourceMappingURL=react-querybuilder_dnd.cjs.production.js.map