"use strict";var vr=Object.create;var eo=Object.defineProperty;var Cr=Object.getOwnPropertyDescriptor;var $r=Object.getOwnPropertyNames;var Tr=Object.getPrototypeOf,Sr=Object.prototype.hasOwnProperty;var Nr=(e,t)=>{for(var o in t)eo(e,o,{get:t[o],enumerable:!0})},vn=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of $r(t))!Sr.call(e,r)&&r!==o&&eo(e,r,{get:()=>t[r],enumerable:!(n=Cr(t,r))||n.enumerable});return e};var Oe=(e,t,o)=>(o=e!=null?vr(Tr(e)):{},vn(t||!e||!e.__esModule?eo(o,"default",{value:e,enumerable:!0}):o,e)),Er=e=>vn(eo({},"__esModule",{value:!0}),e);var Ol={};Nr(Ol,{ActionElement:()=>Be,DragHandle:()=>Go,InlineCombinator:()=>$o,LogType:()=>xe,NotToggle:()=>So,QueryBuilder:()=>cr,QueryBuilderContext:()=>tt,QueryBuilderStateContext:()=>nt,QueryBuilderStateProvider:()=>ur,Rule:()=>mn,RuleComponents:()=>pr,RuleGroup:()=>fn,RuleGroupBodyComponents:()=>fr,RuleGroupHeaderComponents:()=>mr,ShiftActions:()=>yn,TestID:()=>Q,ValueEditor:()=>hn,ValueSelector:()=>ft,add:()=>mo,convertFromIC:()=>st,convertQuery:()=>kr,convertToIC:()=>wo,default:()=>cr,defaultCELValueProcessor:()=>Kr,defaultCombinators:()=>Ue,defaultCombinatorsExtended:()=>Fr,defaultControlClassnames:()=>vo,defaultControlElements:()=>nn,defaultJoinChar:()=>Nt,defaultMongoDBValueProcessor:()=>zr,defaultOperatorNegationMap:()=>Pr,defaultOperators:()=>Oo,defaultPlaceholderFieldGroupLabel:()=>En,defaultPlaceholderFieldLabel:()=>Nn,defaultPlaceholderFieldName:()=>Tt,defaultPlaceholderOperatorGroupLabel:()=>Fn,defaultPlaceholderOperatorLabel:()=>Pn,defaultPlaceholderOperatorName:()=>St,defaultRuleProcessorCEL:()=>it,defaultRuleProcessorElasticSearch:()=>It,defaultRuleProcessorJSONata:()=>Vt,defaultRuleProcessorJsonLogic:()=>qt,defaultRuleProcessorMongoDB:()=>ut,defaultRuleProcessorParameterized:()=>Gt,defaultRuleProcessorSQL:()=>co,defaultRuleProcessorSpEL:()=>pt,defaultSpELValueProcessor:()=>Xr,defaultTranslations:()=>Ao,defaultValidator:()=>Qr,defaultValueProcessor:()=>Jr,defaultValueProcessorByRule:()=>He,defaultValueProcessorCELByRule:()=>Yr,defaultValueProcessorMongoDBByRule:()=>Zr,defaultValueProcessorSpELByRule:()=>el,filterFieldsByComparator:()=>wt,findPath:()=>Re,formatQuery:()=>_r,generateAccessibleDescription:()=>Uo,generateID:()=>ge,getCommonAncestorPath:()=>jo,getCompatContextProvider:()=>rl,getFirstOption:()=>he,getOption:()=>ve,getParentPath:()=>re,getQuerySelectorById:()=>Ye,getValidationClassNames:()=>_t,getValueSourcesUtil:()=>Ho,groupInvalidReasons:()=>Et,isAncestor:()=>tl,isFlexibleOptionGroupArray:()=>Ne,isFullOptionGroupArray:()=>Lr,isOptionGroupArray:()=>Dt,isPojo:()=>ne,isRuleGroup:()=>D,isRuleGroupType:()=>J,isRuleGroupTypeIC:()=>ze,isRuleOrGroupValid:()=>ye,isValidationResult:()=>Wo,joinWith:()=>lt,jsonLogicAdditionalOperators:()=>Jn,mergeClassnames:()=>Wt,mergeTranslations:()=>Ut,messages:()=>_e,move:()=>Zo,nullFreeArray:()=>Ir,numericRegex:()=>Do,objectEntries:()=>ol,objectKeys:()=>jt,parseNumber:()=>H,pathIsDisabled:()=>dt,pathsAreEqual:()=>Qe,prepareRule:()=>zo,prepareRuleGroup:()=>Ht,prepareRuleOrGroup:()=>Ko,queryBuilderStore:()=>No,regenerateID:()=>Jt,regenerateIDs:()=>zt,remove:()=>Yo,rootPath:()=>ir,splitBy:()=>Ln,standardClassnames:()=>w,toArray:()=>q,toFlatOptionArray:()=>ko,toFullOption:()=>be,toFullOptionList:()=>Ie,toFullOptionMap:()=>ro,toOptions:()=>en,transformQuery:()=>il,trimIfString:()=>W,uniqByIdentifier:()=>Ze,uniqByName:()=>Vr,uniqOptGroups:()=>Ft,uniqOptList:()=>Io,update:()=>Xo,useControlledOrUncontrolled:()=>Fo,useDeprecatedProps:()=>rt,useMergedContext:()=>on,usePreferAnyProp:()=>dl,usePreferProp:()=>Xt,usePrevious:()=>Po,useQueryBuilderSchema:()=>ln,useQueryBuilderSelector:()=>Eo,useQueryBuilderSetup:()=>sn,useReactDndWarning:()=>Yt,useRule:()=>an,useRuleGroup:()=>un,useSelectElementChangeHandler:()=>cn,useStopEventPropagation:()=>Ge,useValueEditor:()=>pn,useValueSelector:()=>dn});module.exports=Er(Ol);var Cn=Oe(require("react")),Be=e=>Cn.createElement("button",{type:"button","data-testid":e.testID,disabled:e.disabled&&!e.disabledTranslation,className:e.className,title:e.disabledTranslation&&e.disabled?e.disabledTranslation.title:e.title,onClick:t=>e.handleOnClick(t)},e.disabledTranslation&&e.disabled?e.disabledTranslation.label:e.label);var $n=Oe(require("react")),Tn=require("react"),Go=(0,Tn.forwardRef)((e,t)=>$n.createElement("span",{"data-testid":e.testID,ref:t,className:e.className,title:e.title},e.label));var Co=Oe(require("react"));var Sn="~",to="------",Tt=Sn,Nn=to,En=to,St=Sn,Pn=to,Fn=to,Nt=",",Ao={fields:{title:"Fields",placeholderName:Tt,placeholderLabel:Nn,placeholderGroupLabel:En},operators:{title:"Operators",placeholderName:St,placeholderLabel:Pn,placeholderGroupLabel:Fn},value:{title:"Value"},removeRule:{label:"\u2A2F",title:"Remove rule"},removeGroup:{label:"\u2A2F",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"\u29C9",title:"Clone rule"},cloneRuleGroup:{label:"\u29C9",title:"Clone group"},shiftActionUp:{label:"\u02C4",title:"Shift up"},shiftActionDown:{label:"\u02C5",title:"Shift down"},dragHandle:{label:"\u205E\u205E",title:"Drag handle"},lockRule:{label:"\u{1F513}",title:"Lock rule"},lockGroup:{label:"\u{1F513}",title:"Lock group"},lockRuleDisabled:{label:"\u{1F512}",title:"Unlock rule"},lockGroupDisabled:{label:"\u{1F512}",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},Oo=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],Pr={"=":"!=","!=":"=","<":">=","<=":">",">":"<=",">=":"<",beginsWith:"doesNotBeginWith",doesNotBeginWith:"beginsWith",endsWith:"doesNotEndWith",doesNotEndWith:"endsWith",contains:"doesNotContain",doesNotContain:"contains",between:"notBetween",notBetween:"between",in:"notIn",notIn:"in",notNull:"null",null:"notNull"},Ue=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}],Fr=[...Ue,{name:"xor",value:"xor",label:"XOR"}],w={queryBuilder:"queryBuilder",ruleGroup:"ruleGroup",header:"ruleGroup-header",body:"ruleGroup-body",combinators:"ruleGroup-combinators",addRule:"ruleGroup-addRule",addGroup:"ruleGroup-addGroup",cloneRule:"rule-cloneRule",cloneGroup:"ruleGroup-cloneGroup",removeGroup:"ruleGroup-remove",notToggle:"ruleGroup-notToggle",rule:"rule",fields:"rule-fields",operators:"rule-operators",value:"rule-value",removeRule:"rule-remove",betweenRules:"betweenRules",valid:"queryBuilder-valid",invalid:"queryBuilder-invalid",shiftActions:"shiftActions",dndDragging:"dndDragging",dndOver:"dndOver",dndCopy:"dndCopy",dragHandle:"queryBuilder-dragHandle",disabled:"queryBuilder-disabled",lockRule:"rule-lock",lockGroup:"ruleGroup-lock",valueSource:"rule-valueSource",valueListItem:"rule-value-list-item",branches:"queryBuilder-branches"},vo={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:""},Et={empty:"empty",invalidCombinator:"invalid combinator",invalidIndependentCombinators:"invalid independent combinators"},Q={rule:"rule",ruleGroup:"rule-group",inlineCombinator:"inline-combinator",addGroup:"add-group",removeGroup:"remove-group",cloneGroup:"clone-group",cloneRule:"clone-rule",addRule:"add-rule",removeRule:"remove-rule",combinators:"combinators",fields:"fields",operators:"operators",valueEditor:"value-editor",notToggle:"not-toggle",shiftActions:"shift-actions",dragHandle:"drag-handle",lockRule:"lock-rule",lockGroup:"lock-group",valueSourceSelector:"value-source-selector"},xe={parentPathDisabled:"action aborted: parent path disabled",pathDisabled:"action aborted: path is disabled",queryUpdate:"query updated",onAddRuleFalse:"onAddRule callback returned false",onAddGroupFalse:"onAddGroup callback returned false",onRemoveFalse:"onRemove callback returned false",add:"rule or group added",remove:"rule or group removed",update:"rule or group updated",move:"rule or group moved"};var $o=e=>{let{component:t,...o}=e;return Co.createElement("div",{className:w.betweenRules,"data-testid":Q.inlineCombinator},Co.createElement(t,{...o,testID:Q.combinators}))};var To=Oe(require("react")),So=e=>To.createElement("label",{"data-testid":e.testID,className:e.className,title:e.title},To.createElement("input",{type:"checkbox",onChange:t=>e.handleOnChange(t.target.checked),checked:!!e.checked,disabled:e.disabled}),e.label);var mt=Oe(require("react")),ar=require("react-redux");var _e={errorInvalidIndependentCombinatorsProp:"QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorUnnecessaryIndependentCombinatorsProp:"QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorDeprecatedRuleGroupProps:"A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",errorDeprecatedRuleProps:"A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",errorBothQueryDefaultQuery:"QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",errorUncontrolledToControlled:"QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorControlledToUncontrolled:"QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorEnabledDndWithoutReactDnD:"QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd."};var oo=require("react-redux");var Bn=require("@reduxjs/toolkit"),In=Oe(require("react")),kn=require("react-redux");var Dn=require("@reduxjs/toolkit"),Dr={},gt=(0,Dn.createSlice)({name:"queries",initialState:Dr,reducers:{setQueryState:(e,{payload:{qbId:t,query:o}})=>{e[t]=o}},selectors:{getQuerySelectorById:(e,t)=>e[t]}});var wn=require("@reduxjs/toolkit");var wr={[_e.errorInvalidIndependentCombinatorsProp]:!1,[_e.errorUnnecessaryIndependentCombinatorsProp]:!1,[_e.errorDeprecatedRuleGroupProps]:!1,[_e.errorDeprecatedRuleProps]:!1,[_e.errorBothQueryDefaultQuery]:!1,[_e.errorUncontrolledToControlled]:!1,[_e.errorControlledToUncontrolled]:!1,[_e.errorEnabledDndWithoutReactDnD]:!1},Pt=(0,wn.createSlice)({name:"warnings",initialState:wr,reducers:{rqbWarn:(e,{payload:t})=>{e[t]||(console.error(t),e[t]=!0)}}});var Br={queries:gt.getInitialState(),warnings:Pt.getInitialState()},No=(0,Bn.configureStore)({reducer:{queries:gt.reducer,warnings:Pt.reducer},preloadedState:Br,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),nt=In.createContext(null),Eo=(0,kn.createSelectorHook)(nt),Ye=e=>t=>gt.selectors.getQuerySelectorById({queries:t.queries},e);var no=({payload:e,onQueryChange:t})=>o=>{o(gt.actions.setQueryState(e)),typeof t=="function"&&t(e.query)},xt=(0,oo.createDispatchHook)(nt),Qn=(0,oo.createStoreHook)(nt),{rqbWarn:ql}=Pt.actions;var Vn=require("react"),Po=e=>{let t=(0,Vn.useRef)({value:e,prev:null}),o=t.current.value;return e!==o&&(t.current={value:e,prev:o}),t.current.prev};var Fo=e=>{let t=xt(),{defaultQuery:o,queryProp:n}=e,r=Po(!!n)};function rt(e,t,o){let n=xt()}var ot=require("react");var Ln=(e,t=Nt)=>typeof e=="string"?e.split(`\\${t}`).map(o=>o.split(t)).reduce((o,n,r)=>r===0?n:[...o.slice(0,o.length-1),`${o[o.length-1]}${t}${n[0]}`,...n.slice(1)],[]):[],lt=(e,t=Nt)=>e.map(o=>`${o??""}`.replaceAll(t,`\\${t}`)).join(t),W=e=>typeof e=="string"?e.trim():e,q=e=>Array.isArray(e)?e.map(W):typeof e=="string"?Ln(e,Nt).filter(t=>!/^\s*$/.test(t)).map(t=>t.trim()):typeof e=="number"?[e]:[],Ir=e=>e.every(t=>t===!1||(t??!1)!==!1);var qn=require("numeric-quantity"),Do=new RegExp(qn.numericRegex.source.replace(/^\^/,"^\\s*").replace(/\$$/,"\\s*$")),ne=e=>e===null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype;var D=e=>ne(e)&&"rules"in e&&Array.isArray(e.rules),J=e=>D(e)&&typeof e.combinator=="string",ze=e=>D(e)&&typeof e.combinator>"u";var Mn=e=>D(e)?Wn(e):e,Wn=e=>{let t=[],o=r=>t.push(Mn(r)),n=0;for(let r=0;r<e.rules.length;r+=2)if(e.rules.length===1)o(e.rules[0]);else if(e.rules[r+1]==="and"){n=r;let l=1;for(;e.rules[n+l]==="and";)r+=2,l+=2;t.push({rules:e.rules.slice(n,r+1).map(Mn)}),r-=2}else e.rules[r+1]==="or"&&(r===0||r===e.rules.length-3?((r===0||e.rules[r-1]==="or")&&o(e.rules[r]),o(e.rules[r+1]),r===e.rules.length-3&&o(e.rules[r+2])):(e.rules[r-1]==="and"||o(e.rules[r]),o(e.rules[r+1])));return t.length===1&&typeof t[0]=="object"&&D(t[0])?{...e,...t[0]}:{...e,rules:t}},st=e=>{if(J(e))return e;let t=Wn(e),o=t.rules.map(l=>typeof l=="string"||!D(l)?l:st(l)),n=o.length<2?"and":o[1],r=o.filter(l=>typeof l!="string");return{...t,combinator:n,rules:r}},wo=e=>{if(ze(e))return e;let{combinator:t,...o}=e,n=[],{length:r}=e.rules;return e.rules.forEach((l,s)=>{D(l)?n.push(wo(l)):n.push(l),t&&s<r-1&&n.push(t)}),{...o,rules:n}};function kr(e){return ze(e)?st(e):wo(e)}var Qr=e=>{let t={},o=r=>{},n=r=>{let l=[];if(r.rules.length===0)l.push(Et.empty);else if(!J(r)){let s=!1;for(let a=0;a<r.rules.length&&!s;a++)(a%2===0&&typeof r.rules[a]=="string"||a%2===1&&typeof r.rules[a]!="string"||a%2===1&&typeof r.rules[a]=="string"&&!Ue.map(i=>i.name).includes(r.rules[a]))&&(s=!0);s&&l.push(Et.invalidIndependentCombinators)}J(r)&&!Ue.map(s=>s.name).includes(r.combinator)&&r.rules.length>1&&l.push(Et.invalidCombinator),r.id&&(l.length?t[r.id]={valid:!1,reasons:l}:t[r.id]=!0),r.rules.forEach(s=>{typeof s=="string"||(D(s)?n(s):o(s))})};return n(e),t};var Bo=require("immer");var jn=e=>ne(e)&&"name"in e&&typeof e.name=="string",Un=e=>ne(e)&&"value"in e&&typeof e.value=="string";function be(e,t){return(0,Bo.produce)(n=>{let r={},l=!!t;if(jn(n)&&!Un(n)?(r.value=n.name,l=!0):!jn(n)&&Un(n)&&(r.name=n.value,l=!0),l)return Object.assign({},t,n,r)})(e)}function Ie(e,t){return Array.isArray(e)?(0,Bo.produce)(n=>{if(Ne(n))for(let r of n)r.options.forEach((l,s)=>r.options[s]=be(l,t));else n.forEach((r,l)=>n[l]=be(r,t))})(e):[]}function ro(e,t){return Object.fromEntries(Object.entries(e).map(([o,n])=>[o,be(n,t)]))}var Vr=e=>Ze(e),Ze=e=>{let t=new Set,o=[];return e.forEach(n=>{t.has(n.value??n.name)||(t.add(n.value??n.name),o.push(n))}),e.length===o.length?e:o},Ft=e=>{let t=new Set,o=new Set,n=[];return e.forEach(r=>{if(!t.has(r.label)){t.add(r.label);let l=[];r.options.forEach(s=>{o.has(s.value??s.name)||(o.add(s.value??s.name),l.push(be(s)))}),n.push({...r,options:l})}}),n},Io=e=>Ne(e)?Ft(e):Ze(e.map(t=>be(t)));var Dt=e=>Array.isArray(e)&&e.length>0&&ne(e[0])&&"options"in e[0],Ne=e=>Array.isArray(e)&&e.length>0&&ne(e[0])&&"options"in e[0]&&ne(e[0].options[0])&&("name"in e[0].options[0]||"value"in e[0].options[0]),Lr=e=>Array.isArray(e)&&e.length>0&&ne(e[0])&&"options"in e[0]&&ne(e[0].options[0])&&"name"in e[0].options[0]&&ne(e[0].options[0])&&"value"in e[0].options[0],ve=(e,t)=>(Dt(e)?e.flatMap(o=>o.options):e).find(o=>o.name===t),he=e=>!Array.isArray(e)||e.length===0?null:Ne(e)?e[0].options[0].value??e[0].options[0].name:e[0].value??e[0].name,ko=e=>Ze(Dt(e)?e.flatMap(t=>t.options):e);var _n=(e,t,o)=>{let n=be(e),r=be(o);return n.value===r.value?!1:typeof n.comparator=="string"?n[n.comparator]===r[n.comparator]:n.comparator?.(r,t)??!1},wt=(e,t,o)=>{if(!e.comparator){let n=r=>(r.value??r.name)!==(e.value??e.name);return Ne(t)?t.map(r=>({...r,options:r.options.filter(n)})):t.filter(n)}return Ne(t)?t.map(n=>({...n,options:n.options.filter(r=>_n(e,o,r))})).filter(n=>n.options.length>0):t.filter(n=>_n(e,o,n))};var Hn=require("numeric-quantity"),H=(e,t={})=>{if(!t.parseNumbers||typeof e=="bigint"||typeof e=="number")return e;if(t.parseNumbers==="native")return parseFloat(e);let o=(0,Hn.numericQuantity)(e,{allowTrailingInvalid:t.parseNumbers==="enhanced",romanNumerals:!0,round:!1});return isNaN(o)?e:o};var lo=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},Qo={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},Vo={and:"&&",or:"||"},Jn={startsWith:(e,t)=>typeof e=="string"&&e.startsWith(t),endsWith:(e,t)=>typeof e=="string"&&e.endsWith(t)},Lo=e=>({...e,rules:e.rules.map(t=>{if(typeof t=="string")return t;if(D(t))return Lo(t);let{value:o}=t;return typeof o=="string"&&(o=H(o,{parseNumbers:!0})),{...t,value:o}})}),De=e=>typeof e=="string"&&e.length>0||typeof e=="number"&&!isNaN(e)||typeof e!="string"&&typeof e!="number",I=(e,t)=>t&&(typeof e=="number"||typeof e=="bigint"||typeof e=="string"&&Do.test(e)),zn=e=>e.length>=3,et=(e=["",""])=>Array.isArray(e)?e:typeof e=="string"?[e,e]:e??["",""],Ke=e=>e===null||typeof e>"u"||e==="";var so=e=>/^(does)?not/i.test(e),at=(e,t)=>typeof e!="string"||!t?e:e.replaceAll('"','\\"'),it=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l}={})=>{let s=n==="field",a=t.replace(/^=$/,"=="),i=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||i?W(o):`"${at(o,r)}"`}`;case"contains":case"doesNotContain":return`${so(a)?"!":""}${e}.contains(${s?W(o):`"${at(o,r)}"`})`;case"beginsWith":case"doesNotBeginWith":return`${so(a)?"!":""}${e}.startsWith(${s?W(o):`"${at(o,r)}"`})`;case"endsWith":case"doesNotEndWith":return`${so(a)?"!":""}${e}.endsWith(${s?W(o):`"${at(o,r)}"`})`;case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let u=so(a),c=q(o);return`${u?"!(":""}${e} in [${c.map(p=>s||I(p,l)?`${W(p)}`:`"${at(p,r)}"`).join(", ")}]${u?")":""}`}case"between":case"notBetween":{let u=q(o);if(u.length>=2&&!Ke(u[0])&&!Ke(u[1])){let[c,p]=u,y=I(c,!0)?H(c,{parseNumbers:!0}):NaN,f=I(p,!0)?H(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`"${at(c,r)}"`:y,b=isNaN(f)?s?`${p}`:`"${at(p,r)}"`:f;if(h===y&&b===f&&f<y){let N=f;b=y,h=N}return t==="between"?`(${e} >= ${h} && ${e} <= ${b})`:`(${e} < ${h} || ${e} > ${b})`}else return""}}return""};var ke=e=>typeof e!="string"?e:e.replaceAll("\\","\\\\").replaceAll('"','\\"'),ut=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{let l=n==="field",s=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,r);if(t==="="&&!l)return`{"${e}":${s?W(o):`"${ke(o)}"`}}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{let a=Qo[t];return l?`{"$expr":{"${a}":["$${e}","$${o}"]}}`:`{"${e}":{"${a}":${s?W(o):`"${ke(o)}"`}}}`}case"contains":return l?`{"$where":"this.${e}.includes(this.${o})"}`:`{"${e}":{"$regex":"${ke(o)}"}}`;case"beginsWith":return l?`{"$where":"this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$regex":"^${ke(o)}"}}`;case"endsWith":return l?`{"$where":"this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$regex":"${ke(o)}$"}}`;case"doesNotContain":return l?`{"$where":"!this.${e}.includes(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${ke(o)}"}}}`;case"doesNotBeginWith":return l?`{"$where":"!this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"^${ke(o)}"}}}`;case"doesNotEndWith":return l?`{"$where":"!this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${ke(o)}$"}}}`;case"null":return`{"${e}":null}`;case"notNull":return`{"${e}":{"$ne":null}}`;case"in":case"notIn":{let a=q(o);return l?`{"$where":"${t==="notIn"?"!":""}[${a.map(i=>`this.${i}`).join(",")}].includes(this.${e})"}`:`{"${e}":{"${Qo[t]}":[${a.map(i=>I(i,r)?`${W(i)}`:`"${ke(i)}"`).join(",")}]}}`}case"between":case"notBetween":{let a=q(o);if(a.length>=2&&De(a[0])&&De(a[1])){let[i,u]=a,c=I(i,!0)?H(i,{parseNumbers:!0}):NaN,p=I(u,!0)?H(u,{parseNumbers:!0}):NaN,y=l||!isNaN(c)?`${i}`:`"${ke(i)}"`,f=l||!isNaN(p)?`${u}`:`"${ke(u)}"`;return t==="between"?l?`{"$and":[{"$expr":{"$gte":["$${e}","$${y}"]}},{"$expr":{"$lte":["$${e}","$${f}"]}}]}`:`{"${e}":{"$gte":${y},"$lte":${f}}}`:l?`{"$or":[{"$expr":{"$lt":["$${e}","$${y}"]}},{"$expr":{"$gt":["$${e}","$${f}"]}}]}`:`{"$or":[{"${e}":{"$lt":${y}}},{"${e}":{"$gt":${f}}}]}`}else return""}}return""};var ao=e=>/^(does)?not/i.test(e),qo=(e,t)=>t?`!(${e})`:`${e}`,ct=(e,t)=>typeof e!="string"||!t?e:e.replaceAll("'","\\'"),pt=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l}={})=>{let s=n==="field",a=t.replace(/^=$/,"=="),i=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||i?W(o):`'${ct(o,r)}'`}`;case"contains":case"doesNotContain":return qo(`${e} matches ${s||i?W(o):`'${ct(o,r)}'`}`,ao(a));case"beginsWith":case"doesNotBeginWith":{let u=s?`'^'.concat(${W(o)})`:`'${typeof o=="string"&&!o.startsWith("^")||i?"^":""}${ct(o,r)}'`;return qo(`${e} matches ${u}`,ao(a))}case"endsWith":case"doesNotEndWith":{let u=s?`${W(o)}.concat('$')`:`'${ct(o,r)}${typeof o=="string"&&!o.endsWith("$")||i?"$":""}'`;return qo(`${e} matches ${u}`,ao(a))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let u=ao(a)?"!":"",c=q(o);return c.length>0?`${u}(${c.map(p=>`${e} == ${s||I(p,l)?`${W(p)}`:`'${ct(p,r)}'`}`).join(" or ")})`:""}case"between":case"notBetween":{let u=q(o);if(u.length>=2&&!Ke(u[0])&&!Ke(u[1])){let[c,p]=u,y=I(c,!0)?H(c,{parseNumbers:!0}):NaN,f=I(p,!0)?H(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`'${ct(c,r)}'`:y,b=isNaN(f)?s?`${p}`:`'${ct(p,r)}'`:f;if(h===y&&b===f&&f<y){let N=f;b=y,h=N}return t==="between"?`(${e} >= ${h} and ${e} <= ${b})`:`(${e} < ${h} or ${e} > ${b})`}else return""}}return""};var qr=(e,t,o)=>o&&typeof e=="string"?e.replaceAll(`${t}`,`${t}${t}`):e,He=({operator:e,value:t,valueSource:o},{escapeQuotes:n,parseNumbers:r,quoteFieldNamesWith:l,quoteValuesWith:s}={})=>{let a=o==="field",[i,u]=et(l),c=e.toLowerCase(),p=s||"'",y=b=>qr(b,p,n),f=b=>`${p}${y(b)}${p}`,h=b=>`${i}${b}${u}`;switch(c){case"null":case"notnull":return"";case"in":case"notin":{let b=q(t);return b.length>0?`(${b.map(N=>a?h(N):I(N,r)?`${W(N)}`:`${f(N)}`).join(", ")})`:""}case"between":case"notbetween":{let b=q(t);if(b.length>=2&&De(b[0])&&De(b[1])){let[N,k]=b;return a?`${h(N)} and ${h(k)}`:I(N,r)&&I(k,r)?`${W(N)} and ${W(k)}`:`${f(N)} and ${f(k)}`}return""}case"contains":case"doesnotcontain":return a?`${p}%${p} || ${h(t)} || ${p}%${p}`:`${p}%${y(t)}%${p}`;case"beginswith":case"doesnotbeginwith":return a?`${h(t)} || ${p}%${p}`:`${p}${y(t)}%${p}`;case"endswith":case"doesnotendwith":return a?`${p}%${p} || ${h(t)}`:`${p}%${y(t)}${p}`}return typeof t=="boolean"?t?"TRUE":"FALSE":a?h(t):I(t,r)?`${W(t)}`:`${f(t)}`};var Mr={"<":"lt","<=":"lte",">":"gt",">=":"gte"},io=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,Mo=e=>e?.replace(/('|\\)/g,"\\$1"),Wr={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},jr=(e,t,o)=>{let n=`doc['${e}'].${Wr[t]??t}(doc['${o}'])`;return t.startsWith("d")?`!${n}`:n},Bt=(e,t)=>typeof e=="boolean"?e:I(e,t)?H(e,{parseNumbers:t}):e,It=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{if(n==="field"){if(q(o).some(s=>typeof s!="string"))return!1;let l=Mo(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{let s=t==="="?"==":t,a=Mo(o);return a?{bool:{filter:{script:{script:`doc['${l}'] ${s} doc['${a}']`}}}}:!1}case"in":case"notIn":{let s=q(o);if(s.length>0){let a=s.map(i=>({bool:{filter:{script:{script:`doc['${l}'] == doc['${i}']`}}}}));return{bool:t==="in"?{should:a}:{must_not:a}}}return!1}case"between":case"notBetween":{let s=q(o);if(s.length>=2&&s[0]&&s[1]){let a=`doc['${l}'] >= doc['${s[0]}'] && doc['${l}'] <= doc['${s[1]}']`;return{bool:{filter:{script:{script:t==="notBetween"?`!(${a})`:a}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{let s=Mo(o);return s?{bool:{filter:{script:{script:jr(l,t,s)}}}}:!1}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[Mr[t]]:Bt(o,r)}}};case"=":return{term:{[e]:Bt(o,r)}};case"!=":return{bool:{must_not:{term:{[e]:Bt(o,r)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{let l=q(o).map(s=>Bt(s,r));if(l.length>0){let s=l.map(a=>({term:{[e]:Bt(a,r)}}));return{bool:t==="in"?{should:s}:{must_not:s}}}return!1}case"between":case"notBetween":{let l=q(o);if(l.length>=2&&De(l[0])&&De(l[1])){let[s,a]=l;if(I(s,!0)&&I(a,!0)){let i=H(s,{parseNumbers:!0}),u=H(a,{parseNumbers:!0});if(u<i){let c=u;a=i,s=c}else s=i,a=u}return io(t,{range:{[e]:{gte:s,lte:a}}})}return!1}case"contains":case"doesNotContain":return io(t,{regexp:{[e]:{value:o}}});case"beginsWith":case"doesNotBeginWith":return io(t,{regexp:{[e]:{value:`^${o}`}}});case"endsWith":case"doesNotEndWith":return io(t,{regexp:{[e]:{value:`${o}$`}}})}return!1};var uo=e=>/^(does)?not/i.test(e),kt=(e,t)=>`"${typeof e!="string"||!t?e:e.replaceAll('"','\\"')}"`,Qt=(e,t)=>t?`$not(${e})`:`${e}`,Kn=e=>`${e}`.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),Vt=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l=!0,quoteFieldNamesWith:s=["",""]}={})=>{let a=n==="field",i=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l),[u,c]=et(s),p=y=>`${u}${y}${c}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return`${p(e)} ${t} ${a?p(W(o)):i?W(o):kt(o,r)}`;case"contains":case"doesNotContain":return Qt(`$contains(${p(e)}, ${a?p(W(o)):kt(o,r)})`,uo(t));case"beginsWith":case"doesNotBeginWith":return Qt(a?`$substring(${p(e)}, 0, $length(${p(W(o))})) = ${p(W(o))}`:`$contains(${p(e)}, /^${Kn(o)}/)`,uo(t));case"endsWith":case"doesNotEndWith":return Qt(a?`$substring(${p(e)}, $length(${p(e)}) - $length(${p(W(o))})) = ${p(W(o))}`:`$contains(${p(e)}, /${Kn(o)}$/)`,uo(t));case"null":return`${p(e)} = null`;case"notNull":return`${p(e)} != null`;case"in":case"notIn":{let y=q(o);return Qt(`${p(e)} in [${y.map(f=>a?`${p(W(f))}`:I(f,l)?`${W(f)}`:kt(f,r)).join(", ")}]`,uo(t))}case"between":case"notBetween":{let y=q(o);if(y.length>=2&&!Ke(y[0])&&!Ke(y[1])){let[f,h]=y,b=I(f,!0)?H(f,{parseNumbers:!0}):NaN,N=I(h,!0)?H(h,{parseNumbers:!0}):NaN,k=isNaN(b)?a?`${f}`:f:b,V=isNaN(N)?a?`${h}`:h:N;if(k===b&&V===N&&N<b){let m=N;V=b,k=m}let F=I(f,l)&&I(h,l),g=`${p(e)} >= ${a?p(f):F?k:kt(k,r)} and ${p(e)} <= ${a?p(h):F?V:kt(V,r)}`;return t==="between"?`(${g})`:Qt(g,!0)}else return""}}return""};var Ur=e=>e.replace(/^(=)$/,"$1=").replace(/^notNull$/i,"!=").replace(/^null$/i,"=="),Lt=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,qt=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{let l=n==="field",s={var:e},a=i=>l?{var:`${i}`}:I(i,r)?H(i,{parseNumbers:r}):i;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[Ur(t)]:[s,a(o)]};case"null":case"notNull":return{[`${t==="notNull"?"!":"="}=`]:[s,null]};case"in":case"notIn":{let i=q(o).map(a);return Lt(t,{in:[s,i]})}case"between":case"notBetween":{let i=q(o);if(i.length>=2&&De(i[0])&&De(i[1])){let[u,c]=i;if(!l&&I(u,!0)&&I(c,!0)){let y=H(u,{parseNumbers:!0}),f=H(c,{parseNumbers:!0});if(f<y){let h=f;c=y,u=h}else u=y,c=f}else l&&(u={var:u},c={var:c});return Lt(t,{"<=":[u,s,c]})}return!1}case"contains":case"doesNotContain":{let i={in:[a(o),s]};return Lt(t,i)}case"beginsWith":case"doesNotBeginWith":{let i={startsWith:[s,a(o)]};return Lt(t,i)}case"endsWith":case"doesNotEndWith":{let i={endsWith:[s,a(o)]};return Lt(t,i)}}return!1};var Gt=(e,t,o)=>{let{fieldData:n,format:r,getNextNamedParam:l,parseNumbers:s,paramPrefix:a,paramsKeepPrefix:i,numberedParams:u,quoteFieldNamesWith:c=["",""],valueProcessor:p=He}=t??{},{processedParams:y=[]}=o??{},f=r==="parameterized",h=[],b={},N=d=>f?{sql:d,params:h}:{sql:d,params:b},k=p(e,{parseNumbers:s,quoteFieldNamesWith:c,fieldData:n,format:r}),V=lo(e.operator),F=V.toLowerCase();if((F==="in"||F==="not in"||F==="between"||F==="not between")&&!k)return N("");if(F==="is null"||F==="is not null")return N(`${c[0]}${e.field}${c[1]} ${V}`);if(e.valueSource==="field")return N(`${c[0]}${e.field}${c[1]} ${V} ${k}`.trim());if(F==="in"||F==="not in"){let d=q(e.value);if(f)return d.forEach(x=>h.push(I(x,s)?H(x,{parseNumbers:s}):x)),N(`${c[0]}${e.field}${c[1]} ${V} (${d.map((x,O)=>u?`${a}${y.length+1+d.length-(d.length-O)}`:"?").join(", ")})`);let G=[];return d.forEach(x=>{let O=l(e.field);G.push(`${a}${O}`),b[`${i?a:""}${O}`]=I(x,s)?H(x,{parseNumbers:s}):x}),N(`${c[0]}${e.field}${c[1]} ${V} (${G.join(", ")})`)}else if(F==="between"||F==="not between"){let d=q(e.value),[G,x]=d.slice(0,2).map(T=>I(T,s)?H(T,{parseNumbers:s}):T);if(f)return h.push(G),h.push(x),N(`${c[0]}${e.field}${c[1]} ${V} ${u?`${a}${y.length+1}`:"?"} and ${u?`${a}${y.length+2}`:"?"}`);let O=l(e.field),R=l(e.field);return b[`${i?a:""}${O}`]=G,b[`${i?a:""}${R}`]=x,N(`${c[0]}${e.field}${c[1]} ${V} ${a}${O} and ${a}${R}`)}let g=e.value;typeof e.value=="string"&&(I(e.value,s)?g=H(e.value,{parseNumbers:s}):g=/^'.*'$/g.test(k)?k.replace(/(^'|'$)/g,""):k);let m="";return f?h.push(g):(m=l(e.field),b[`${i?a:""}${m}`]=g),N(`${c[0]}${e.field}${c[1]} ${V} ${f?u?`${a}${y.length+1}`:"?":`${a}${m}`}`.trim())};var co=(e,t)=>{let{parseNumbers:o,escapeQuotes:n,quoteFieldNamesWith:r=["",""],quoteValuesWith:l="'",valueProcessor:s=He}=t??{},a=s(e,{parseNumbers:o,escapeQuotes:n,quoteFieldNamesWith:r,quoteValuesWith:l}),i=lo(e.operator),u=i.toLowerCase();if((u==="in"||u==="not in"||u==="between"||u==="not between")&&!a)return"";let[c,p]=et(r);return`${c}${e.field}${p} ${i} ${a}`.trim()};var Wo=e=>ne(e)&&typeof e.valid=="boolean",ye=(e,t,o)=>{if(typeof t=="boolean")return t;if(Wo(t))return t.valid;if(typeof o=="function"&&!D(e)){let n=o(e);if(typeof n=="boolean")return n;if(Wo(n))return n.valid}return!0};function _r(e,t={}){let o="json",n=He,r=null,l=["",""],s=()=>!0,a=[],i={},u="",c=":",p=!1,y=!1,f=!1,h=Tt,b=St,N="'";if(typeof t=="string")o=t.toLowerCase(),o==="mongodb"?r=ut:o==="parameterized"?r=Gt:o==="parameterized_named"?r=Gt:o==="cel"?r=it:o==="spel"?r=pt:o==="jsonlogic"?r=qt:o==="elasticsearch"?r=It:o==="jsonata"&&(r=Vt);else{o=(t.format??"json").toLowerCase();let{valueProcessor:g=null,ruleProcessor:m=null}=t;typeof m=="function"&&(r=m),n=typeof g=="function"?(d,G)=>zn(g)?g(d.field,d.operator,d.value,d.valueSource):g(d,G):o==="mongodb"?r??ut:o==="cel"?r??it:o==="spel"?r??pt:o==="jsonlogic"?r??qt:o==="elasticsearch"?r??It:o==="jsonata"?r??Vt:He,l=et(t.quoteFieldNamesWith),s=t.validator??(()=>!0),a=Ie(t.fields??[]),u=t.fallbackExpression??"",c=t.paramPrefix??":",p=!!t.paramsKeepPrefix,y=!!t.numberedParams,f=!!t.parseNumbers,h=t.placeholderFieldName??Tt,b=t.placeholderOperatorName??St,N=t.quoteValuesWith??"'"}if(u||(u=o==="mongodb"?'"$and":[{"$expr":true}]':o==="cel"||o==="spel"?"1 == 1":"(1 = 1)"),o==="json"||o==="json_without_ids"){let g=f?Lo(e):e;return o==="json"?JSON.stringify(g,null,2):JSON.stringify(g,(m,d)=>m==="id"||m==="path"?void 0:d)}if(typeof s=="function"){let g=s(e);if(typeof g=="boolean"){if(g===!1)return o==="parameterized"?{sql:u,params:[]}:o==="parameterized_named"?{sql:u,params:{}}:o==="mongodb"?`{${u}}`:o==="jsonlogic"?!1:o==="elasticsearch"?{}:u}else i=g}let k={},V=ko(a);V.forEach(g=>{typeof g.validator=="function"&&(k[g.value??g.name]=g.validator)});let F=g=>{let m,d;if(g.id&&(m=i[g.id]),V.length){let G=V.filter(x=>x.name===g.field);if(G.length){let x=G[0];typeof x.validator=="function"&&(d=x.validator)}}return[m,d]};if(o==="sql"){let g=(m,d)=>{if(!ye(m,i[m.id??""]))return d?u:"";let G=m.rules.map(x=>{if(typeof x=="string")return x;if(D(x))return g(x,m.rules.length===1);let[O,R]=F(x);if(!ye(x,O,R)||x.field===h||x.operator===b)return"";let T=(x.valueSource??"value")==="value",v=ve(a,x.field);return typeof r=="function"?r(x,{parseNumbers:f,escapeQuotes:T,quoteFieldNamesWith:l,fieldData:v,format:o,quoteValuesWith:N}):co(x,{parseNumbers:f,escapeQuotes:T,valueProcessor:n,quoteFieldNamesWith:l,fieldData:v,format:o,quoteValuesWith:N})});return G.length===0?u:`${m.not?"NOT ":""}(${G.filter(Boolean).join(J(m)?` ${m.combinator} `:" ")})`};return g(e,!0)}if(o==="parameterized"||o==="parameterized_named"){let g=o==="parameterized",m=[],d={},G=new Map,x=T=>{G.has(T)||G.set(T,new Set);let v=`${T}_${G.get(T).size+1}`;return G.get(T).add(v),v},O=T=>{let[v,B]=F(T);if(!ye(T,v,B)||T.field===h||T.operator===b)return"";let z=ve(a,T.field),ae=Object.fromEntries(Array.from(G.entries()).map(([C,me])=>[C,Array.from(me)])),U=(typeof r=="function"?r:Gt)(T,{getNextNamedParam:x,fieldParamNames:ae,parseNumbers:f,quoteFieldNamesWith:l,fieldData:z,format:o,paramPrefix:c,paramsKeepPrefix:p,numberedParams:y,fallbackExpression:u,valueProcessor:n,fields:a,placeholderFieldName:h,placeholderOperatorName:b,validator:s},{processedParams:m});if(!ne(U))return"";let{sql:ce,params:E}=U;return typeof ce!="string"||!ce?"":(o==="parameterized"&&Array.isArray(E)?m.push(...E):o==="parameterized_named"&&ne(E)&&(Object.assign(d,E),Object.keys(E).forEach(C=>G.get(T.field)?.add(C))),ce)},R=(T,v)=>{if(!ye(T,i[T.id??""]))return v?u:"";let B=T.rules.map(z=>typeof z=="string"?z:D(z)?R(z,T.rules.length===1):O(z));return B.length===0?u:`${T.not?"NOT ":""}(${B.filter(Boolean).join(J(T)?` ${T.combinator} `:" ")})`};return g?{sql:R(e,!0),params:m}:{sql:R(e,!0),params:d}}if(o==="mongodb"){let g=(G,x)=>{if(!ye(G,i[G.id??""]))return x?u:"";let O=`"$${G.combinator.toLowerCase()}"`,R=!1,T=G.rules.map(v=>{if(D(v)){let U=g(v);return U?(R=!0,/^\{.+\}$/.test(U)?U:`{${U}}`):""}let[B,z]=F(v);if(!ye(v,B,z)||v.field===h||v.operator===b)return"";let ae=ve(a,v.field);return(r??n)(v,{parseNumbers:f,fieldData:ae,format:o})}).filter(Boolean);return T.length>0?T.length===1&&!R?T[0]:`${O}:[${T.join(",")}]`:u},m=J(e)?e:st(e),d=g(m,!0);return/^\{.+\}$/.test(d)?d:`{${d}}`}if(o==="cel"){let g=(m,d)=>{if(!ye(m,i[m.id??""]))return d?u:"";let G=m.rules.map(R=>{if(typeof R=="string")return Vo[R];if(D(R))return g(R);let[T,v]=F(R);if(!ye(R,T,v)||R.field===h||R.operator===b)return"";let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:B,format:o})}).filter(Boolean).join(J(m)?` ${Vo[m.combinator]} `:" "),[x,O]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${O}`:u};return g(e,!0)}if(o==="spel"){let g=(m,d)=>{if(!ye(m,i[m.id??""]))return d?u:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[T,v]=F(R);if(!ye(R,T,v)||R.field===h||R.operator===b)return"";let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:B,format:o})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,O]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${O}`:u};return g(e,!0)}if(o==="jsonata"){let g=(m,d)=>{if(!ye(m,i[m.id??""]))return d?u:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[T,v]=F(R);if(!ye(R,T,v)||R.field===h||R.operator===b)return"";let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:B,format:o,quoteFieldNamesWith:l})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,O]=m.not||!d?[`${m.not?"$not":""}(`,")"]:["",""];return G?`${x}${G}${O}`:u};return g(e,!0)}if(o==="jsonlogic"){let g=J(e)?e:st(e),m=(d,G)=>{if(!ye(d,i[d.id??""]))return!1;let x=d.rules.map(R=>{if(D(R))return m(R);let[T,v]=F(R);if(!ye(R,T,v)||R.field===h||R.operator===b)return!1;let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,fieldData:B,format:o})}).filter(Boolean);if(x.length===0)return!1;let O={[d.combinator]:x};return d.not?{"!":O}:O};return m(g,!0)}if(o==="elasticsearch"){let g=J(e)?e:st(e),m=G=>{if(!ye(G,i[G.id??""]))return!1;let x=G.rules.map(O=>{if(D(O))return m(O);let[R,T]=F(O);if(!ye(O,R,T)||O.field===h||O.operator===b)return!1;let v=ve(a,O.field);return(r??n)(O,{parseNumbers:f,fieldData:v,format:o})}).filter(Boolean);return x.length===0?!1:{bool:G.not?{must_not:G.combinator==="or"?{bool:{should:x}}:x}:{[G.combinator==="or"?"should":"must"]:x}}},d=m(g);return d===!1?{}:d}return""}var Hr={default:He,mongodb:ut,cel:it,spel:pt},po=e=>(t,o,n,r)=>Hr[e]({field:t,operator:o,value:n,valueSource:r},{parseNumbers:!1}),Jr=po("default"),zr=po("mongodb"),Kr=po("cel"),Xr=po("spel");var Yr=it,Zr=ut,el=pt;var Re=(e,t)=>{let o=t,n=0;for(;n<e.length&&o&&D(o);){let r=o.rules[e[n]];typeof r!="string"?o=r:o=null,n++}return o},re=e=>e.slice(0,e.length-1),Qe=(e,t)=>e.length===t.length&&e.every((o,n)=>o===t[n]),tl=(e,t)=>e.length<t.length&&RegExp(`^${e.join("-")}`).test(t.join("-")),jo=(e,t)=>{let o=[],n=re(e),r=re(t),l=0;for(;l<n.length&&l<r.length&&n[l]===r[l];)o.push(r[l]),l++;return o},dt=(e,t)=>{let o=!!t.disabled,n=t,r=0;for(;r<e.length&&!o&&D(n);){let l=n.rules[e[r]];ne(l)&&(D(l)||"field"in l&&l.field)&&(o=!!l.disabled,n=l),r++}return o};var Uo=e=>Qe([],e.path)?"Query builder":`Rule group at path ${e.path.join("-")}`;var Mt=globalThis.crypto,ge=()=>"00-0-4-2-000".replace(/[^-]/g,e=>((Math.random()+~~e)*65536>>parseInt(e)).toString(16).padStart(4,"0"));if(Mt){if(typeof Mt.randomUUID=="function")ge=()=>Mt.randomUUID();else if(typeof Mt.getRandomValues=="function"){let e="89ab",t=new Uint32Array(32);ge=()=>{Mt.getRandomValues(t);let o=(t[0]%16).toString(16);for(let n=1;n<32;n++)n===12?o=`${o}4`:n===16?o=`${o}${e[t[17]%4]}`:o=`${o}${(t[n]%16).toString(16)}`,(n===7||n===11||n===15||n===19)&&(o=`${o}-`);return o}}}var Yn=Oe(require("react")),At=require("react");var _o=Oe(require("clsx")),Wt=(...e)=>{let t=o=>(0,_o.default)(e.filter(Boolean).map(n=>(0,_o.default)(n[o])));return{queryBuilder:t("queryBuilder"),ruleGroup:t("ruleGroup"),header:t("header"),body:t("body"),combinators:t("combinators"),addRule:t("addRule"),addGroup:t("addGroup"),cloneRule:t("cloneRule"),cloneGroup:t("cloneGroup"),removeGroup:t("removeGroup"),rule:t("rule"),fields:t("fields"),operators:t("operators"),value:t("value"),removeRule:t("removeRule"),notToggle:t("notToggle"),shiftActions:t("shiftActions"),dragHandle:t("dragHandle"),lockRule:t("lockRule"),lockGroup:t("lockGroup"),valueSource:t("valueSource"),actionElement:t("actionElement"),valueSelector:t("valueSelector")}};var Xn=require("immer");var jt=Object.keys,ol=Object.entries;var nl={},Ut=(...e)=>{let[t,...o]=e;return(0,Xn.produce)(t??nl,n=>{for(let r of o)r&&jt(r).forEach(l=>{n[l]={...n[l],...r[l]}})})};var rl=e=>{let{key:t,controlClassnames:o,controlElements:n,translations:r}=e;return l=>{let s=(0,At.useContext)(tt),a=(0,At.useMemo)(()=>o?{controlClassnames:Wt(s.controlClassnames,l.controlClassnames,o)}:{},[l.controlClassnames,s.controlClassnames]),i=(0,At.useMemo)(()=>Ut(s.translations,r,l.translations),[l.translations,s.translations]),u=(0,At.useMemo)(()=>({...s,...a,controlElements:{...s.controlElements,...n,...l.controlElements},translations:i}),[a,i,l.controlElements,s]);return Yn.createElement(tt.Provider,{value:u,key:t},l.children)}};var _t=e=>{let t=typeof e=="boolean"?e:typeof e=="object"&&e!==null?e.valid:null;return typeof t=="boolean"?t?w.valid:w.invalid:""};var ll=["value"],sl={name:"name",value:"name",valueSources:null,label:"label"},Ho=(e,t,o)=>{let n=e?be(e):sl;if(n.valueSources)return typeof n.valueSources=="function"?n.valueSources(t):n.valueSources;if(o){let r=o(n.value,t,{fieldData:be(n)});if(r)return r}return ll};var Jo=require("immer");var zo=(e,{idGenerator:t=ge}={})=>(0,Jo.produce)(e,o=>{o.id||(o.id=t())}),Ht=(e,{idGenerator:t=ge}={})=>(0,Jo.produce)(e,o=>{o.id||(o.id=t()),o.rules=o.rules.map(n=>typeof n=="string"?n:D(n)?Ht(n,{idGenerator:t}):zo(n,{idGenerator:t}))}),Ko=(e,{idGenerator:t=ge}={})=>D(e)?Ht(e,{idGenerator:t}):zo(e,{idGenerator:t});var Kt=require("immer");var Jt=(e,{idGenerator:t=ge}={})=>JSON.parse(JSON.stringify({...e,id:t()})),zt=(e,{idGenerator:t=ge}={})=>{if(!ne(e))return e;if(!D(e))return JSON.parse(JSON.stringify({...e,id:t()}));if(J(e)){let n=e.rules.map(r=>D(r)?zt(r,{idGenerator:t}):Jt(r,{idGenerator:t}));return{...e,id:t(),rules:n}}let o=e.rules.map(n=>typeof n=="string"?n:D(n)?zt(n,{idGenerator:t}):Jt(n,{idGenerator:t}));return{...e,id:t(),rules:o}};var mo=(e,t,o,{combinators:n=Ue,combinatorPreceding:r,idGenerator:l=ge}={})=>(0,Kt.produce)(e,s=>{let a=Re(o,s);if(!(!a||!D(a))){if(!J(a)&&a.rules.length>0){let i=a.rules[a.rules.length-2];a.rules.push(r??(typeof i=="string"?i:he(n)))}a.rules.push(Ko(t,{idGenerator:l}))}}),Xo=(e,t,o,n,{resetOnFieldChange:r=!0,resetOnOperatorChange:l=!1,getRuleDefaultOperator:s=()=>"=",getValueSources:a=()=>["value"],getRuleDefaultValue:i=()=>""}={})=>(0,Kt.produce)(e,u=>{if(t==="combinator"&&!J(u)){let b=Re(re(n),u).rules;n[n.length-1]%2===1&&(b[n[n.length-1]]=o);return}let c=Re(n,u);if(!c)return;let p=D(c);if(c[t]===o||(t!=="valueSource"&&(c[t]=o),p))return;let y=!1,f=!1;r&&t==="field"&&(c.operator=s(o),y=!0,f=!0),l&&t==="operator"&&(y=!0,f=!0);let h=a(c.field,c.operator)[0];(y&&c.valueSource&&h!==c.valueSource||t==="valueSource"&&o!==c.valueSource)&&(f=!!c.valueSource||!c.valueSource&&o!==h,c.valueSource=y?h:o),f&&(c.value=i(c))}),Yo=(e,t)=>t.length===0||!J(e)&&!Re(t,e)?e:(0,Kt.produce)(e,o=>{let n=t[t.length-1],r=Re(re(t),o);if(r&&D(r))if(!J(r)&&r.rules.length>1){let l=n===0?0:n-1;r.rules.splice(l,2)}else r.rules.splice(n,1)}),al=(e,t,o)=>{if(Array.isArray(o))return o;let n=ze(e);if(o==="up"){if(Qe(t,[0]))return t;if(t.at(-1)===0){let r=re(t);return[...re(r),Math.max(0,r.at(-1)-(n?1:0))]}else{let r=[...re(t),Math.max(0,t.at(-1)-(n?2:1))],l=Re(r,e);return D(l)?[...r,l.rules.length]:[...re(t),Math.max(0,t.at(-1)-(n?3:1))]}}else if(o==="down"){if(Qe([e.rules.length-1],t))return t;if(t.at(-1)===Re(re(t),e).rules.length-1){let r=re(t);return[...re(r),r.at(-1)+1]}else{let r=[...re(t),t.at(-1)+(n?2:1)],l=Re(r,e);return D(l)?[...r,0]:[...re(t),t.at(-1)+(n?3:2)]}}return t},Zo=(e,t,o,{clone:n=!1,combinators:r=Ue,idGenerator:l=ge}={})=>{let s=al(e,t,o);if(t.length===0||Qe(t,s)||!Re(re(s),e))return e;let a=Re(t,e);if(!a)return e;let i=n?D(a)?zt(a,{idGenerator:l}):Jt(a,{idGenerator:l}):a;return(0,Kt.produce)(e,u=>{let c=ze(u),p=Re(re(t),u),y=t[t.length-1],f=c&&y>0?p.rules[y-1]:null,h=c&&y<p.rules.length-1?p.rules[y+1]:null;if(!n){let m=c?Math.max(0,y-1):y,d=c?2:1;p.rules.splice(m,d)}let b=[...s],N=jo(t,s);!n&&t.length===N.length+1&&s[N.length]>t[N.length]&&(b[N.length]-=c?2:1);let k=re(b),V=Re(k,u),F=b[b.length-1],g=(...m)=>V.rules.splice(F,0,...m);if(V.rules.length===0||!c)g(i);else if(F===0)if(y===0&&h)g(i,h);else{let m=V.rules[1]||f||he(r);g(i,m)}else if(f)g(f,i);else{let m=V.rules[F-2]||h||he(r);g(m,i)}})};var fo=Oe(require("react"));var en=e=>Dt(e)?e.map(t=>fo.createElement("optgroup",{key:t.label,label:t.label},t.options.map(o=>fo.createElement("option",{key:o.name,value:o.name,disabled:o.disabled},o.label)))):Array.isArray(e)?e.map(t=>fo.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label)):null;var er=require("immer");var Zn=(e,t,o)=>(0,er.produce)(e,n=>{for(let[r,l]of Object.entries(t))l===!1?delete n[r]:l&&r!==l&&r in n&&(n[l]=n[r],o&&delete n[r])});function il(e,t={}){let{ruleProcessor:o=c=>c,ruleGroupProcessor:n=c=>c,propertyMap:r={},combinatorMap:l={},operatorMap:s={},omitPath:a=!1,deleteRemappedProperties:i=!0}=t,u=c=>({...n(Zn({...c,...J(c)?{combinator:l[c.combinator]??c.combinator}:{}},r,i)),...r.rules===!1?null:{[r.rules??"rules"]:c.rules.map((p,y)=>{let f=a?null:{path:[...c.path,y]};return typeof p=="string"?l[p]??p:D(p)?u({...p,...f}):o(Zn({...p,...f,..."operator"in p?{operator:s[p.operator]??p.operator}:{}},r,i))})}});return u({...e,...a?null:{path:[]}})}var tn=require("react"),ul=(e,t)=>e===!1?!1:e?!0:t!==!1,cl=(e,t)=>e?!0:e===!1?!1:!!t,pl=(e,t,o)=>e?ul(t,o):cl(t,o),Xt=(e,t,o)=>(0,tn.useMemo)(()=>pl(e,t,o),[o,e,t]),dl=(e,t,o)=>(0,tn.useMemo)(()=>typeof t<"u"&&t!=null?t:typeof o<"u"&&o!=null?o:e,[o,e,t]);var A=()=>null,tr=(0,ot.forwardRef)(A),on=e=>{let t=(0,ot.useContext)(tt),o=Xt(!0,e.enableMountQueryChange,t.enableMountQueryChange),n=Xt(!1,e.enableDragAndDrop,t.enableDragAndDrop)&&t.enableDragAndDrop!==!1,r=Xt(!1,e.debugMode,t.debugMode),l=(0,ot.useMemo)(()=>Wt(vo,t.controlClassnames,e.controlClassnames),[t.controlClassnames,e.controlClassnames]),s=(0,ot.useMemo)(()=>{let b={...t.controlElements,...t.controlElements?.dragHandle===null?{dragHandle:tr}:{},...t.controlElements?.inlineCombinator===null?{inlineCombinator:A}:{},...t.controlElements?.notToggle===null?{notToggle:A}:{},...t.controlElements?.shiftActions===null?{shiftActions:A}:{},...t.controlElements?.valueEditor===null?{valueEditor:A}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...t.controlElements?.addGroupAction===null?{addGroupAction:A}:{},...t.controlElements?.addRuleAction===null?{addRuleAction:A}:{},...t.controlElements?.cloneGroupAction===null?{cloneGroupAction:A}:{},...t.controlElements?.cloneRuleAction===null?{cloneRuleAction:A}:{},...t.controlElements?.lockGroupAction===null?{lockGroupAction:A}:{},...t.controlElements?.lockRuleAction===null?{lockRuleAction:A}:{},...t.controlElements?.removeGroupAction===null?{removeGroupAction:A}:{},...t.controlElements?.removeRuleAction===null?{removeRuleAction:A}:{},...t.controlElements?.combinatorSelector===null?{combinatorSelector:A}:{},...t.controlElements?.fieldSelector===null?{fieldSelector:A}:{},...t.controlElements?.operatorSelector===null?{operatorSelector:A}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...t.controlElements?.actionElement?{addGroupAction:t.controlElements?.addGroupAction===null?A:t.controlElements?.addGroupAction??t.controlElements.actionElement,addRuleAction:t.controlElements?.addRuleAction===null?A:t.controlElements?.addRuleAction??t.controlElements.actionElement,cloneGroupAction:t.controlElements?.cloneGroupAction===null?A:t.controlElements?.cloneGroupAction??t.controlElements.actionElement,cloneRuleAction:t.controlElements?.cloneRuleAction===null?A:t.controlElements?.cloneRuleAction??t.controlElements.actionElement,lockGroupAction:t.controlElements?.lockGroupAction===null?A:t.controlElements?.lockGroupAction??t.controlElements.actionElement,lockRuleAction:t.controlElements?.lockRuleAction===null?A:t.controlElements?.lockRuleAction??t.controlElements.actionElement,removeGroupAction:t.controlElements?.removeGroupAction===null?A:t.controlElements?.removeGroupAction??t.controlElements.actionElement,removeRuleAction:t.controlElements?.removeRuleAction===null?A:t.controlElements?.removeRuleAction??t.controlElements.actionElement}:{},...t.controlElements?.valueSelector?{combinatorSelector:t.controlElements?.combinatorSelector===null?A:t.controlElements?.combinatorSelector??t.controlElements.valueSelector,fieldSelector:t.controlElements?.fieldSelector===null?A:t.controlElements?.fieldSelector??t.controlElements.valueSelector,operatorSelector:t.controlElements?.operatorSelector===null?A:t.controlElements?.operatorSelector??t.controlElements.valueSelector,valueSourceSelector:t.controlElements?.valueSourceSelector===null?A:t.controlElements?.valueSourceSelector??t.controlElements.valueSelector}:{}},N={...e.controlElements,...e.controlElements?.dragHandle===null?{dragHandle:tr}:{},...e.controlElements?.inlineCombinator===null?{inlineCombinator:A}:{},...e.controlElements?.notToggle===null?{notToggle:A}:{},...e.controlElements?.shiftActions===null?{shiftActions:A}:{},...e.controlElements?.valueEditor===null?{valueEditor:A}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...e.controlElements?.addGroupAction===null?{addGroupAction:A}:{},...e.controlElements?.addRuleAction===null?{addRuleAction:A}:{},...e.controlElements?.cloneGroupAction===null?{cloneGroupAction:A}:{},...e.controlElements?.cloneRuleAction===null?{cloneRuleAction:A}:{},...e.controlElements?.lockGroupAction===null?{lockGroupAction:A}:{},...e.controlElements?.lockRuleAction===null?{lockRuleAction:A}:{},...e.controlElements?.removeGroupAction===null?{removeGroupAction:A}:{},...e.controlElements?.removeRuleAction===null?{removeRuleAction:A}:{},...e.controlElements?.combinatorSelector===null?{combinatorSelector:A}:{},...e.controlElements?.fieldSelector===null?{fieldSelector:A}:{},...e.controlElements?.operatorSelector===null?{operatorSelector:A}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...e.controlElements?.actionElement?{addGroupAction:e.controlElements?.addGroupAction===null?A:e.controlElements?.addGroupAction??e.controlElements.actionElement,addRuleAction:e.controlElements?.addRuleAction===null?A:e.controlElements?.addRuleAction??e.controlElements.actionElement,cloneGroupAction:e.controlElements?.cloneGroupAction===null?A:e.controlElements?.cloneGroupAction??e.controlElements.actionElement,cloneRuleAction:e.controlElements?.cloneRuleAction===null?A:e.controlElements?.cloneRuleAction??e.controlElements.actionElement,lockGroupAction:e.controlElements?.lockGroupAction===null?A:e.controlElements?.lockGroupAction??e.controlElements.actionElement,lockRuleAction:e.controlElements?.lockRuleAction===null?A:e.controlElements?.lockRuleAction??e.controlElements.actionElement,removeGroupAction:e.controlElements?.removeGroupAction===null?A:e.controlElements?.removeGroupAction??e.controlElements.actionElement,removeRuleAction:e.controlElements?.removeRuleAction===null?A:e.controlElements?.removeRuleAction??e.controlElements.actionElement}:{},...e.controlElements?.valueSelector?{combinatorSelector:e.controlElements?.combinatorSelector===null?A:e.controlElements?.combinatorSelector??e.controlElements.valueSelector,fieldSelector:e.controlElements?.fieldSelector===null?A:e.controlElements?.fieldSelector??e.controlElements.valueSelector,operatorSelector:e.controlElements?.operatorSelector===null?A:e.controlElements?.operatorSelector??e.controlElements.valueSelector,valueSourceSelector:e.controlElements?.valueSourceSelector===null?A:e.controlElements?.valueSourceSelector??e.controlElements.valueSelector}:{}};return{...nn,...b,...N}},[e.controlElements,t.controlElements]),a=(0,ot.useMemo)(()=>Ut(Ao,t.translations,e.translations),[e.translations,t.translations]),{controlClassnames:i,controlElements:u,debugMode:c,enableDragAndDrop:p,enableMountQueryChange:y,translations:f,...h}=t;return{controlClassnames:l,controlElements:s,debugMode:r,enableDragAndDrop:n,enableMountQueryChange:o,translations:a,...h}};var rn=require("clsx"),K=require("react");var ml={},fl={},yl=()=>null,hl=()=>"",bl=()=>"",Rl=e=>e,gl=e=>e,xl=()=>!0,Gl=(...e)=>{console.log(...e)};function ln(e,t){let{query:o,defaultQuery:n,getValueEditorSeparator:r=yl,getRuleClassname:l=hl,getRuleGroupClassname:s=bl,onAddRule:a=Rl,onAddGroup:i=gl,onRemove:u=xl,onQueryChange:c,showCombinatorsBetweenRules:p=!1,showNotToggle:y=!1,showShiftActions:f=!1,showCloneButtons:h=!1,showLockButtons:b=!1,resetOnFieldChange:N=!0,resetOnOperatorChange:k=!1,autoSelectField:V=!0,autoSelectOperator:F=!0,addRuleToNewGroups:g=!1,listsAsArrays:m=!1,parseNumbers:d=!1,disabled:G=!1,validator:x,onLog:O=Gl,idGenerator:R,accessibleDescriptionGenerator:T=Uo}=e,{qbId:v,rqbContext:B,fields:z,fieldMap:ae,combinators:U,getOperatorsMain:ce,getRuleDefaultOperator:E,getValueEditorTypeMain:C,getValueSourcesMain:me,getValuesMain:qe,getRuleDefaultValue:we,getInputTypeMain:Me,createRule:We,createRuleGroup:Pe}=t,{controlClassnames:je,controlElements:L,debugMode:Y,enableDragAndDrop:$,enableMountQueryChange:S,translations:P}=B,ie=!!p,ue=!!y,Je=!!f,Ce=!!h,yt=!!b,ht=!!N,Xe=!!k,te=!!V,oe=!!F,Ae=!!g,bt=!!m;Fo({defaultQuery:n,queryProp:o});let X=Qn(),$e=xt(),Rt=(0,K.useMemo)(()=>Ye(t.qbId),[t.qbId]),bo=Eo(Rt),bn=(0,K.useCallback)(()=>Rt(X.getState()),[X,Rt]),hr=(0,K.useMemo)(()=>Pe(),[Pe]),Ro=o??bo??n??hr,Te=Ro.id?Ro:Ht(Ro,{idGenerator:R});(0,K.useEffect)(()=>{o&&o!==bo&&$e(no({payload:{qbId:v,query:o},onQueryChange:void 0}))},[o,v,bo,$e]);let vt=(0,K.useMemo)(()=>ze(Te),[Te]),go=!!e.independentCombinators&&!vt;rt("independentCombinators",go||!go&&(e.independentCombinators??"not present")!=="not present",go?"invalid":"unnecessary");let Rn=(0,K.useRef)(!1);(0,K.useEffect)(()=>{Rn.current||(Rn.current=!0,$e(no({payload:{qbId:v,query:Te},onQueryChange:S&&typeof c=="function"?c:void 0})))},[S,c,v,$e,Te]);let Fe=(0,K.useCallback)(M=>{$e(no({payload:{qbId:v,query:M},onQueryChange:c}))},[c,v,$e]),Zt=(0,K.useMemo)(()=>Array.isArray(G)&&G||[],[G]),Se=G===!0,br=(0,K.useMemo)(()=>Te.disabled||Zt.some(M=>M.length===0),[Zt,Te.disabled]),gn=(0,K.useCallback)((M,Z,pe)=>{let _=Ye(v)(X.getState());if(!_)return;if(dt(Z,_)||Se){Y&&O({type:xe.parentPathDisabled,rule:M,parentPath:Z,query:_});return}let fe=a(M,Z,_,pe);if(!fe){Y&&O({type:xe.onAddRuleFalse,rule:M,parentPath:Z,query:_});return}let $t=mo(_,fe,Z,{combinators:U,combinatorPreceding:fe.combinatorPreceding??void 0});Y&&O({type:xe.add,query:_,newQuery:$t,newRule:fe,parentPath:Z}),Fe($t)},[U,Y,Fe,a,O,v,Se,X]),xn=(0,K.useCallback)((M,Z,pe)=>{let _=Ye(v)(X.getState());if(!_)return;if(dt(Z,_)||Se){Y&&O({type:xe.parentPathDisabled,ruleGroup:M,parentPath:Z,query:_});return}let fe=i(M,Z,_,pe);if(!fe){Y&&O({type:xe.onAddGroupFalse,ruleGroup:M,parentPath:Z,query:_});return}let $t=mo(_,fe,Z,{combinators:U,combinatorPreceding:fe.combinatorPreceding??void 0});Y&&O({type:xe.add,query:_,newQuery:$t,newGroup:fe,parentPath:Z}),Fe($t)},[U,Y,Fe,i,O,v,Se,X]),Gn=(0,K.useCallback)((M,Z,pe)=>{let _=Ye(v)(X.getState());if(!_)return;if(dt(pe,_)&&M!=="disabled"||Se){Y&&O({type:xe.pathDisabled,path:pe,prop:M,value:Z,query:_});return}let fe=Xo(_,M,Z,pe,{resetOnFieldChange:ht,resetOnOperatorChange:Xe,getRuleDefaultOperator:E,getValueSources:me,getRuleDefaultValue:we});Y&&O({type:xe.update,query:_,newQuery:fe,prop:M,value:Z,path:pe}),Fe(fe)},[Y,Fe,E,we,me,O,v,Se,X,ht,Xe]),xo=(0,K.useCallback)((M,Z)=>{let pe=Ye(v)(X.getState());if(!pe)return;if(dt(M,pe)||Se){Y&&O({type:xe.pathDisabled,path:M,query:pe});return}let _=Re(M,pe);if(_)if(u(_,M,pe,Z)){let fe=Yo(pe,M);Y&&O({type:xe.remove,query:pe,newQuery:fe,path:M,ruleOrGroup:_}),Fe(fe)}else Y&&O({type:xe.onRemoveFalse,ruleOrGroup:_,path:M,query:pe})},[Y,Fe,O,u,v,Se,X]),An=(0,K.useCallback)((M,Z,pe)=>{let _=Ye(v)(X.getState());if(!_)return;if(dt(M,_)||Se){Y&&O({type:xe.pathDisabled,oldPath:M,newPath:Z,query:_});return}let fe=Zo(_,M,Z,{clone:pe,combinators:U});Y&&O({type:xe.move,query:_,newQuery:fe,oldPath:M,newPath:Z,clone:pe}),Fe(fe)},[U,Y,Fe,O,v,Se,X]),Rr=(0,K.useMemo)(()=>$?"enabled":"disabled",[$]),gr=(0,K.useMemo)(()=>vt||ie?"enabled":"disabled",[vt,ie]),xr=(0,K.useMemo)(()=>J(Te)?{combinator:Te.combinator}:{},[Te]),{validationResult:Ct,validationMap:On}=(0,K.useMemo)(()=>{let M=typeof x=="function"&&Te?x(Te):ml;return{validationResult:M,validationMap:typeof M=="boolean"?fl:M}},[Te,x]),Gr=(0,K.useMemo)(()=>({addRuleToNewGroups:Ae,accessibleDescriptionGenerator:T,autoSelectField:te,autoSelectOperator:oe,classNames:je,combinators:U,controls:L,createRule:We,createRuleGroup:Pe,disabledPaths:Zt,enableDragAndDrop:$,fieldMap:ae,fields:z,dispatchQuery:Fe,getQuery:bn,getInputType:Me,getOperators:ce,getRuleClassname:l,getRuleGroupClassname:s,getValueEditorSeparator:r,getValueEditorType:C,getValues:qe,getValueSources:me,independentCombinators:vt,listsAsArrays:bt,parseNumbers:d,qbId:v,showCloneButtons:Ce,showCombinatorsBetweenRules:ie,showLockButtons:yt,showNotToggle:ue,showShiftActions:Je,validationMap:On}),[Ae,T,te,oe,U,je,L,We,Pe,Zt,$,ae,z,Fe,bn,Me,ce,l,s,C,qe,me,r,vt,bt,d,v,Ce,ie,yt,ue,Je,On]),Ar=(0,K.useMemo)(()=>({moveRule:An,onGroupAdd:xn,onGroupRemove:xo,onPropChange:Gn,onRuleAdd:gn,onRuleRemove:xo}),[An,xn,Gn,gn,xo]),Or=(0,K.useMemo)(()=>(0,rn.clsx)(w.queryBuilder,(0,rn.clsx)(je.queryBuilder),{[w.disabled]:Se,[w.valid]:typeof Ct=="boolean"&&Ct,[w.invalid]:typeof Ct=="boolean"&&!Ct}),[je.queryBuilder,Se,Ct]);return{...e,actions:Ar,rootGroup:Te,rootGroupDisabled:br,queryDisabled:Se,rqbContext:B,schema:Gr,translations:P,wrapperClassName:Or,dndEnabledAttr:Rr,inlineCombinatorsAttr:gr,combinatorPropObject:xr}}var de=require("react");var or=(e,t,o)=>{let n=he(e);if(t.operator==="between"||t.operator==="notBetween"){let r=[n,n];return o?r:lt(r.map(l=>l??""),",")}return n},sn=e=>{let[t]=(0,de.useState)(ge),{fields:o,baseField:n,operators:r,baseOperator:l,combinators:s=Ue,baseCombinator:a,translations:i,enableMountQueryChange:u=!0,controlClassnames:c,controlElements:p,getDefaultField:y,getDefaultOperator:f,getDefaultValue:h,getOperators:b,getValueEditorType:N,getValueSources:k,getInputType:V,getValues:F,autoSelectField:g=!0,autoSelectOperator:m=!0,addRuleToNewGroups:d=!1,enableDragAndDrop:G,listsAsArrays:x=!1,debugMode:O=!1,idGenerator:R=ge}=e,T=r??Oo,v=on({controlClassnames:c,controlElements:p,debugMode:O,enableDragAndDrop:G,enableMountQueryChange:u,translations:i}),{translations:B}=v,z=(0,de.useMemo)(()=>({id:B.fields.placeholderName,name:B.fields.placeholderName,value:B.fields.placeholderName,label:B.fields.placeholderLabel}),[B.fields.placeholderLabel,B.fields.placeholderName]),ae=(0,de.useMemo)(()=>o??[z],[z,o]),U=(0,de.useMemo)(()=>{let $=Array.isArray(ae)?Ie(ae,n):jt(ro(ae,n)).map(S=>({...ae[S],name:S,value:S})).sort((S,P)=>S.label.localeCompare(P.label));return Ne($)?g?Ft($):Ft([{label:B.fields.placeholderGroupLabel,options:[z]},...$]):g?Ze($):Ze([z,...$])},[g,n,z,ae,B.fields.placeholderGroupLabel]),ce=(0,de.useMemo)(()=>{if(!Array.isArray(ae)){let S=ro(ae,n);return g?S:{...S,[B.fields.placeholderName]:z}}let $={};return Ne(U)?U.forEach(S=>S.options.forEach(P=>{$[P.value??P.name]=be(P,n)})):U.forEach(S=>{$[S.value??S.name]=be(S,n)}),$},[g,n,z,U,ae,B.fields.placeholderName]),E=(0,de.useMemo)(()=>Ie(s,a),[a,s]),C=(0,de.useMemo)(()=>({id:B.operators.placeholderName,name:B.operators.placeholderName,value:B.operators.placeholderName,label:B.operators.placeholderLabel}),[B.operators.placeholderLabel,B.operators.placeholderName]),me=(0,de.useCallback)(($,{fieldData:S})=>{let P=Ie(T,l);if(S?.operators)P=Ie(S.operators,l);else if(b){let ie=b($,{fieldData:S});ie&&(P=Ie(ie,l))}return m||(Ne(P)?P=[{label:B.operators.placeholderGroupLabel,options:[C]},...P]:P=[C,...P]),Io(P)},[m,l,C,b,T,B.operators.placeholderGroupLabel]),qe=(0,de.useCallback)($=>{let S=ce[$];if(S?.defaultOperator)return S.defaultOperator;if(f)return typeof f=="function"?f($,{fieldData:S}):f;let P=me($,{fieldData:S})??[];return he(P)??""},[ce,f,me]),we=(0,de.useCallback)(($,S,{fieldData:P})=>P.valueEditorType?typeof P.valueEditorType=="function"?P.valueEditorType(S):P.valueEditorType:N?.($,S,{fieldData:P})??"text",[N]),Me=(0,de.useCallback)(($,S)=>Ho(ce[$],S,k),[ce,k]),We=(0,de.useCallback)(($,S,{fieldData:P})=>P?.values?Ie(P.values):F?Ie(F($,S,{fieldData:P})):[],[F]),Pe=(0,de.useCallback)($=>{let S=ce[$.field]??{};if(S?.defaultValue!==void 0&&S.defaultValue!==null)return S.defaultValue;if(h)return h($,{fieldData:S});let P="",ie=We($.field,$.operator,{fieldData:S});if($.valueSource==="field"){let ue=wt(S,U,$.operator);ue.length>0?P=or(ue,$,x):P=""}else if(ie.length){let ue=we($.field,$.operator,{fieldData:S});ue==="multiselect"?P=x?[]:"":(ue==="select"||ue==="radio")&&(P=or(ie,$,x))}else we($.field,$.operator,{fieldData:S})==="checkbox"&&(P=!1);return P},[ce,U,h,we,We,x]),je=(0,de.useCallback)(($,S,{fieldData:P})=>{if(V){let ie=V($,S,{fieldData:P});if(ie)return ie}return"text"},[V]),L=(0,de.useCallback)(()=>{let $="",S=U;if(S?.length>0&&S[0]){let Ce=he(S);Ce&&($=Ce)}if(y)if(typeof y=="function"){let Ce=y(S);Ce&&($=Ce)}else $=y;let P=qe($),ie=Me($,P)[0]??"value",ue={id:R(),field:$,operator:P,valueSource:ie,value:""},Je=Pe(ue);return{...ue,value:Je}},[U,y,qe,Pe,Me,R]),Y=(0,de.useCallback)($=>$?{id:R(),rules:d?[L()]:[],not:!1}:{id:R(),rules:d?[L()]:[],combinator:he(E)??"",not:!1},[d,E,L,R]);return{qbId:t,rqbContext:v,fields:U,fieldMap:ce,combinators:E,getOperatorsMain:me,getRuleDefaultOperator:qe,getValueEditorTypeMain:we,getValueSourcesMain:Me,getValuesMain:We,getRuleDefaultValue:Pe,getInputTypeMain:je,createRule:L,createRuleGroup:Y}};var Yt=(e,t)=>{};var Ve=require("clsx"),ee=require("react");var an=e=>{let{id:t,path:o,rule:n,schema:r,actions:{moveRule:l,onPropChange:s,onRuleRemove:a},disabled:i,parentDisabled:u,shiftUpDisabled:c,shiftDownDisabled:p,field:y,operator:f,value:h,valueSource:b,dragMonitorId:N="",dropMonitorId:k="",dndRef:V=null,dragRef:F=null,isDragging:g=!1,isOver:m=!1}=e,{classNames:d,fields:G,fieldMap:x,getInputType:O,getOperators:R,getValueEditorType:T,getValueEditorSeparator:v,getValueSources:B,getValues:z,validationMap:ae,enableDragAndDrop:U,getRuleClassname:ce}=r;rt("rule",!n),Yt(U,!!(N||k||V||F));let E=!!u||!!i,C=(0,ee.useMemo)(()=>n||{id:t,field:y??"",operator:f??"",value:h,valueSource:b},[y,t,f,n,h,b]),me=(0,ee.useMemo)(()=>({shiftActions:(0,Ve.clsx)(w.shiftActions,d.shiftActions),dragHandle:(0,Ve.clsx)(w.dragHandle,d.dragHandle),fields:(0,Ve.clsx)(w.fields,d.valueSelector,d.fields),operators:(0,Ve.clsx)(w.operators,d.valueSelector,d.operators),valueSource:(0,Ve.clsx)(w.valueSource,d.valueSelector,d.valueSource),value:(0,Ve.clsx)(w.value,d.value),cloneRule:(0,Ve.clsx)(w.cloneRule,d.actionElement,d.cloneRule),lockRule:(0,Ve.clsx)(w.lockRule,d.actionElement,d.lockRule),removeRule:(0,Ve.clsx)(w.removeRule,d.actionElement,d.removeRule)}),[d.shiftActions,d.dragHandle,d.valueSelector,d.fields,d.operators,d.valueSource,d.value,d.actionElement,d.cloneRule,d.lockRule,d.removeRule]),qe=(0,ee.useCallback)(X=>($e,Rt)=>{E||s(X,$e,o)},[E,s,o]),we=(0,ee.useCallback)((X,$e)=>{if(!E){let Rt=[...re(o),o[o.length-1]+1];l(o,Rt,!0)}},[E,l,o]),Me=(0,ee.useCallback)((X,$e)=>{s("disabled",!E,o)},[E,s,o]),We=(0,ee.useCallback)((X,$e)=>{E||a(o)},[E,a,o]),Pe=(0,ee.useCallback)((X,$e)=>{!E&&!c&&l(o,"up",X?.altKey)},[E,l,o,c]),je=(0,ee.useCallback)((X,$e)=>{!E&&!p&&l(o,"down",X?.altKey)},[E,l,o,p]),L=(0,ee.useMemo)(()=>x?.[C.field]??{name:C.field,value:C.field,label:C.field},[x,C.field]),Y=(0,ee.useMemo)(()=>L.inputType??O(C.field,C.operator,{fieldData:L}),[L,O,C.field,C.operator]),$=(0,ee.useMemo)(()=>R(C.field,{fieldData:L}),[L,R,C.field]),S=(0,ee.useMemo)(()=>ve($,C.operator),[$,C.operator]),P=S?.arity,ie=typeof P=="string"&&P==="unary"||typeof P=="number"&&P<2,ue=(0,ee.useMemo)(()=>typeof L.valueSources=="function"?L.valueSources(C.operator):L.valueSources??B(C.field,C.operator,{fieldData:L}),[L,B,C.field,C.operator]),Je=(0,ee.useMemo)(()=>C.valueSource==="field"?"select":T(C.field,C.operator,{fieldData:L}),[L,T,C.field,C.operator,C.valueSource]),Ce=(0,ee.useMemo)(()=>v(C.field,C.operator,{fieldData:L}),[L,v,C.field,C.operator]),yt=(0,ee.useMemo)(()=>C.valueSource==="field"?wt(L,G,C.operator):L.values??z(C.field,C.operator,{fieldData:L}),[L,G,z,C.field,C.operator,C.valueSource]),ht=(0,ee.useMemo)(()=>ue.map(X=>({name:X,value:X,label:X})),[ue]),Xe=(0,ee.useMemo)(()=>ae[t??""]??(typeof L.validator=="function"?L.validator(C):null),[L,t,C,ae]),te=(0,ee.useMemo)(()=>_t(Xe),[Xe]),oe=(0,ee.useMemo)(()=>L?.className??"",[L?.className]),Ae=(0,ee.useMemo)(()=>S?.className??"",[S?.className]),bt=(0,Ve.clsx)(ce(C,{fieldData:L}),oe,Ae,w.rule,d.rule,{[w.disabled]:E,[w.dndDragging]:g,[w.dndOver]:m},te);return{...e,classNames:me,cloneRule:we,disabled:E,dndRef:V,dragMonitorId:N,dragRef:F,dropMonitorId:k,fieldData:L,generateOnChangeHandler:qe,hideValueControls:ie,inputType:Y,operators:$,outerClassName:bt,removeRule:We,rule:C,shiftRuleUp:Pe,shiftRuleDown:je,toggleLockRule:Me,validationResult:Xe,valueEditorSeparator:Ce,valueEditorType:Je,values:yt,valueSourceOptions:ht,valueSources:ue}};var Ee=require("clsx"),le=require("react");var un=e=>{let{id:t,path:o,ruleGroup:n,schema:{qbId:r,accessibleDescriptionGenerator:l,classNames:s,combinators:a,createRule:i,createRuleGroup:u,disabledPaths:c,independentCombinators:p,validationMap:y,enableDragAndDrop:f,getRuleGroupClassname:h},actions:{onGroupAdd:b,onGroupRemove:N,onPropChange:k,onRuleAdd:V,moveRule:F},disabled:g,parentDisabled:m,shiftUpDisabled:d,shiftDownDisabled:G,combinator:x,rules:O,not:R,dragMonitorId:T="",dropMonitorId:v="",previewRef:B=null,dragRef:z=null,dropRef:ae=null,isDragging:U=!1,isOver:ce=!1}=e;rt("ruleGroup",!n),Yt(f,!!(T||v||B||z||ae));let E=!!m||!!g,C=(0,le.useMemo)(()=>n&&J(n)?n.combinator:n?he(a):x??he(a),[x,a,n]),me=(0,le.useMemo)(()=>n?{...n,...p?{}:{combinator:C}}:{rules:O,not:R},[C,p,R,n,O]),qe=(0,le.useMemo)(()=>({header:(0,Ee.clsx)(w.header,s.header,{[w.dndOver]:ce}),shiftActions:(0,Ee.clsx)(w.shiftActions,s.shiftActions),dragHandle:(0,Ee.clsx)(w.dragHandle,s.dragHandle),combinators:(0,Ee.clsx)(w.combinators,s.valueSelector,s.combinators),notToggle:(0,Ee.clsx)(w.notToggle,s.notToggle),addRule:(0,Ee.clsx)(w.addRule,s.actionElement,s.addRule),addGroup:(0,Ee.clsx)(w.addGroup,s.actionElement,s.addGroup),cloneGroup:(0,Ee.clsx)(w.cloneGroup,s.actionElement,s.cloneGroup),lockGroup:(0,Ee.clsx)(w.lockGroup,s.actionElement,s.lockGroup),removeGroup:(0,Ee.clsx)(w.removeGroup,s.actionElement,s.removeGroup),body:(0,Ee.clsx)(w.body,s.body)}),[s.actionElement,s.addGroup,s.addRule,s.body,s.cloneGroup,s.combinators,s.dragHandle,s.header,s.lockGroup,s.notToggle,s.removeGroup,s.shiftActions,s.valueSelector,ce]),we=(0,le.useCallback)((te,oe)=>{E||k("combinator",te,o)},[E,k,o]),Me=(0,le.useCallback)((te,oe,Ae)=>{E||k("combinator",te,o.concat([oe]))},[E,k,o]),We=(0,le.useCallback)((te,oe)=>{E||k("not",te,o)},[E,k,o]),Pe=(0,le.useCallback)((te,oe)=>{if(!E){let Ae=i();V(Ae,o,oe)}},[i,E,V,o]),je=(0,le.useCallback)((te,oe)=>{if(!E){let Ae=u(p);b(Ae,o,oe)}},[u,E,p,b,o]),L=(0,le.useCallback)((te,oe)=>{if(!E){let Ae=[...re(o),o[o.length-1]+1];F(o,Ae,!0)}},[E,F,o]),Y=(0,le.useCallback)((te,oe)=>{!E&&!d&&F(o,"up",te?.altKey)},[E,F,o,d]),$=(0,le.useCallback)((te,oe)=>{!E&&!G&&F(o,"down",te?.altKey)},[E,F,o,G]),S=(0,le.useCallback)((te,oe)=>{k("disabled",!E,o)},[E,k,o]),P=(0,le.useCallback)((te,oe)=>{E||N(o)},[E,N,o]),ie=(0,le.useMemo)(()=>y[t??""],[t,y]),ue=(0,le.useMemo)(()=>_t(ie),[ie]),Je=(0,le.useMemo)(()=>p?null:ve(a,C)?.className??"",[C,a,p]),Ce=(0,le.useMemo)(()=>h(me),[h,me]),yt=(0,le.useMemo)(()=>(0,Ee.clsx)(Ce,Je,w.ruleGroup,s.ruleGroup,{[w.disabled]:E,[w.dndDragging]:U},ue),[s.ruleGroup,Je,E,Ce,U,ue]),ht=(0,le.useMemo)(()=>{let te=[];for(let oe=0;oe<me.rules.length;oe++){let Ae=[...o,oe];te[oe]={path:Ae,disabled:E||c.some(bt=>Qe(Ae,bt))}}return te},[E,o,me.rules.length,c]),Xe=(0,le.useMemo)(()=>l({path:o,qbId:r}),[l,o,r]);return{...e,addGroup:je,addRule:Pe,accessibleDescription:Xe,classNames:qe,cloneGroup:L,combinator:C,disabled:E,dragMonitorId:T,dragRef:z,dropMonitorId:v,dropRef:ae,isDragging:U,isOver:ce,onCombinatorChange:we,onGroupAdd:b,onIndependentCombinatorChange:Me,onNotToggleChange:We,outerClassName:yt,parentDisabled:m,pathsMemo:ht,previewRef:B,removeGroup:P,ruleGroup:me,shiftGroupUp:Y,shiftGroupDown:$,toggleLockGroup:S,validationClassName:ue,validationResult:ie}};var nr=require("react"),cn=e=>{let{multiple:t,onChange:o}=e;return(0,nr.useMemo)(()=>t?r=>o(Array.from(r.target.selectedOptions).map(l=>l.value)):r=>o(r.target.value),[t,o])};var rr=require("react"),Ge=e=>(0,rr.useCallback)((t,o)=>{t?.preventDefault(),t?.stopPropagation(),e(t,o)},[e]);var lr=require("immer"),Ot=require("react");var pn=e=>{let{handleOnChange:t,inputType:o,operator:n,value:r,listsAsArrays:l,parseNumbers:s,values:a,type:i,skipHook:u}=e;(0,Ot.useEffect)(()=>{!u&&i!=="multiselect"&&!["between","notBetween","in","notIn"].includes(n)&&(Array.isArray(r)||o==="number"&&typeof r=="string"&&r.includes(","))&&t(q(r)[0]??"")},[t,o,n,u,i,r]);let c=(0,Ot.useMemo)(()=>q(r),[r]),p=(0,Ot.useCallback)((y,f)=>{let h=(0,lr.produce)(c,b=>{b[f]=H(y,{parseNumbers:s}),f===0&&(n==="between"||n==="notBetween")&&(b.length<2||typeof b[1]>"u")&&(b[1]=he(a))});t(l?h:lt(h,","))},[t,l,n,s,c,a]);return{valueAsArray:c,multiValueHandler:p}};var yo=require("react");var dn=e=>{let{handleOnChange:t,listsAsArrays:o=!1,multiple:n=!1,value:r}=e,l=(0,yo.useCallback)(a=>{if(n){let i=q(a);t(o?i:lt(i,","))}else t(a)},[t,o,n]),s=(0,yo.useMemo)(()=>n?q(r):r,[n,r]);return{onChange:l,val:s}};var sr=require("react"),tt=(0,sr.createContext)({});var ir=[],ur=e=>mt.createElement(ar.Provider,{context:nt,store:No},e.children),Al=e=>{let{setup:t,props:o}=e,n=ln(o,t),r=n.schema.controls.ruleGroup;return mt.createElement(tt.Provider,{key:n.dndEnabledAttr,value:n.rqbContext},mt.createElement("div",{role:"form",className:n.wrapperClassName,"data-dnd":n.dndEnabledAttr,"data-inlinecombinators":n.inlineCombinatorsAttr},mt.createElement(r,{translations:n.translations,ruleGroup:n.rootGroup,rules:n.rootGroup.rules,...n.combinatorPropObject,not:!!n.rootGroup.not,schema:n.schema,actions:n.actions,id:n.rootGroup.id,path:ir,disabled:n.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:n.queryDisabled,context:n.context})))},cr=e=>{let t=sn(e);return mt.createElement(ur,null,mt.createElement(Al,{props:e,setup:t}))};var se=Oe(require("react"));var mn=se.memo(e=>{let t=an(e),o=Ge(t.cloneRule),n=Ge(t.toggleLockRule),r=Ge(t.removeRule),l=Ge(t.shiftRuleUp),s=Ge(t.shiftRuleDown);return se.createElement("div",{ref:t.dndRef,"data-testid":Q.rule,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,className:t.outerClassName,"data-rule-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},se.createElement(pr,{...t,cloneRule:o,toggleLockRule:n,removeRule:r,shiftRuleUp:l,shiftRuleDown:s}))}),pr=se.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,fieldSelector:n,operatorSelector:r,valueSourceSelector:l,valueEditor:s,cloneRuleAction:a,lockRuleAction:i,removeRuleAction:u}},combinator:c}=e;return se.createElement(se.Fragment,null,e.schema.showShiftActions&&se.createElement(t,{testID:Q.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftRuleUp,shiftDown:e.shiftRuleDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),e.schema.enableDragAndDrop&&se.createElement(o,{testID:Q.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),c,se.createElement(n,{testID:Q.fields,options:e.schema.fields,title:e.translations.fields.title,value:e.rule.field,operator:e.rule.operator,className:e.classNames.fields,handleOnChange:e.generateOnChangeHandler("field"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectField||e.rule.field!==e.translations.fields.placeholderName)&&se.createElement(se.Fragment,null,se.createElement(r,{testID:Q.operators,field:e.rule.field,fieldData:e.fieldData,title:e.translations.operators.title,options:e.operators,value:e.rule.operator,className:e.classNames.operators,handleOnChange:e.generateOnChangeHandler("operator"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectOperator||e.rule.operator!==e.translations.operators.placeholderName)&&!e.hideValueControls&&se.createElement(se.Fragment,null,!["null","notNull"].includes(e.rule.operator)&&e.valueSources.length>1&&se.createElement(l,{testID:Q.valueSourceSelector,field:e.rule.field,fieldData:e.fieldData,title:e.translations.valueSourceSelector.title,options:e.valueSourceOptions,value:e.rule.valueSource??"value",className:e.classNames.valueSource,handleOnChange:e.generateOnChangeHandler("valueSource"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),se.createElement(s,{testID:Q.valueEditor,field:e.rule.field,fieldData:e.fieldData,title:e.translations.value.title,operator:e.rule.operator,value:e.rule.value,valueSource:e.rule.valueSource??"value",type:e.valueEditorType,inputType:e.inputType,values:e.values,listsAsArrays:e.schema.listsAsArrays,parseNumbers:e.schema.parseNumbers,separator:e.valueEditorSeparator,className:e.classNames.value,handleOnChange:e.generateOnChangeHandler("value"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}))),e.schema.showCloneButtons&&se.createElement(a,{testID:Q.cloneRule,label:e.translations.cloneRule.label,title:e.translations.cloneRule.title,className:e.classNames.cloneRule,handleOnClick:e.cloneRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),e.schema.showLockButtons&&se.createElement(i,{testID:Q.lockRule,label:e.translations.lockRule.label,title:e.translations.lockRule.title,className:e.classNames.lockRule,handleOnClick:e.toggleLockRule,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockRuleDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),se.createElement(u,{testID:Q.removeRule,label:e.translations.removeRule.label,title:e.translations.removeRule.title,className:e.classNames.removeRule,handleOnClick:e.removeRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}))});var j=Oe(require("react")),dr=require("react");var fn=j.memo(e=>{let t=un(e),o=Ge(t.addRule),n=Ge(t.addGroup),r=Ge(t.cloneGroup),l=Ge(t.toggleLockGroup),s=Ge(t.removeGroup),a=Ge(t.shiftGroupUp),i=Ge(t.shiftGroupDown);return j.createElement("div",{ref:t.previewRef,title:t.accessibleDescription,className:t.outerClassName,"data-testid":Q.ruleGroup,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,"data-rule-group-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},j.createElement("div",{ref:t.dropRef,className:t.classNames.header},j.createElement(mr,{...t,addRule:o,addGroup:n,cloneGroup:r,toggleLockGroup:l,removeGroup:s,shiftGroupUp:a,shiftGroupDown:i})),j.createElement("div",{className:t.classNames.body},j.createElement(fr,{...t,addRule:o,addGroup:n,cloneGroup:r,toggleLockGroup:l,removeGroup:s,shiftGroupUp:a,shiftGroupDown:i})))}),mr=j.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,combinatorSelector:n,notToggle:r,addRuleAction:l,addGroupAction:s,cloneGroupAction:a,lockGroupAction:i,removeGroupAction:u}}}=e;return j.createElement(j.Fragment,null,e.schema.showShiftActions&&e.path.length>0&&j.createElement(t,{key:Q.shiftActions,testID:Q.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftGroupUp,shiftDown:e.shiftGroupDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&e.schema.enableDragAndDrop&&j.createElement(o,{key:Q.dragHandle,testID:Q.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&j.createElement("span",{className:"statement"},"Any of the following are true..."),!e.schema.showCombinatorsBetweenRules&&!e.schema.independentCombinators&&j.createElement(n,{key:Q.combinators,testID:Q.combinators,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema}),e.schema.showNotToggle&&j.createElement(r,{key:Q.notToggle,testID:Q.notToggle,className:e.classNames.notToggle,title:e.translations.notToggle.title,label:e.translations.notToggle.label,checked:e.ruleGroup.not,handleOnChange:e.onNotToggleChange,level:e.path.length,disabled:e.disabled,path:e.path,context:e.context,validation:e.validationResult,schema:e.schema,ruleGroup:e.ruleGroup}),j.createElement(l,{key:Q.addRule,testID:Q.addRule,label:e.translations.addRule.label,title:e.translations.addRule.title,className:e.classNames.addRule,handleOnClick:e.addRule,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),j.createElement(s,{key:Q.addGroup,testID:Q.addGroup,label:e.translations.addGroup.label,title:e.translations.addGroup.title,className:e.classNames.addGroup,handleOnClick:e.addGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showCloneButtons&&e.path.length>=1&&j.createElement(a,{key:Q.cloneGroup,testID:Q.cloneGroup,label:e.translations.cloneRuleGroup.label,title:e.translations.cloneRuleGroup.title,className:e.classNames.cloneGroup,handleOnClick:e.cloneGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showLockButtons&&j.createElement(i,{key:Q.lockGroup,testID:Q.lockGroup,label:e.translations.lockGroup.label,title:e.translations.lockGroup.title,className:e.classNames.lockGroup,handleOnClick:e.toggleLockGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockGroupDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.path.length>0&&j.createElement(u,{key:Q.removeGroup,testID:Q.removeGroup,label:e.translations.removeGroup.label,title:e.translations.removeGroup.title,className:e.classNames.removeGroup,handleOnClick:e.removeGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}))}),fr=j.memo(e=>{let{schema:{controls:{combinatorSelector:t,inlineCombinator:o,ruleGroup:n,rule:r}}}=e;return j.createElement(j.Fragment,null,e.ruleGroup.rules.map((l,s,{length:a})=>{let i=e.pathsMemo[s],u=i.path,c=i.disabled||typeof l!="string"&&l.disabled,p=Qe([0],u),y=e.path.length===0&&s===a-1,f=typeof l=="string"?[...u,l].join("-"):l.id,h=!e.schema.independentCombinators&&e.schema.showCombinatorsBetweenRules;return j.createElement(dr.Fragment,{key:f},typeof l=="string"?j.createElement(o,{key:`${Q.inlineCombinator}-independent`,options:e.schema.combinators,value:l,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:b=>e.onIndependentCombinatorChange(b,s),rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:u,disabled:c,schema:e.schema}):D(l)?j.createElement(n,{key:Q.ruleGroup,id:l.id,schema:e.schema,actions:e.actions,path:u,translations:e.translations,ruleGroup:l,rules:l.rules,combinator:J(l)?l.combinator:void 0,not:!!l.not,disabled:c,parentDisabled:e.parentDisabled||e.disabled,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context}):j.createElement(r,{key:Q.rule,id:l.id,rule:l,field:l.field,operator:l.operator,value:l.value,valueSource:l.valueSource,schema:e.schema,actions:e.actions,path:u,disabled:c,parentDisabled:e.parentDisabled||e.disabled,translations:e.translations,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context,combinator:s===1&&h?j.createElement(o,{key:Q.inlineCombinator,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:u,disabled:e.disabled,schema:e.schema}):s>1&&h?j.createElement("span",{className:e.classNames.combinators},e.combinator):e.path.length===0&&h?j.createElement("span",{className:e.classNames.combinators},"Where"):j.createElement("span",{className:e.classNames.combinators})}))}))});var ho=Oe(require("react")),yn=e=>ho.createElement("div",{"data-testid":e.testID,className:e.className},ho.createElement("button",{disabled:e.disabled||e.shiftUpDisabled,onClick:e.shiftUp,title:e.titles?.shiftUp},e.labels?.shiftUp),ho.createElement("button",{disabled:e.disabled||e.shiftDownDisabled,onClick:e.shiftDown,title:e.titles?.shiftDown},e.labels?.shiftDown));var Le=Oe(require("react"));var hn=e=>{let{operator:t,value:o,handleOnChange:n,title:r,className:l,type:s="text",inputType:a="text",values:i=[],listsAsArrays:u,parseNumbers:c,fieldData:p,disabled:y,separator:f=null,testID:h,selectorComponent:b=e.schema.controls.valueSelector,...N}=e,{valueAsArray:k,multiValueHandler:V}=pn(e);if(t==="null"||t==="notNull")return null;let F=p?.placeholder??"",g=["in","notIn"].includes(t)?"text":a||"text";if((t==="between"||t==="notBetween")&&(s==="select"||s==="text")){let m=["from","to"].map((d,G)=>s==="text"?Le.createElement("input",{key:d,type:g,placeholder:F,value:k[G]??"",className:w.valueListItem,disabled:y,onChange:x=>V(x.target.value,G)}):Le.createElement(b,{...N,schema:e.schema,key:d,className:w.valueListItem,handleOnChange:x=>V(x,G),disabled:y,value:k[G]??he(i),options:i,listsAsArrays:u}));return Le.createElement("span",{"data-testid":h,className:l,title:r},m[0],f,m[1])}switch(s){case"select":case"multiselect":return Le.createElement(b,{...N,schema:e.schema,testID:h,className:l,title:r,handleOnChange:n,disabled:y,value:o,options:i,multiple:s==="multiselect",listsAsArrays:u});case"textarea":return Le.createElement("textarea",{"data-testid":h,placeholder:F,value:o,title:r,className:l,disabled:y,onChange:m=>n(m.target.value)});case"switch":case"checkbox":return Le.createElement("input",{"data-testid":h,type:"checkbox",className:l,title:r,onChange:m=>n(m.target.checked),checked:!!o,disabled:y});case"radio":return Le.createElement("span",{"data-testid":h,className:l,title:r},i.map(m=>Le.createElement("label",{key:m.name},Le.createElement("input",{type:"radio",value:m.name,disabled:y,checked:o===m.name,onChange:d=>n(d.target.value)}),m.label)))}return Le.createElement("input",{"data-testid":h,type:g,placeholder:F,value:o,title:r,className:l,disabled:y,onChange:m=>n(H(m.target.value,{parseNumbers:c}))})};var yr=Oe(require("react"));var ft=e=>{let{onChange:t,val:o}=dn(e),n=cn({multiple:e.multiple,onChange:t});return yr.createElement("select",{"data-testid":e.testID,className:e.className,value:o,title:e.title,disabled:e.disabled,multiple:!!e.multiple,onChange:n},en(e.options))};var nn={actionElement:Be,addGroupAction:Be,addRuleAction:Be,cloneGroupAction:Be,cloneRuleAction:Be,combinatorSelector:ft,dragHandle:Go,fieldSelector:ft,inlineCombinator:$o,lockGroupAction:Be,lockRuleAction:Be,notToggle:So,operatorSelector:ft,removeGroupAction:Be,removeRuleAction:Be,rule:mn,ruleGroup:fn,shiftActions:yn,valueEditor:hn,valueSelector:ft,valueSourceSelector:ft};0&&(module.exports={ActionElement,DragHandle,InlineCombinator,LogType,NotToggle,QueryBuilder,QueryBuilderContext,QueryBuilderStateContext,QueryBuilderStateProvider,Rule,RuleComponents,RuleGroup,RuleGroupBodyComponents,RuleGroupHeaderComponents,ShiftActions,TestID,ValueEditor,ValueSelector,add,convertFromIC,convertQuery,convertToIC,defaultCELValueProcessor,defaultCombinators,defaultCombinatorsExtended,defaultControlClassnames,defaultControlElements,defaultJoinChar,defaultMongoDBValueProcessor,defaultOperatorNegationMap,defaultOperators,defaultPlaceholderFieldGroupLabel,defaultPlaceholderFieldLabel,defaultPlaceholderFieldName,defaultPlaceholderOperatorGroupLabel,defaultPlaceholderOperatorLabel,defaultPlaceholderOperatorName,defaultRuleProcessorCEL,defaultRuleProcessorElasticSearch,defaultRuleProcessorJSONata,defaultRuleProcessorJsonLogic,defaultRuleProcessorMongoDB,defaultRuleProcessorParameterized,defaultRuleProcessorSQL,defaultRuleProcessorSpEL,defaultSpELValueProcessor,defaultTranslations,defaultValidator,defaultValueProcessor,defaultValueProcessorByRule,defaultValueProcessorCELByRule,defaultValueProcessorMongoDBByRule,defaultValueProcessorSpELByRule,filterFieldsByComparator,findPath,formatQuery,generateAccessibleDescription,generateID,getCommonAncestorPath,getCompatContextProvider,getFirstOption,getOption,getParentPath,getQuerySelectorById,getValidationClassNames,getValueSourcesUtil,groupInvalidReasons,isAncestor,isFlexibleOptionGroupArray,isFullOptionGroupArray,isOptionGroupArray,isPojo,isRuleGroup,isRuleGroupType,isRuleGroupTypeIC,isRuleOrGroupValid,isValidationResult,joinWith,jsonLogicAdditionalOperators,mergeClassnames,mergeTranslations,messages,move,nullFreeArray,numericRegex,objectEntries,objectKeys,parseNumber,pathIsDisabled,pathsAreEqual,prepareRule,prepareRuleGroup,prepareRuleOrGroup,queryBuilderStore,regenerateID,regenerateIDs,remove,rootPath,splitBy,standardClassnames,toArray,toFlatOptionArray,toFullOption,toFullOptionList,toFullOptionMap,toOptions,transformQuery,trimIfString,uniqByIdentifier,uniqByName,uniqOptGroups,uniqOptList,update,useControlledOrUncontrolled,useDeprecatedProps,useMergedContext,usePreferAnyProp,usePreferProp,usePrevious,useQueryBuilderSchema,useQueryBuilderSelector,useQueryBuilderSetup,useReactDndWarning,useRule,useRuleGroup,useSelectElementChangeHandler,useStopEventPropagation,useValueEditor,useValueSelector});
//# sourceMappingURL=react-querybuilder.cjs.production.js.map