import*as Uo from"react";var Ve=e=>Uo.createElement("button",{type:"button","data-testid":e.testID,disabled:e.disabled&&!e.disabledTranslation,className:e.className,title:e.disabledTranslation&&e.disabled?e.disabledTranslation.title:e.title,onClick:t=>e.handleOnClick(t)},e.disabledTranslation&&e.disabled?e.disabledTranslation.label:e.label);import*as Ho from"react";import{forwardRef as ln}from"react";var _o=ln((e,t)=>Ho.createElement("span",{"data-testid":e.testID,ref:t,className:e.className,title:e.title},e.label));import*as Co from"react";var Jo="~",jt="------",Ut=Jo,an=jt,sn=jt,Ht=Jo,un=jt,pn=jt,_t=",",Jt={fields:{title:"Fields",placeholderName:Ut,placeholderLabel:an,placeholderGroupLabel:sn},operators:{title:"Operators",placeholderName:Ht,placeholderLabel:un,placeholderGroupLabel:pn},value:{title:"Value"},removeRule:{label:"\u2A2F",title:"Remove rule"},removeGroup:{label:"\u2A2F",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"\u29C9",title:"Clone rule"},cloneRuleGroup:{label:"\u29C9",title:"Clone group"},shiftActionUp:{label:"\u02C4",title:"Shift up"},shiftActionDown:{label:"\u02C5",title:"Shift down"},dragHandle:{label:"\u205E\u205E",title:"Drag handle"},lockRule:{label:"\u{1F513}",title:"Lock rule"},lockGroup:{label:"\u{1F513}",title:"Lock group"},lockRuleDisabled:{label:"\u{1F512}",title:"Unlock rule"},lockGroupDisabled:{label:"\u{1F512}",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},Ko=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],Gl={"=":"!=","!=":"=","<":">=","<=":">",">":"<=",">=":"<",beginsWith:"doesNotBeginWith",doesNotBeginWith:"beginsWith",endsWith:"doesNotEndWith",doesNotEndWith:"endsWith",contains:"doesNotContain",doesNotContain:"contains",between:"notBetween",notBetween:"between",in:"notIn",notIn:"in",notNull:"null",null:"notNull"},qe=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}],xl=[...qe,{name:"xor",value:"xor",label:"XOR"}],E={queryBuilder:"queryBuilder",ruleGroup:"ruleGroup",header:"ruleGroup-header",body:"ruleGroup-body",combinators:"ruleGroup-combinators",addRule:"ruleGroup-addRule",addGroup:"ruleGroup-addGroup",cloneRule:"rule-cloneRule",cloneGroup:"ruleGroup-cloneGroup",removeGroup:"ruleGroup-remove",notToggle:"ruleGroup-notToggle",rule:"rule",fields:"rule-fields",operators:"rule-operators",value:"rule-value",removeRule:"rule-remove",betweenRules:"betweenRules",valid:"queryBuilder-valid",invalid:"queryBuilder-invalid",shiftActions:"shiftActions",dndDragging:"dndDragging",dndOver:"dndOver",dndCopy:"dndCopy",dragHandle:"queryBuilder-dragHandle",disabled:"queryBuilder-disabled",lockRule:"rule-lock",lockGroup:"ruleGroup-lock",valueSource:"rule-valueSource",valueListItem:"rule-value-list-item",branches:"queryBuilder-branches"},zo={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:""},Kt={empty:"empty",invalidCombinator:"invalid combinator",invalidIndependentCombinators:"invalid independent combinators"},L={rule:"rule",ruleGroup:"rule-group",inlineCombinator:"inline-combinator",addGroup:"add-group",removeGroup:"remove-group",cloneGroup:"clone-group",cloneRule:"clone-rule",addRule:"add-rule",removeRule:"remove-rule",combinators:"combinators",fields:"fields",operators:"operators",valueEditor:"value-editor",notToggle:"not-toggle",shiftActions:"shift-actions",dragHandle:"drag-handle",lockRule:"lock-rule",lockGroup:"lock-group",valueSourceSelector:"value-source-selector"},me={parentPathDisabled:"action aborted: parent path disabled",pathDisabled:"action aborted: path is disabled",queryUpdate:"query updated",onAddRuleFalse:"onAddRule callback returned false",onAddGroupFalse:"onAddGroup callback returned false",onMoveRuleFalse:"onMoveRule callback returned false",onMoveGroupFalse:"onMoveGroup callback returned false",onRemoveFalse:"onRemove callback returned false",add:"rule or group added",remove:"rule or group removed",update:"rule or group updated",move:"rule or group moved"};var Xo=e=>{let{component:t,...o}=e;return Co.createElement("div",{className:E.betweenRules,"data-testid":L.inlineCombinator},Co.createElement(t,{...o,testID:L.combinators}))};import*as To from"react";var Yo=e=>To.createElement("label",{"data-testid":e.testID,className:e.className,title:e.title},To.createElement("input",{type:"checkbox",onChange:t=>e.handleOnChange(t.target.checked),checked:!!e.checked,disabled:e.disabled}),e.label);import*as ut from"react";import{Provider as sl}from"react-redux";var Ye={errorInvalidIndependentCombinatorsProp:"QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorUnnecessaryIndependentCombinatorsProp:"QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorDeprecatedRuleGroupProps:"A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",errorDeprecatedRuleProps:"A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",errorBothQueryDefaultQuery:"QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",errorUncontrolledToControlled:"QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorControlledToUncontrolled:"QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorEnabledDndWithoutReactDnD:"QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd."};import{createDispatchHook as Rn,createStoreHook as gn}from"react-redux";import{configureStore as yn}from"@reduxjs/toolkit";import*as Pt from"react";import{createSelectorHook as bn}from"react-redux";import{createSlice as cn}from"@reduxjs/toolkit";var dn={},mt=cn({name:"queries",initialState:dn,reducers:{setQueryState:(e,{payload:{qbId:t,query:o}})=>{e[t]=o}},selectors:{getQuerySelectorById:(e,t)=>e[t]}});import{createSlice as mn}from"@reduxjs/toolkit";var fn={[Ye.errorInvalidIndependentCombinatorsProp]:!1,[Ye.errorUnnecessaryIndependentCombinatorsProp]:!1,[Ye.errorDeprecatedRuleGroupProps]:!1,[Ye.errorDeprecatedRuleProps]:!1,[Ye.errorBothQueryDefaultQuery]:!1,[Ye.errorUncontrolledToControlled]:!1,[Ye.errorControlledToUncontrolled]:!1,[Ye.errorEnabledDndWithoutReactDnD]:!1},St=mn({name:"warnings",initialState:fn,reducers:{rqbWarn:(e,{payload:t})=>{e[t]||(console.error(t),e[t]=!0)}}});var hn={queries:mt.getInitialState(),warnings:St.getInitialState()},Zo=yn({reducer:{queries:mt.reducer,warnings:St.reducer},preloadedState:hn,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),ft=Pt.createContext(null),er=bn(ft),tr=(e,t)=>{let o=Pt.useContext(Me);return er(e,t)??o?.initialQuery},Ql=e=>{let t=Pt.useContext(Me);return er(rt(e?.schema.qbId??t.qbId??""))??t?.initialQuery},rt=e=>t=>mt.selectors.getQuerySelectorById({queries:t.queries},e);var zt=({payload:e,onQueryChange:t})=>o=>{o(mt.actions.setQueryState(e)),typeof t=="function"&&t(e.query)},yt=Rn(ft),or=gn(ft),{rqbWarn:Wl}=St.actions;import{useRef as Gn}from"react";var rr=e=>{let t=Gn({value:e,prev:null}),o=t.current.value;return e!==o&&(t.current={value:e,prev:o}),t.current.prev};var nr=e=>{let t=yt(),{defaultQuery:o,queryProp:n}=e,r=rr(!!n)};function bt(e,t,o){let n=yt()}import{forwardRef as Vn,useCallback as qn,useContext as Mn,useMemo as yo}from"react";var xn=(e,t=_t)=>typeof e=="string"?e.split(`\\${t}`).map(o=>o.split(t)).reduce((o,n,r)=>r===0?n:[...o.slice(0,o.length-1),`${o[o.length-1]}${t}${n[0]}`,...n.slice(1)],[]):[],ht=(e,t=_t)=>e.map(o=>`${o??""}`.replaceAll(t[0],`\\${t[0]}`)).join(t),W=e=>typeof e=="string"?e.trim():e,V=e=>Array.isArray(e)?e.map(W):typeof e=="string"?xn(e,_t).filter(t=>!/^\s*$/.test(t)).map(t=>t.trim()):typeof e=="number"?[e]:[],ta=e=>e.every(t=>t===!1||(t??!1)!==!1);import{numericRegex as vn}from"numeric-quantity";var lr=new RegExp(vn.source.replace(/^\^/,"^\\s*").replace(/\$$/,"\\s*$")),se=e=>e===null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype;var F=e=>se(e)&&Array.isArray(e.rules),J=e=>F(e)&&typeof e.combinator=="string",We=e=>F(e)&&typeof e.combinator>"u";var ar=e=>F(e)?sr(e):e,sr=e=>{let t=[],o=r=>t.push(ar(r)),n=0;for(let r=0;r<e.rules.length;r+=2)if(e.rules.length===1)o(e.rules[0]);else if(e.rules[r+1]==="and"){n=r;let l=1;for(;e.rules[n+l]==="and";)r+=2,l+=2;t.push({rules:e.rules.slice(n,r+1).map(ar)}),r-=2}else e.rules[r+1]==="or"&&(r===0||r===e.rules.length-3?((r===0||e.rules[r-1]==="or")&&o(e.rules[r]),o(e.rules[r+1]),r===e.rules.length-3&&o(e.rules[r+2])):(e.rules[r-1]==="and"||o(e.rules[r]),o(e.rules[r+1])));return t.length===1&&typeof t[0]=="object"&&F(t[0])?{...e,...t[0]}:{...e,rules:t}},Rt=e=>{if(J(e))return e;let t=sr(e),o=t.rules.map(l=>typeof l=="string"||!F(l)?l:Rt(l)),n=o.length<2?"and":o[1],r=o.filter(l=>typeof l!="string");return{...t,combinator:n,rules:r}},ir=e=>{if(We(e))return e;let{combinator:t,...o}=e,n=[],{length:r}=e.rules;return e.rules.forEach((l,a)=>{F(l)?n.push(ir(l)):n.push(l),t&&a<r-1&&n.push(t)}),{...o,rules:n}};function ia(e){return We(e)?Rt(e):ir(e)}var da=e=>{let t={},o=r=>{},n=r=>{let l=[];if(r.rules.length===0)l.push(Kt.empty);else if(!J(r)){let a=!1;for(let p=0;p<r.rules.length&&!a;p++)(p%2===0&&typeof r.rules[p]=="string"||p%2===1&&typeof r.rules[p]!="string"||p%2===1&&typeof r.rules[p]=="string"&&!qe.map(f=>f.name).includes(r.rules[p]))&&(a=!0);a&&l.push(Kt.invalidIndependentCombinators)}J(r)&&!qe.map(a=>a.name).includes(r.combinator)&&r.rules.length>1&&l.push(Kt.invalidCombinator),r.id&&(l.length?t[r.id]={valid:!1,reasons:l}:t[r.id]=!0),r.rules.forEach(a=>{typeof a=="string"||(F(a)?n(a):o(a))})};return n(e),t};import{produce as cr}from"immer";var ur=e=>se(e)&&"name"in e&&typeof e.name=="string",pr=e=>se(e)&&"value"in e&&typeof e.value=="string";function be(e,t){return cr(n=>{let r={},l=!!t;if(ur(n)&&!pr(n)?(r.value=n.name,l=!0):!ur(n)&&pr(n)&&(r.name=n.value,l=!0),l)return Object.assign({},t,n,r)})(e)}function je(e,t){return Array.isArray(e)?cr(n=>{if(Se(n))for(let r of n)r.options.forEach((l,a)=>r.options[a]=be(l,t));else n.forEach((r,l)=>n[l]=be(r,t))})(e):[]}function $o(e,t){return Object.fromEntries(Object.entries(e).map(([o,n])=>[o,be(n,t)]))}var Ga=e=>at(e),at=e=>{let t=new Set,o=[];return e.forEach(n=>{t.has(n.value??n.name)||(t.add(n.value??n.name),o.push(n))}),e.length===o.length?e:o},Xt=e=>{let t=new Set,o=new Set,n=[];return e.forEach(r=>{if(!t.has(r.label)){t.add(r.label);let l=[];r.options.forEach(a=>{o.has(a.value??a.name)||(o.add(a.value??a.name),l.push(be(a)))}),n.push({...r,options:l})}}),n},dr=e=>Se(e)?Xt(e):at(e.map(t=>be(t)));var Yt=e=>Array.isArray(e)&&e.length>0&&se(e[0])&&"options"in e[0]&&Array.isArray(e[0].options),Se=e=>{if(Array.isArray(e)){for(let t of e)if(se(t)&&"options"in t)for(let o of t.options)return!!(se(o)&&("name"in o||"value"in o))}return!1},Aa=e=>{if(Array.isArray(e)){for(let t of e)if(se(t)&&"options"in t)for(let o of t.options)return!!(se(o)&&"name"in o&&"value"in o)}return!1},Oe=(e,t)=>(Yt(e)?e.flatMap(o=>o.options):e).find(o=>o.value===t||o.name===t),ue=e=>{if(!Array.isArray(e)||e.length===0)return null;if(Se(e)){for(let t of e)if(t.options.length>0)return t.options[0].value??t.options[0].name;return null}return e[0].value??e[0].name},mr=e=>at(Yt(e)?e.flatMap(t=>t.options):e);var fr=(e,t,o)=>{let n=be(e),r=be(o);return n.value===r.value?!1:typeof n.comparator=="string"?n[n.comparator]===r[n.comparator]:n.comparator?.(r,t)??!1},Zt=(e,t,o)=>{if(!e.comparator){let n=r=>(r.value??r.name)!==(e.value??e.name);return Se(t)?t.map(r=>({...r,options:r.options.filter(n)})):t.filter(n)}return Se(t)?t.map(n=>({...n,options:n.options.filter(r=>fr(e,o,r))})).filter(n=>n.options.length>0):t.filter(n=>fr(e,o,n))};import{numericQuantity as On}from"numeric-quantity";var j=(e,t={})=>{if(!t.parseNumbers||typeof e=="bigint"||typeof e=="number")return e;if(t.parseNumbers==="native")return parseFloat(e);let o=On(e,{allowTrailingInvalid:t.parseNumbers==="enhanced",romanNumerals:!0,round:!1});return isNaN(o)?e:o};var eo=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},No={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},So={and:"&&",or:"||"},An={startsWith:(e,t)=>typeof e=="string"&&e.startsWith(t),endsWith:(e,t)=>typeof e=="string"&&e.endsWith(t)},Po=e=>({...e,rules:e.rules.map(t=>{if(typeof t=="string")return t;if(F(t))return Po(t);if(Array.isArray(t.value))return{...t,value:t.value.map(n=>j(n,{parseNumbers:!0}))};let o=V(t.value).map(n=>j(n,{parseNumbers:!0}));if(o.every(n=>typeof n=="number")){if(o.length>1)return{...t,value:o};if(o.length===1)return{...t,value:o[0]}}return t})}),Pe=e=>typeof e=="string"&&e.length>0||typeof e=="number"&&!isNaN(e)||typeof e!="string"&&typeof e!="number",Q=(e,t)=>t&&(typeof e=="number"||typeof e=="bigint"||typeof e=="string"&&lr.test(e)),yr=e=>e.length>=3,nt=(e=["",""])=>Array.isArray(e)?e:typeof e=="string"?[e,e]:e??["",""],Ze=e=>e===null||typeof e>"u"||e==="";var to=e=>/^(does)?not/i.test(e),st=(e,t)=>typeof e!="string"||!t?e:e.replaceAll('"','\\"'),gt=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l}={})=>{let a=n==="field",p=t.replace(/^=$/,"=="),f=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||Q(o,l);switch(p){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${p} ${a||f?W(o):`"${st(o,r)}"`}`;case"contains":case"doesNotContain":return`${to(p)?"!":""}${e}.contains(${a?W(o):`"${st(o,r)}"`})`;case"beginsWith":case"doesNotBeginWith":return`${to(p)?"!":""}${e}.startsWith(${a?W(o):`"${st(o,r)}"`})`;case"endsWith":case"doesNotEndWith":return`${to(p)?"!":""}${e}.endsWith(${a?W(o):`"${st(o,r)}"`})`;case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let s=to(p),m=V(o);return`${s?"!(":""}${e} in [${m.map(u=>a||Q(u,l)?`${W(u)}`:`"${st(u,r)}"`).join(", ")}]${s?")":""}`}case"between":case"notBetween":{let s=V(o);if(s.length>=2&&!Ze(s[0])&&!Ze(s[1])){let[m,u]=s,c=Q(m,!0)?j(m,{parseNumbers:!0}):NaN,y=Q(u,!0)?j(u,{parseNumbers:!0}):NaN,R=isNaN(c)?a?`${m}`:`"${st(m,r)}"`:c,i=isNaN(y)?a?`${u}`:`"${st(u,r)}"`:y;if(R===c&&i===y&&y<c){let d=y;i=c,R=d}return t==="between"?`(${e} >= ${R} && ${e} <= ${i})`:`(${e} < ${R} || ${e} > ${i})`}else return""}}return""};var Gt=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{let l=n==="field",a=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||Q(o,r);if(t==="="&&!l)return`{"${e}":${a?W(o):JSON.stringify(o)}}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{let p=No[t];return l?`{"$expr":{"${p}":["$${e}","$${o}"]}}`:`{"${e}":{"${p}":${a?W(o):JSON.stringify(o)}}}`}case"contains":return l?`{"$where":"this.${e}.includes(this.${o})"}`:`{"${e}":{"$regex":${JSON.stringify(o)}}}`;case"beginsWith":return l?`{"$where":"this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$regex":${JSON.stringify(`^${o}`)}}}`;case"endsWith":return l?`{"$where":"this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$regex":${JSON.stringify(`${o}$`)}}}`;case"doesNotContain":return l?`{"$where":"!this.${e}.includes(this.${o})"}`:`{"${e}":{"$not":{"$regex":${JSON.stringify(o)}}}}`;case"doesNotBeginWith":return l?`{"$where":"!this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":${JSON.stringify(`^${o}`)}}}}`;case"doesNotEndWith":return l?`{"$where":"!this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":${JSON.stringify(`${o}$`)}}}}`;case"null":return`{"${e}":null}`;case"notNull":return`{"${e}":{"$ne":null}}`;case"in":case"notIn":{let p=V(o);return l?`{"$where":"${t==="notIn"?"!":""}[${p.map(f=>`this.${f}`).join(",")}].includes(this.${e})"}`:`{"${e}":{"${No[t]}":[${p.map(f=>Q(f,r)?`${W(f)}`:JSON.stringify(f)).join(",")}]}}`}case"between":case"notBetween":{let p=V(o);if(p.length>=2&&Pe(p[0])&&Pe(p[1])){let[f,s]=p,m=Q(f,!0)?j(f,{parseNumbers:!0}):NaN,u=Q(s,!0)?j(s,{parseNumbers:!0}):NaN,c=l||!isNaN(m)?`${f}`:`${JSON.stringify(f)}`,y=l||!isNaN(u)?`${s}`:`${JSON.stringify(s)}`;return t==="between"?l?`{"$and":[{"$expr":{"$gte":["$${e}","$${c}"]}},{"$expr":{"$lte":["$${e}","$${y}"]}}]}`:`{"${e}":{"$gte":${c},"$lte":${y}}}`:l?`{"$or":[{"$expr":{"$lt":["$${e}","$${c}"]}},{"$expr":{"$gt":["$${e}","$${y}"]}}]}`:`{"$or":[{"${e}":{"$lt":${c}}},{"${e}":{"$gt":${y}}}]}`}else return""}}return""};var oo=e=>/^(does)?not/i.test(e),Fo=(e,t)=>t?`!(${e})`:`${e}`,it=(e,t)=>typeof e!="string"||!t?e:e.replaceAll("'","\\'"),xt=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l}={})=>{let a=n==="field",p=t.replace(/^=$/,"=="),f=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||Q(o,l);switch(p){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${p} ${a||f?W(o):`'${it(o,r)}'`}`;case"contains":case"doesNotContain":return Fo(`${e} matches ${a||f?W(o):`'${it(o,r)}'`}`,oo(p));case"beginsWith":case"doesNotBeginWith":{let s=a?`'^'.concat(${W(o)})`:`'${typeof o=="string"&&!o.startsWith("^")||f?"^":""}${it(o,r)}'`;return Fo(`${e} matches ${s}`,oo(p))}case"endsWith":case"doesNotEndWith":{let s=a?`${W(o)}.concat('$')`:`'${it(o,r)}${typeof o=="string"&&!o.endsWith("$")||f?"$":""}'`;return Fo(`${e} matches ${s}`,oo(p))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let s=oo(p)?"!":"",m=V(o);return m.length>0?`${s}(${m.map(u=>`${e} == ${a||Q(u,l)?`${W(u)}`:`'${it(u,r)}'`}`).join(" or ")})`:""}case"between":case"notBetween":{let s=V(o);if(s.length>=2&&!Ze(s[0])&&!Ze(s[1])){let[m,u]=s,c=Q(m,!0)?j(m,{parseNumbers:!0}):NaN,y=Q(u,!0)?j(u,{parseNumbers:!0}):NaN,R=isNaN(c)?a?`${m}`:`'${it(m,r)}'`:c,i=isNaN(y)?a?`${u}`:`'${it(u,r)}'`:y;if(R===c&&i===y&&y<c){let d=y;i=c,R=d}return t==="between"?`(${e} >= ${R} and ${e} <= ${i})`:`(${e} < ${R} or ${e} > ${i})`}else return""}}return""};var Cn=(e,t,o)=>o&&typeof e=="string"?e.replaceAll(`${t}`,`${t}${t}`):e,et=({operator:e,value:t,valueSource:o},{escapeQuotes:n,parseNumbers:r,quoteFieldNamesWith:l,quoteValuesWith:a}={})=>{let p=o==="field",[f,s]=nt(l),m=e.toLowerCase(),u=a||"'",c=i=>Cn(i,u,n),y=i=>`${u}${c(i)}${u}`,R=i=>`${f}${i}${s}`;switch(m){case"null":case"notnull":return"";case"in":case"notin":{let i=V(t);return i.length>0?`(${i.map(d=>p?R(d):Q(d,r)?`${W(d)}`:`${y(d)}`).join(", ")})`:""}case"between":case"notbetween":{let i=V(t);if(i.length>=2&&Pe(i[0])&&Pe(i[1])){let[d,k]=i;return p?`${R(d)} and ${R(k)}`:Q(d,r)&&Q(k,r)?`${W(d)} and ${W(k)}`:`${y(d)} and ${y(k)}`}return""}case"contains":case"doesnotcontain":return p?`${u}%${u} || ${R(t)} || ${u}%${u}`:`${u}%${c(t)}%${u}`;case"beginswith":case"doesnotbeginwith":return p?`${R(t)} || ${u}%${u}`:`${u}${c(t)}%${u}`;case"endswith":case"doesnotendwith":return p?`${u}%${u} || ${R(t)}`:`${u}%${c(t)}${u}`}return typeof t=="boolean"?t?"TRUE":"FALSE":p?R(t):Q(t,r)?`${W(t)}`:`${y(t)}`};var Tn={"<":"lt","<=":"lte",">":"gt",">=":"gte"},ro=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,Do=e=>e?.replace(/('|\\)/g,"\\$1"),$n={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},Nn=(e,t,o)=>{let n=`doc['${e}'].${$n[t]??t}(doc['${o}'])`;return t.startsWith("d")?`!${n}`:n},Ft=(e,t)=>typeof e=="boolean"?e:Q(e,t)?j(e,{parseNumbers:t}):e,no=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{if(n==="field"){if(V(o).some(a=>typeof a!="string"))return!1;let l=Do(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{let a=t==="="?"==":t,p=Do(o);return p?{bool:{filter:{script:{script:`doc['${l}'] ${a} doc['${p}']`}}}}:!1}case"in":case"notIn":{let a=V(o);if(a.length>0){let p=a.map(f=>({bool:{filter:{script:{script:`doc['${l}'] == doc['${f}']`}}}}));return{bool:t==="in"?{should:p}:{must_not:p}}}return!1}case"between":case"notBetween":{let a=V(o);if(a.length>=2&&a[0]&&a[1]){let p=`doc['${l}'] >= doc['${a[0]}'] && doc['${l}'] <= doc['${a[1]}']`;return{bool:{filter:{script:{script:t==="notBetween"?`!(${p})`:p}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{let a=Do(o);return a?{bool:{filter:{script:{script:Nn(l,t,a)}}}}:!1}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[Tn[t]]:Ft(o,r)}}};case"=":return{term:{[e]:Ft(o,r)}};case"!=":return{bool:{must_not:{term:{[e]:Ft(o,r)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{let l=V(o).map(a=>Ft(a,r));if(l.length>0){let a=l.map(p=>({term:{[e]:Ft(p,r)}}));return{bool:t==="in"?{should:a}:{must_not:a}}}return!1}case"between":case"notBetween":{let l=V(o);if(l.length>=2&&Pe(l[0])&&Pe(l[1])){let[a,p]=l;if(Q(a,!0)&&Q(p,!0)){let f=j(a,{parseNumbers:!0}),s=j(p,{parseNumbers:!0});if(s<f){let m=s;p=f,a=m}else a=f,p=s}return ro(t,{range:{[e]:{gte:a,lte:p}}})}return!1}case"contains":case"doesNotContain":return ro(t,{regexp:{[e]:{value:`.*${o}.*`}}});case"beginsWith":case"doesNotBeginWith":return ro(t,{regexp:{[e]:{value:`${o}.*`}}});case"endsWith":case"doesNotEndWith":return ro(t,{regexp:{[e]:{value:`.*${o}`}}})}return!1};var lo=e=>/^(does)?not/i.test(e),Dt=(e,t)=>`"${typeof e!="string"||!t?e:e.replaceAll('"','\\"')}"`,wt=(e,t)=>t?`$not(${e})`:`${e}`,br=e=>`${e}`.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),ao=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l=!0,quoteFieldNamesWith:a=["",""]}={})=>{let p=n==="field",f=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||Q(o,l),[s,m]=nt(a),u=c=>`${s}${c}${m}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return`${u(e)} ${t} ${p?u(W(o)):f?W(o):Dt(o,r)}`;case"contains":case"doesNotContain":return wt(`$contains(${u(e)}, ${p?u(W(o)):Dt(o,r)})`,lo(t));case"beginsWith":case"doesNotBeginWith":return wt(p?`$substring(${u(e)}, 0, $length(${u(W(o))})) = ${u(W(o))}`:`$contains(${u(e)}, /^${br(o)}/)`,lo(t));case"endsWith":case"doesNotEndWith":return wt(p?`$substring(${u(e)}, $length(${u(e)}) - $length(${u(W(o))})) = ${u(W(o))}`:`$contains(${u(e)}, /${br(o)}$/)`,lo(t));case"null":return`${u(e)} = null`;case"notNull":return`${u(e)} != null`;case"in":case"notIn":{let c=V(o);return wt(`${u(e)} in [${c.map(y=>p?`${u(W(y))}`:Q(y,l)?`${W(y)}`:Dt(y,r)).join(", ")}]`,lo(t))}case"between":case"notBetween":{let c=V(o);if(c.length>=2&&!Ze(c[0])&&!Ze(c[1])){let[y,R]=c,i=Q(y,!0)?j(y,{parseNumbers:!0}):NaN,d=Q(R,!0)?j(R,{parseNumbers:!0}):NaN,k=isNaN(i)?p?`${y}`:y:i,D=isNaN(d)?p?`${R}`:R:d;if(k===i&&D===d&&d<i){let h=d;D=i,k=h}let S=Q(y,l)&&Q(R,l),G=`${u(e)} >= ${p?u(y):S?k:Dt(k,r)} and ${u(e)} <= ${p?u(R):S?D:Dt(D,r)}`;return t==="between"?`(${G})`:wt(G,!0)}else return""}}return""};var Sn=e=>e.replace(/^(=)$/,"$1=").replace(/^notNull$/i,"!=").replace(/^null$/i,"=="),Et=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,so=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{let l=n==="field",a={var:e},p=f=>l?{var:`${f}`}:Q(f,r)?j(f,{parseNumbers:r}):f;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[Sn(t)]:[a,p(o)]};case"null":case"notNull":return{[`${t==="notNull"?"!":"="}=`]:[a,null]};case"in":case"notIn":{let f=V(o).map(p);return Et(t,{in:[a,f]})}case"between":case"notBetween":{let f=V(o);if(f.length>=2&&Pe(f[0])&&Pe(f[1])){let[s,m]=f;if(!l&&Q(s,!0)&&Q(m,!0)){let c=j(s,{parseNumbers:!0}),y=j(m,{parseNumbers:!0});if(y<c){let R=y;m=c,s=R}else s=c,m=y}else l&&(s={var:s},m={var:m});return Et(t,{"<=":[s,a,m]})}return!1}case"contains":case"doesNotContain":{let f={in:[p(o),a]};return Et(t,f)}case"beginsWith":case"doesNotBeginWith":{let f={startsWith:[a,p(o)]};return Et(t,f)}case"endsWith":case"doesNotEndWith":{let f={endsWith:[a,p(o)]};return Et(t,f)}}return!1};var kt=(e,t,o)=>{let{fieldData:n,format:r,getNextNamedParam:l,parseNumbers:a,paramPrefix:p,paramsKeepPrefix:f,numberedParams:s,quoteFieldNamesWith:m=["",""],valueProcessor:u=et}=t??{},{processedParams:c=[]}=o??{},y=r==="parameterized",R=[],i={},d=b=>y?{sql:b,params:R}:{sql:b,params:i},k=u(e,{parseNumbers:a,quoteFieldNamesWith:m,fieldData:n,format:r}),D=eo(e.operator),S=D.toLowerCase();if((S==="in"||S==="not in"||S==="between"||S==="not between")&&!k)return d("");if(S==="is null"||S==="is not null")return d(`${m[0]}${e.field}${m[1]} ${D}`);if(e.valueSource==="field")return d(`${m[0]}${e.field}${m[1]} ${D} ${k}`.trim());if(S==="in"||S==="not in"){let b=V(e.value);if(y)return b.forEach(v=>R.push(Q(v,a)?j(v,{parseNumbers:a}):v)),d(`${m[0]}${e.field}${m[1]} ${D} (${b.map((v,w)=>s?`${p}${c.length+1+b.length-(b.length-w)}`:"?").join(", ")})`);let A=[];return b.forEach(v=>{let w=l(e.field);A.push(`${p}${w}`),i[`${f?p:""}${w}`]=Q(v,a)?j(v,{parseNumbers:a}):v}),d(`${m[0]}${e.field}${m[1]} ${D} (${A.join(", ")})`)}else if(S==="between"||S==="not between"){let b=V(e.value),[A,v]=b.slice(0,2).map($=>Q($,a)?j($,{parseNumbers:a}):$);if(y)return R.push(A),R.push(v),d(`${m[0]}${e.field}${m[1]} ${D} ${s?`${p}${c.length+1}`:"?"} and ${s?`${p}${c.length+2}`:"?"}`);let w=l(e.field),g=l(e.field);return i[`${f?p:""}${w}`]=A,i[`${f?p:""}${g}`]=v,d(`${m[0]}${e.field}${m[1]} ${D} ${p}${w} and ${p}${g}`)}let G=e.value;typeof e.value=="string"&&(Q(e.value,a)?G=j(e.value,{parseNumbers:a}):G=/^'.*'$/g.test(k)?k.replace(/(^'|'$)/g,""):k);let h="";return y?R.push(G):(h=l(e.field),i[`${f?p:""}${h}`]=G),d(`${m[0]}${e.field}${m[1]} ${D} ${y?s?`${p}${c.length+1}`:"?":`${p}${h}`}`.trim())};var wo=(e,t)=>{let{parseNumbers:o,escapeQuotes:n,quoteFieldNamesWith:r=["",""],quoteValuesWith:l="'",valueProcessor:a=et}=t??{},p=a(e,{parseNumbers:o,escapeQuotes:n,quoteFieldNamesWith:r,quoteValuesWith:l}),f=eo(e.operator),s=f.toLowerCase();if((s==="in"||s==="not in"||s==="between"||s==="not between")&&!p)return"";let[m,u]=nt(r);return`${m}${e.field}${u} ${f} ${p}`.trim()};import{produce as Pn}from"immer";var hr=e=>se(e)&&typeof e.valid=="boolean",pe=(e,t,o)=>{if(typeof t=="boolean")return t;if(hr(t))return t.valid;if(typeof o=="function"&&!F(e)){let n=o(e);if(typeof n=="boolean")return n;if(hr(n))return n.valid}return!0};function Is(e,t={}){let o="json",n=et,r=null,l=["",""],a=()=>!0,p=[],f={},s="",m=":",u=!1,c=!1,y=!1,R=Ut,i=Ht,d="'";if(typeof t=="string")o=t.toLowerCase(),o==="mongodb"?r=Gt:o==="parameterized"?r=kt:o==="parameterized_named"?r=kt:o==="cel"?r=gt:o==="spel"?r=xt:o==="jsonlogic"?r=so:o==="elasticsearch"?r=no:o==="jsonata"&&(r=ao);else{o=(t.format??"json").toLowerCase();let{valueProcessor:G=null,ruleProcessor:h=null}=t;typeof h=="function"&&(r=h),n=typeof G=="function"?(b,A)=>yr(G)?G(b.field,b.operator,b.value,b.valueSource):G(b,A):o==="mongodb"?r??Gt:o==="cel"?r??gt:o==="spel"?r??xt:o==="jsonlogic"?r??so:o==="elasticsearch"?r??no:o==="jsonata"?r??ao:et,l=nt(t.quoteFieldNamesWith),a=t.validator??(()=>!0),p=je(t.fields??[]),s=t.fallbackExpression??"",m=t.paramPrefix??":",u=!!t.paramsKeepPrefix,c=!!t.numberedParams,y=!!t.parseNumbers,R=t.placeholderFieldName??Ut,i=t.placeholderOperatorName??Ht,d=t.quoteValuesWith??"'"}if(s||(s=o==="mongodb"?'"$and":[{"$expr":true}]':o==="cel"||o==="spel"?"1 == 1":"(1 = 1)"),o==="json"||o==="json_without_ids"){let G=y?Pn(e,Po):e;return o==="json_without_ids"?JSON.stringify(G,(h,b)=>h==="id"||h==="path"?void 0:b):JSON.stringify(G,null,2)}if(typeof a=="function"){let G=a(e);if(typeof G=="boolean"){if(G===!1)return o==="parameterized"?{sql:s,params:[]}:o==="parameterized_named"?{sql:s,params:{}}:o==="mongodb"?`{${s}}`:o==="jsonlogic"?!1:o==="elasticsearch"?{}:s}else f=G}let k={},D=mr(p);D.forEach(G=>{typeof G.validator=="function"&&(k[G.value??G.name]=G.validator)});let S=G=>{let h,b;if(G.id&&(h=f[G.id]),D.length){let A=D.filter(v=>v.name===G.field);if(A.length){let v=A[0];typeof v.validator=="function"&&(b=v.validator)}}return[h,b]};if(o==="sql"){let G=(h,b)=>{if(!pe(h,f[h.id??""]))return b?s:"";let A=h.rules.map(v=>{if(typeof v=="string")return v;if(F(v))return G(v,h.rules.length===1);let[w,g]=S(v);if(!pe(v,w,g)||v.field===R||v.operator===i)return"";let $=(v.valueSource??"value")==="value",I=Oe(p,v.field);return typeof r=="function"?r(v,{parseNumbers:y,escapeQuotes:$,quoteFieldNamesWith:l,fieldData:I,format:o,quoteValuesWith:d}):wo(v,{parseNumbers:y,escapeQuotes:$,valueProcessor:n,quoteFieldNamesWith:l,fieldData:I,format:o,quoteValuesWith:d})});return A.length===0?s:`${h.not?"NOT ":""}(${A.filter(Boolean).join(J(h)?` ${h.combinator} `:" ")})`};return G(e,!0)}if(o==="parameterized"||o==="parameterized_named"){let G=o==="parameterized",h=[],b={},A=new Map,v=$=>{A.has($)||A.set($,new Set);let I=`${$}_${A.get($).size+1}`;return A.get($).add(I),I},w=$=>{let[I,H]=S($);if(!pe($,I,H)||$.field===R||$.operator===i)return"";let x=Oe(p,$.field),ne=Object.fromEntries(Array.from(A.entries()).map(([T,de])=>[T,Array.from(de)])),K=(typeof r=="function"?r:kt)($,{getNextNamedParam:v,fieldParamNames:ne,parseNumbers:y,quoteFieldNamesWith:l,fieldData:x,format:o,paramPrefix:m,paramsKeepPrefix:u,numberedParams:c,fallbackExpression:s,valueProcessor:n,fields:p,placeholderFieldName:R,placeholderOperatorName:i,validator:a},{processedParams:h});if(!se(K))return"";let{sql:z,params:O}=K;return typeof z!="string"||!z?"":(o==="parameterized"&&Array.isArray(O)?h.push(...O):o==="parameterized_named"&&se(O)&&(Object.assign(b,O),Object.keys(O).forEach(T=>A.get($.field)?.add(T))),z)},g=($,I)=>{if(!pe($,f[$.id??""]))return I?s:"";let H=$.rules.map(x=>typeof x=="string"?x:F(x)?g(x,$.rules.length===1):w(x));return H.length===0?s:`${$.not?"NOT ":""}(${H.filter(Boolean).join(J($)?` ${$.combinator} `:" ")})`};return G?{sql:g(e,!0),params:h}:{sql:g(e,!0),params:b}}if(o==="mongodb"){let G=(A,v)=>{if(!pe(A,f[A.id??""]))return v?s:"";let w=`"$${A.combinator.toLowerCase()}"`,g=!1,$=A.rules.map(I=>{if(F(I)){let K=G(I);return K?(g=!0,/^\{.+\}$/.test(K)?K:`{${K}}`):""}let[H,x]=S(I);if(!pe(I,H,x)||I.field===R||I.operator===i)return"";let ne=Oe(p,I.field);return(r??n)(I,{parseNumbers:y,fieldData:ne,format:o})}).filter(Boolean);return $.length>0?$.length===1&&!g?$[0]:`${w}:[${$.join(",")}]`:s},h=J(e)?e:Rt(e),b=G(h,!0);return/^\{.+\}$/.test(b)?b:`{${b}}`}if(o==="cel"){let G=(h,b)=>{if(!pe(h,f[h.id??""]))return b?s:"";let A=h.rules.map(g=>{if(typeof g=="string")return So[g];if(F(g))return G(g);let[$,I]=S(g);if(!pe(g,$,I)||g.field===R||g.operator===i)return"";let H=Oe(p,g.field);return(r??n)(g,{parseNumbers:y,escapeQuotes:(g.valueSource??"value")==="value",fieldData:H,format:o})}).filter(Boolean).join(J(h)?` ${So[h.combinator]} `:" "),[v,w]=h.not||!b?[`${h.not?"!":""}(`,")"]:["",""];return A?`${v}${A}${w}`:s};return G(e,!0)}if(o==="spel"){let G=(h,b)=>{if(!pe(h,f[h.id??""]))return b?s:"";let A=h.rules.map(g=>{if(typeof g=="string")return g;if(F(g))return G(g);let[$,I]=S(g);if(!pe(g,$,I)||g.field===R||g.operator===i)return"";let H=Oe(p,g.field);return(r??n)(g,{parseNumbers:y,escapeQuotes:(g.valueSource??"value")==="value",fieldData:H,format:o})}).filter(Boolean).join(J(h)?` ${h.combinator} `:" "),[v,w]=h.not||!b?[`${h.not?"!":""}(`,")"]:["",""];return A?`${v}${A}${w}`:s};return G(e,!0)}if(o==="jsonata"){let G=(h,b)=>{if(!pe(h,f[h.id??""]))return b?s:"";let A=h.rules.map(g=>{if(typeof g=="string")return g;if(F(g))return G(g);let[$,I]=S(g);if(!pe(g,$,I)||g.field===R||g.operator===i)return"";let H=Oe(p,g.field);return(r??n)(g,{parseNumbers:y,escapeQuotes:(g.valueSource??"value")==="value",fieldData:H,format:o,quoteFieldNamesWith:l})}).filter(Boolean).join(J(h)?` ${h.combinator} `:" "),[v,w]=h.not||!b?[`${h.not?"$not":""}(`,")"]:["",""];return A?`${v}${A}${w}`:s};return G(e,!0)}if(o==="jsonlogic"){let G=J(e)?e:Rt(e),h=(b,A)=>{if(!pe(b,f[b.id??""]))return!1;let v=b.rules.map(g=>{if(F(g))return h(g);let[$,I]=S(g);if(!pe(g,$,I)||g.field===R||g.operator===i)return!1;let H=Oe(p,g.field);return(r??n)(g,{parseNumbers:y,fieldData:H,format:o})}).filter(Boolean);if(v.length===0)return!1;let w={[b.combinator]:v};return b.not?{"!":w}:w};return h(G,!0)}if(o==="elasticsearch"){let G=J(e)?e:Rt(e),h=A=>{if(!pe(A,f[A.id??""]))return!1;let v=A.rules.map(w=>{if(F(w))return h(w);let[g,$]=S(w);if(!pe(w,g,$)||w.field===R||w.operator===i)return!1;let I=Oe(p,w.field);return(r??n)(w,{parseNumbers:y,fieldData:I,format:o})}).filter(Boolean);return v.length===0?!1:{bool:A.not?{must_not:A.combinator==="or"?{bool:{should:v}}:v}:{[A.combinator==="or"?"should":"must"]:v}}},b=h(G);return b===!1?{}:b}return""}var Fn={default:et,mongodb:Gt,cel:gt,spel:xt},io=e=>(t,o,n,r)=>Fn[e]({field:t,operator:o,value:n,valueSource:r},{parseNumbers:!1}),js=io("default"),Us=io("mongodb"),Hs=io("cel"),_s=io("spel");var Js=gt,Ks=Gt,zs=xt;var ce=(e,t)=>{let o=t,n=0;for(;n<e.length&&o&&F(o);){let r=o.rules[e[n]];typeof r!="string"?o=r:o=null,n++}return o},oe=e=>e.slice(0,e.length-1),Ue=(e,t)=>e.length===t.length&&e.every((o,n)=>o===t[n]),si=(e,t)=>e.length<t.length&&RegExp(`^${e.join("-")}`).test(t.join("-")),Rr=(e,t)=>{let o=[],n=oe(e),r=oe(t),l=0;for(;l<n.length&&l<r.length&&n[l]===r[l];)o.push(r[l]),l++;return o},vt=(e,t)=>{let o=!!t.disabled,n=t,r=0;for(;r<e.length&&!o&&F(n);){let l=n.rules[e[r]];se(l)&&(F(l)||"field"in l&&l.field)&&(o=!!l.disabled,n=l),r++}return o};var gr=e=>Ue([],e.path)?"Query builder":`Rule group at path ${e.path.join("-")}`;var Bt=globalThis.crypto,fe=()=>"00-0-4-2-000".replace(/[^-]/g,e=>((Math.random()+~~e)*65536>>parseInt(e)).toString(16).padStart(4,"0"));if(Bt){if(typeof Bt.randomUUID=="function")fe=()=>Bt.randomUUID();else if(typeof Bt.getRandomValues=="function"){let e="89ab",t=new Uint32Array(32);fe=()=>{Bt.getRandomValues(t);let o=(t[0]%16).toString(16);for(let n=1;n<32;n++)n===12?o=`${o}4`:n===16?o=`${o}${e[t[17]%4]}`:o=`${o}${(t[n]%16).toString(16)}`,(n===7||n===11||n===15||n===19)&&(o=`${o}-`);return o}}}import*as Qt from"react";var fi=e=>{let t=n=>{let r=It(e);return Qt.createElement(Me.Provider,{value:r},n.children)},o=n=>{let r=It(n);return Qt.createElement(Me.Provider,{value:r},n.children)};return n=>Qt.createElement(t,null,Qt.createElement(o,{...n},n.children))};var uo=e=>{let t=typeof e=="boolean"?e:typeof e=="object"&&e!==null?e.valid:null;return typeof t=="boolean"?t?E.valid:E.invalid:""};var Dn=["value"],wn={name:"name",value:"name",valueSources:null,label:"label"},Gr=(e,t,o)=>{let n=e?be(e):wn;if(n.valueSources)return typeof n.valueSources=="function"?n.valueSources(t):n.valueSources;if(o){let r=o(n.value,t,{fieldData:be(n)});if(r)return r}return Dn};import xr from"clsx";var vr=(...e)=>{let t=o=>xr(e.map(n=>xr(n?.[o])));return{queryBuilder:t("queryBuilder"),ruleGroup:t("ruleGroup"),header:t("header"),body:t("body"),combinators:t("combinators"),addRule:t("addRule"),addGroup:t("addGroup"),cloneRule:t("cloneRule"),cloneGroup:t("cloneGroup"),removeGroup:t("removeGroup"),rule:t("rule"),fields:t("fields"),operators:t("operators"),value:t("value"),removeRule:t("removeRule"),notToggle:t("notToggle"),shiftActions:t("shiftActions"),dragHandle:t("dragHandle"),lockRule:t("lockRule"),lockGroup:t("lockGroup"),valueSource:t("valueSource"),actionElement:t("actionElement"),valueSelector:t("valueSelector")}};import{produce as En}from"immer";var po=Object.keys,Or=Object.entries;var Ti=(e,...t)=>En(e,o=>{for(let n of t)n&&po(n).forEach(r=>{o[r]?Object.assign(o[r],n[r]):Object.assign(o,{[r]:n[r]})})}),ie=(e,t,o)=>{let n=Or(t).map(([r,[l,a]])=>[r,l??a??(o?Jt:{})[e]?.[r]]).filter(r=>!!r[1]);return n.length>0?{[e]:Object.fromEntries(n)}:void 0};import{produce as Ar}from"immer";var Cr=(e,{idGenerator:t=fe}={})=>Ar(e,o=>{o.id||(o.id=t())}),co=(e,{idGenerator:t=fe}={})=>Ar(e,o=>{o.id||(o.id=t()),o.rules=o.rules.map(n=>typeof n=="string"?n:F(n)?co(n,{idGenerator:t}):Cr(n,{idGenerator:t}))}),Tr=(e,{idGenerator:t=fe}={})=>F(e)?co(e,{idGenerator:t}):Cr(e,{idGenerator:t});import{produce as Vt}from"immer";var $r=(e,{idGenerator:t=fe}={})=>JSON.parse(JSON.stringify({...e,id:t()})),Lt=(e,{idGenerator:t=fe}={})=>{if(!se(e))return e;if(!F(e))return JSON.parse(JSON.stringify({...e,id:t()}));if(J(e)){let n=e.rules.map(r=>F(r)?Lt(r,{idGenerator:t}):$r(r,{idGenerator:t}));return{...e,id:t(),rules:n}}let o=e.rules.map(n=>typeof n=="string"?n:F(n)?Lt(n,{idGenerator:t}):$r(n,{idGenerator:t}));return{...e,id:t(),rules:o}};var Eo=(e,t,o,{combinators:n=qe,combinatorPreceding:r,idGenerator:l=fe}={})=>Vt(e,a=>{let p=ce(o,a);if(!(!p||!F(p))){if(We(p)&&p.rules.length>0){let f=p.rules[p.rules.length-2];p.rules.push(r??(typeof f=="string"?f:ue(n)))}p.rules.push(Tr(t,{idGenerator:l}))}}),Nr=(e,t,o,n,{resetOnFieldChange:r=!0,resetOnOperatorChange:l=!1,getRuleDefaultOperator:a=()=>"=",getValueSources:p=()=>["value"],getRuleDefaultValue:f=()=>""}={})=>Vt(e,s=>{if(t==="combinator"&&!J(s)){let i=ce(oe(n),s).rules;n[n.length-1]%2===1&&(i[n[n.length-1]]=o);return}let m=ce(n,s);if(!m)return;let u=F(m);if(m[t]===o||(t!=="valueSource"&&(m[t]=o),u))return;let c=!1,y=!1;r&&t==="field"&&(m.operator=a(o),c=!0,y=!0),l&&t==="operator"&&(c=!0,y=!0);let R=p(m.field,m.operator)[0];(c&&m.valueSource&&R!==m.valueSource||t==="valueSource"&&o!==m.valueSource)&&(y=!!m.valueSource||!m.valueSource&&o!==R,m.valueSource=c?R:o),y&&(m.value=f(m))}),Sr=(e,t)=>t.length===0||!J(e)&&!ce(t,e)?e:Vt(e,o=>{let n=t[t.length-1],r=ce(oe(t),o);if(r&&F(r))if(!J(r)&&r.rules.length>1){let l=n===0?0:n-1;r.rules.splice(l,2)}else r.rules.splice(n,1)}),kn=(e,t,o)=>{if(Array.isArray(o))return o;let n=We(e);if(o==="up"){if(Ue(t,[0]))return t;if(t.at(-1)===0){let r=oe(t);return[...oe(r),Math.max(0,r.at(-1)-(n?1:0))]}else{let r=[...oe(t),Math.max(0,t.at(-1)-(n?2:1))],l=ce(r,e);return F(l)?[...r,l.rules.length]:[...oe(t),Math.max(0,t.at(-1)-(n?3:1))]}}else if(o==="down"){if(Ue([e.rules.length-1],t))return t;if(t.at(-1)===ce(oe(t),e).rules.length-1){let r=oe(t);return[...oe(r),r.at(-1)+1]}else{let r=[...oe(t),t.at(-1)+(n?2:1)],l=ce(r,e);return F(l)?[...r,0]:[...oe(t),t.at(-1)+(n?3:2)]}}return t},Pr=(e,t,o,{clone:n=!1,combinators:r=qe,idGenerator:l=fe}={})=>{let a=kn(e,t,o);if(t.length===0||Ue(t,a)||!ce(oe(a),e))return e;let p=ce(t,e);if(!p)return e;let f=n?Lt(p,{idGenerator:l}):p;return Vt(e,s=>{let m=We(s),u=ce(oe(t),s),c=t[t.length-1],y=m&&c>0?u.rules[c-1]:null,R=m&&c<u.rules.length-1?u.rules[c+1]:null;if(!n){let h=m?Math.max(0,c-1):c,b=m?2:1;u.rules.splice(h,b)}let i=[...a],d=Rr(t,a);!n&&t.length===d.length+1&&a[d.length]>t[d.length]&&(i[d.length]-=m?2:1);let k=oe(i),D=ce(k,s),S=i[i.length-1],G=(...h)=>D.rules.splice(S,0,...h);if(D.rules.length===0||!m)G(f);else if(S===0)if(c===0&&R)G(f,R);else{let h=D.rules[1]??y??ue(r);G(f,h)}else if(y)G(y,f);else{let h=D.rules[S-2]??R??ue(r);G(h,f)}})},ji=(e,t,o,{combinators:n=qe,combinatorPreceding:r,combinatorSucceeding:l,idGenerator:a=fe,replace:p=!1}={})=>Vt(e,f=>{let s=ce(oe(o),f);if(!s||!F(s))return;let m=Lt(t,{idGenerator:a}),u=We(f),c=o[o.length-1],y=(R,...i)=>s.rules.splice(R,p?i.length:0,...i);if(s.rules.length===0||!u)y(c,m);else if(p&&u)y(c+c%2,m);else if(c===0)if(m.path?.at(-1)===0&&l)y(c,m,l);else{let R=s.rules[1]??r??ue(n);y(c,m,R)}else{let R=c%2===0?c-1:c;if(r)y(R,r,m);else{let i=s.rules[R-2]??l??ue(n);y(R,i,m)}}});import*as mo from"react";var Fr=e=>Yt(e)?e.map(t=>mo.createElement("optgroup",{key:t.label,label:t.label},t.options.map(o=>mo.createElement("option",{key:o.name,value:o.name,disabled:o.disabled},o.label)))):Array.isArray(e)?e.map(t=>mo.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label)):null;import{produce as Bn}from"immer";var Dr=(e,t,o)=>Bn(e,n=>{for(let[r,l]of Object.entries(t))l===!1?delete n[r]:l&&r!==l&&r in n&&(n[l]=n[r],o&&delete n[r])});function zi(e,t={}){let{ruleProcessor:o=m=>m,ruleGroupProcessor:n=m=>m,propertyMap:r={},combinatorMap:l={},operatorMap:a={},omitPath:p=!1,deleteRemappedProperties:f=!0}=t,s=m=>({...n(Dr({...m,...J(m)?{combinator:l[m.combinator]??m.combinator}:{}},r,f)),...r.rules===!1?null:{[r.rules??"rules"]:m.rules.map((u,c)=>{let y=p?null:{path:[...m.path,c]};return typeof u=="string"?l[u]??u:F(u)?s({...u,...y}):o(Dr({...u,...y,..."operator"in u?{operator:a[u.operator]??u.operator}:{}},r,f))})}});return s({...e,...p?null:{path:[]}})}var Qn=(e,t)=>e===!1?!1:e?!0:t!==!1,In=(e,t)=>e?!0:e===!1?!1:!!t,Ln=(e,t,o)=>e?Qn(t,o):In(t,o),fo=(e,t,o)=>Ln(e,t,o),Yi=(e,t,o)=>typeof t<"u"&&t!=null?t:typeof o<"u"&&o!=null?o:e;var bo=()=>null,Wn=Vn(bo),Ot={},It=({finalize:e,...t})=>{let o=Mn(Me),n=fo(!1,t.debugMode,o.debugMode),r=e?n:t.debugMode??o.debugMode,l=fo(!0,t.enableMountQueryChange,o.enableMountQueryChange),a=e?l:t.enableMountQueryChange??o.enableMountQueryChange,p=fo(!1,t.enableDragAndDrop,o.enableDragAndDrop)&&o.enableDragAndDrop!==!1,f=e?p:t.enableDragAndDrop??o.enableDragAndDrop,s=yo(()=>vr(e?Object.assign({},zo):Ot,o.controlClassnames,t.controlClassnames),[o.controlClassnames,t.controlClassnames,e]),m=yo(()=>({actionElement:s.actionElement,addGroup:s.addGroup,addRule:s.addRule,body:s.body,cloneGroup:s.cloneGroup,cloneRule:s.cloneRule,combinators:s.combinators,dragHandle:s.dragHandle,fields:s.fields,header:s.header,lockGroup:s.lockGroup,lockRule:s.lockRule,notToggle:s.notToggle,operators:s.operators,queryBuilder:s.queryBuilder,removeGroup:s.removeGroup,removeRule:s.removeRule,rule:s.rule,ruleGroup:s.ruleGroup,shiftActions:s.shiftActions,value:s.value,valueSelector:s.valueSelector,valueSource:s.valueSource}),[s.actionElement,s.addGroup,s.addRule,s.body,s.cloneGroup,s.cloneRule,s.combinators,s.dragHandle,s.fields,s.header,s.lockGroup,s.lockRule,s.notToggle,s.operators,s.queryBuilder,s.removeGroup,s.removeRule,s.rule,s.ruleGroup,s.shiftActions,s.value,s.valueSelector,s.valueSource]),u=o.controlElements??Ot,c=t.controlElements??Ot,y=qn((D,S,G)=>{let h=D==="dragHandle"?Wn:bo,b=(D.endsWith("Action")&&c.actionElement?c.actionElement:void 0)??(D.endsWith("Selector")&&c.valueSelector?c.valueSelector:void 0),A=(D.endsWith("Action")&&u.actionElement?u.actionElement:void 0)??(D.endsWith("Selector")&&u.valueSelector?u.valueSelector:void 0),v=S===null?h:S??(e?b:void 0)??(G===null?h:G??(e?A:void 0));return v?{[D]:v}:e?{[D]:qt[D]}:Ot},[u.actionElement,u.valueSelector,e,c.actionElement,c.valueSelector]),R=yo(()=>Object.assign({},y("addGroupAction",c.addGroupAction,u.addGroupAction),y("addRuleAction",c.addRuleAction,u.addRuleAction),y("cloneGroupAction",c.cloneGroupAction,u.cloneGroupAction),y("cloneRuleAction",c.cloneRuleAction,u.cloneRuleAction),y("combinatorSelector",c.combinatorSelector,u.combinatorSelector),y("dragHandle",c.dragHandle,u.dragHandle),y("fieldSelector",c.fieldSelector,u.fieldSelector),y("inlineCombinator",c.inlineCombinator,u.inlineCombinator),y("lockGroupAction",c.lockGroupAction,u.lockGroupAction),y("lockRuleAction",c.lockRuleAction,u.lockRuleAction),y("notToggle",c.notToggle,u.notToggle),y("operatorSelector",c.operatorSelector,u.operatorSelector),y("removeGroupAction",c.removeGroupAction,u.removeGroupAction),y("removeRuleAction",c.removeRuleAction,u.removeRuleAction),y("shiftActions",c.shiftActions,u.shiftActions),{valueEditor:c.valueEditor===null?bo:c.valueEditor??(u.valueEditor===null?bo:u.valueEditor)??qt.valueEditor},y("valueSourceSelector",c.valueSourceSelector,u.valueSourceSelector),y("rule",c.rule,u.rule),y("ruleGroup",c.ruleGroup,u.ruleGroup),{actionElement:c.actionElement??u.actionElement??(e?qt.actionElement:void 0)},{valueSelector:c.valueSelector??u.valueSelector??(e?qt.valueSelector:void 0)}),[u.actionElement,u.addGroupAction,u.addRuleAction,u.cloneGroupAction,u.cloneRuleAction,u.combinatorSelector,u.dragHandle,u.fieldSelector,u.inlineCombinator,u.lockGroupAction,u.lockRuleAction,u.notToggle,u.operatorSelector,u.removeGroupAction,u.removeRuleAction,u.rule,u.ruleGroup,u.shiftActions,u.valueEditor,u.valueSelector,u.valueSourceSelector,y,e,c.actionElement,c.addGroupAction,c.addRuleAction,c.cloneGroupAction,c.cloneRuleAction,c.combinatorSelector,c.dragHandle,c.fieldSelector,c.inlineCombinator,c.lockGroupAction,c.lockRuleAction,c.notToggle,c.operatorSelector,c.removeGroupAction,c.removeRuleAction,c.rule,c.ruleGroup,c.shiftActions,c.valueEditor,c.valueSelector,c.valueSourceSelector]),i=t.translations??Ot,d=o.translations??Ot,k=yo(()=>Object.assign(e?Object.assign({},Jt):{},ie("addGroup",{label:[i.addGroup?.label,d.addGroup?.label],title:[i.addGroup?.title,d.addGroup?.title]},e),ie("addRule",{label:[i.addRule?.label,d.addRule?.label],title:[i.addRule?.title,d.addRule?.title]},e),ie("cloneRule",{label:[i.cloneRule?.label,d.cloneRule?.label],title:[i.cloneRule?.title,d.cloneRule?.title]},e),ie("cloneRuleGroup",{label:[i.cloneRuleGroup?.label,d.cloneRuleGroup?.label],title:[i.cloneRuleGroup?.title,d.cloneRuleGroup?.title]},e),ie("combinators",{title:[i.combinators?.title,d.combinators?.title]},e),ie("dragHandle",{label:[i.dragHandle?.label,d.dragHandle?.label],title:[i.dragHandle?.title,d.dragHandle?.title]},e),ie("fields",{placeholderGroupLabel:[i.fields?.placeholderGroupLabel,d.fields?.placeholderGroupLabel],placeholderLabel:[i.fields?.placeholderLabel,d.fields?.placeholderLabel],placeholderName:[i.fields?.placeholderName,d.fields?.placeholderName],title:[i.fields?.title,d.fields?.title]},e),ie("lockGroup",{label:[i.lockGroup?.label,d.lockGroup?.label],title:[i.lockGroup?.title,d.lockGroup?.title]},e),ie("lockGroupDisabled",{label:[i.lockGroupDisabled?.label,d.lockGroupDisabled?.label],title:[i.lockGroupDisabled?.title,d.lockGroupDisabled?.title]},e),ie("lockRule",{label:[i.lockRule?.label,d.lockRule?.label],title:[i.lockRule?.title,d.lockRule?.title]},e),ie("lockRuleDisabled",{label:[i.lockRuleDisabled?.label,d.lockRuleDisabled?.label],title:[i.lockRuleDisabled?.title,d.lockRuleDisabled?.title]},e),ie("notToggle",{label:[i.notToggle?.label,d.notToggle?.label],title:[i.notToggle?.title,d.notToggle?.title]},e),ie("operators",{placeholderGroupLabel:[i.operators?.placeholderGroupLabel,d.operators?.placeholderGroupLabel],placeholderLabel:[i.operators?.placeholderLabel,d.operators?.placeholderLabel],placeholderName:[i.operators?.placeholderName,d.operators?.placeholderName],title:[i.operators?.title,d.operators?.title]},e),ie("removeGroup",{label:[i.removeGroup?.label,d.removeGroup?.label],title:[i.removeGroup?.title,d.removeGroup?.title]},e),ie("removeRule",{label:[i.removeRule?.label,d.removeRule?.label],title:[i.removeRule?.title,d.removeRule?.title]},e),ie("shiftActionDown",{label:[i.shiftActionDown?.label,d.shiftActionDown?.label],title:[i.shiftActionDown?.title,d.shiftActionDown?.title]},e),ie("shiftActionUp",{label:[i.shiftActionUp?.label,d.shiftActionUp?.label],title:[i.shiftActionUp?.title,d.shiftActionUp?.title]},e),ie("value",{title:[i.value?.title,d.value?.title]},e),ie("valueSourceSelector",{title:[i.valueSourceSelector?.title,d.valueSourceSelector?.title]},e)),[i.addGroup?.label,i.addGroup?.title,i.addRule?.label,i.addRule?.title,i.cloneRule?.label,i.cloneRule?.title,i.cloneRuleGroup?.label,i.cloneRuleGroup?.title,i.combinators?.title,i.dragHandle?.label,i.dragHandle?.title,i.fields?.placeholderGroupLabel,i.fields?.placeholderLabel,i.fields?.placeholderName,i.fields?.title,i.lockGroup?.label,i.lockGroup?.title,i.lockGroupDisabled?.label,i.lockGroupDisabled?.title,i.lockRule?.label,i.lockRule?.title,i.lockRuleDisabled?.label,i.lockRuleDisabled?.title,i.notToggle?.label,i.notToggle?.title,i.operators?.placeholderGroupLabel,i.operators?.placeholderLabel,i.operators?.placeholderName,i.operators?.title,i.removeGroup?.label,i.removeGroup?.title,i.removeRule?.label,i.removeRule?.title,i.shiftActionDown?.label,i.shiftActionDown?.title,i.shiftActionUp?.label,i.shiftActionUp?.title,i.value?.title,i.valueSourceSelector?.title,e,d.addGroup?.label,d.addGroup?.title,d.addRule?.label,d.addRule?.title,d.cloneRule?.label,d.cloneRule?.title,d.cloneRuleGroup?.label,d.cloneRuleGroup?.title,d.combinators?.title,d.dragHandle?.label,d.dragHandle?.title,d.fields?.placeholderGroupLabel,d.fields?.placeholderLabel,d.fields?.placeholderName,d.fields?.title,d.lockGroup?.label,d.lockGroup?.title,d.lockGroupDisabled?.label,d.lockGroupDisabled?.title,d.lockRule?.label,d.lockRule?.title,d.lockRuleDisabled?.label,d.lockRuleDisabled?.title,d.notToggle?.label,d.notToggle?.title,d.operators?.placeholderGroupLabel,d.operators?.placeholderLabel,d.operators?.placeholderName,d.operators?.title,d.removeGroup?.label,d.removeGroup?.title,d.removeRule?.label,d.removeRule?.title,d.shiftActionDown?.label,d.shiftActionDown?.title,d.shiftActionUp?.label,d.shiftActionUp?.title,d.value?.title,d.valueSourceSelector?.title]);return{controlClassnames:m,controlElements:R,debugMode:r,enableDragAndDrop:f,enableMountQueryChange:a,translations:k,initialQuery:t.initialQuery,qbId:t.qbId}};import{clsx as wr}from"clsx";import{useCallback as lt,useEffect as Er,useMemo as Ae,useRef as jn,useState as Un}from"react";var Hn={},_n={},Jn=[],Kn={},zn=()=>null,kr=()=>"",Mt=()=>!0,Xn=(...e)=>{console.log(...e)};function Br(e,t){let{query:o,defaultQuery:n,getValueEditorSeparator:r=zn,getRuleClassname:l=kr,getRuleGroupClassname:a=kr,onAddRule:p=Mt,onAddGroup:f=Mt,onMoveRule:s=Mt,onMoveGroup:m=Mt,onRemove:u=Mt,onQueryChange:c,showCombinatorsBetweenRules:y=!1,showNotToggle:R=!1,showShiftActions:i=!1,showCloneButtons:d=!1,showLockButtons:k=!1,resetOnFieldChange:D=!0,resetOnOperatorChange:S=!1,autoSelectField:G=!0,autoSelectOperator:h=!0,addRuleToNewGroups:b=!1,listsAsArrays:A=!1,parseNumbers:v=!1,disabled:w=!1,validator:g,onLog:$=Xn,idGenerator:I,accessibleDescriptionGenerator:H=gr}=e,{qbId:x,rqbContext:ne,fields:K,fieldMap:z,combinators:O,getOperatorsMain:T,getRuleDefaultOperator:de,getValueEditorTypeMain:ke,getValueSourcesMain:Ce,getValuesMain:De,getRuleDefaultValue:Be,getInputTypeMain:Qe,createRule:Ie,createRuleGroup:q}=t,{controlClassnames:xe,controlElements:Le,debugMode:N,enableDragAndDrop:C,enableMountQueryChange:P,translations:le}=ne,ae=!!y,Ke=!!R,Te=!!i,pt=!!d,ot=!!k,X=!!D,Y=!!S,Re=!!G,ct=!!h,ye=!!b,ze=!!A,Z=lt((...B)=>{N&&$(...B)},[N,$]);nr({defaultQuery:n,queryProp:o});let $e=or(),dt=yt(),go=Ae(()=>rt(x),[x]),Go=tr(go),ko=lt(()=>go($e.getState()),[$e,go]),Xr=Ae(()=>q(),[q]),xo=o??Go??n??Xr,ge=xo.id?xo:co(xo,{idGenerator:I}),[Bo]=Un(ge),Yr=Ae(()=>({...ne,initialQuery:Bo}),[ne,Bo]);Er(()=>{o&&!Object.is(o,Go)&&dt(zt({payload:{qbId:x,query:o},onQueryChange:void 0}))},[o,x,Go,dt]);let $t=Ae(()=>We(ge),[ge]),vo=!!e.independentCombinators&&!$t;bt("independentCombinators",vo||!vo&&(e.independentCombinators??"not present")!=="not present",vo?"invalid":"unnecessary");let Qo=jn(!1);Er(()=>{Qo.current||(Qo.current=!0,dt(zt({payload:{qbId:x,query:ge},onQueryChange:P&&typeof c=="function"?c:void 0})))},[P,c,x,dt,ge]);let Ne=lt(B=>{dt(zt({payload:{qbId:x,query:B},onQueryChange:c}))},[c,x,dt]),Wt=Ae(()=>Array.isArray(w)&&w||Jn,[w]),ve=w===!0,Zr=Ae(()=>ge.disabled||Wt.some(B=>B.length===0),[Wt,ge.disabled]),Io=lt((B,_,ee)=>{let U=rt(x)($e.getState());if(!U)return;if(vt(_,U)||ve){Z({qbId:x,type:me.parentPathDisabled,rule:B,parentPath:_,query:U});return}let te=p(B,_,U,ee);if(!te){Z({qbId:x,type:me.onAddRuleFalse,rule:B,parentPath:_,query:U});return}let we=te===!0?B:te,Xe=Eo(U,we,_,{combinators:O,combinatorPreceding:we.combinatorPreceding??void 0});Z({qbId:x,type:me.add,query:U,newQuery:Xe,newRule:we,parentPath:_}),Ne(Xe)},[x,$e,ve,p,O,Ne,Z]),Lo=lt((B,_,ee)=>{let U=rt(x)($e.getState());if(!U)return;if(vt(_,U)||ve){Z({qbId:x,type:me.parentPathDisabled,ruleGroup:B,parentPath:_,query:U});return}let te=f(B,_,U,ee);if(!te){Z({qbId:x,type:me.onAddGroupFalse,ruleGroup:B,parentPath:_,query:U});return}let we=te===!0?B:te,Xe=Eo(U,we,_,{combinators:O,combinatorPreceding:we.combinatorPreceding??void 0});Z({qbId:x,type:me.add,query:U,newQuery:Xe,newGroup:we,parentPath:_}),Ne(Xe)},[x,$e,ve,f,O,Z,Ne]),Vo=lt((B,_,ee)=>{let U=rt(x)($e.getState());if(!U)return;if(vt(ee,U)&&B!=="disabled"||ve){Z({qbId:x,type:me.pathDisabled,path:ee,prop:B,value:_,query:U});return}let te=Nr(U,B,_,ee,{resetOnFieldChange:X,resetOnOperatorChange:Y,getRuleDefaultOperator:de,getValueSources:Ce,getRuleDefaultValue:Be});Z({qbId:x,type:me.update,query:U,newQuery:te,prop:B,value:_,path:ee}),Ne(te)},[x,$e,ve,X,Y,de,Ce,Be,Z,Ne]),Oo=lt((B,_)=>{let ee=rt(x)($e.getState());if(!ee)return;if(vt(B,ee)||ve){Z({qbId:x,type:me.pathDisabled,path:B,query:ee});return}let U=ce(B,ee);if(U)if(u(U,B,ee,_)){let te=Sr(ee,B);Z({qbId:x,type:me.remove,query:ee,newQuery:te,path:B,ruleOrGroup:U}),Ne(te)}else Z({qbId:x,type:me.onRemoveFalse,ruleOrGroup:U,path:B,query:ee})},[x,$e,ve,Z,u,Ne]),qo=lt((B,_,ee,U)=>{let te=rt(x)($e.getState());if(!te)return;if(vt(B,te)||ve){Z({qbId:x,type:me.pathDisabled,oldPath:B,newPath:_,query:te});return}let we=Pr(te,B,_,{clone:ee,combinators:O}),Xe=ce(B,te),Wo=F(Xe),Ao=(Wo?m:s)(Xe,B,_,te,we,{clone:ee,combinators:O},U);if(!Ao){Z({qbId:x,type:Wo?me.onMoveGroupFalse:me.onMoveRuleFalse,ruleOrGroup:Xe,oldPath:B,newPath:_,clone:ee,query:te,nextQuery:we});return}let jo=F(Ao)?Ao:we;Z({qbId:x,type:me.move,query:te,newQuery:jo,oldPath:B,newPath:_,clone:ee}),Ne(jo)},[x,$e,ve,O,m,s,Z,Ne]),{validationResult:Nt,validationMap:Mo}=Ae(()=>{let B=typeof g=="function"&&ge?g(ge):Hn;return{validationResult:B,validationMap:typeof B=="boolean"?_n:B}},[ge,g]),en=Ae(()=>C?"enabled":"disabled",[C]),tn=Ae(()=>$t||ae?"enabled":"disabled",[$t,ae]),on=Ae(()=>typeof ge.combinator=="string"?{combinator:ge.combinator}:Kn,[ge.combinator]),rn=Ae(()=>wr(E.queryBuilder,wr(xe.queryBuilder),{[E.disabled]:ve,[E.valid]:typeof Nt=="boolean"&&Nt,[E.invalid]:typeof Nt=="boolean"&&!Nt}),[xe.queryBuilder,ve,Nt]),nn=Ae(()=>({addRuleToNewGroups:ye,accessibleDescriptionGenerator:H,autoSelectField:Re,autoSelectOperator:ct,classNames:xe,combinators:O,controls:Le,createRule:Ie,createRuleGroup:q,disabledPaths:Wt,enableDragAndDrop:C,fieldMap:z,fields:K,dispatchQuery:Ne,getQuery:ko,getInputType:Qe,getOperators:T,getRuleClassname:l,getRuleGroupClassname:a,getValueEditorSeparator:r,getValueEditorType:ke,getValues:De,getValueSources:Ce,independentCombinators:$t,listsAsArrays:ze,parseNumbers:v,qbId:x,showCloneButtons:pt,showCombinatorsBetweenRules:ae,showLockButtons:ot,showNotToggle:Ke,showShiftActions:Te,validationMap:Mo}),[ye,H,Re,ct,O,xe,Le,Ie,q,Wt,C,z,K,Ne,ko,Qe,T,l,a,ke,De,Ce,r,$t,ze,v,x,pt,ae,ot,Ke,Te,Mo]);return{actions:Ae(()=>({moveRule:qo,onGroupAdd:Lo,onGroupRemove:Oo,onPropChange:Vo,onRuleAdd:Io,onRuleRemove:Oo}),[qo,Lo,Vo,Io,Oo]),rootGroup:ge,rootGroupDisabled:Zr,queryDisabled:ve,rqbContext:Yr,schema:nn,translations:le,wrapperClassName:rn,dndEnabledAttr:en,inlineCombinatorsAttr:tn,combinatorPropObject:on}}import{useCallback as tt,useMemo as At,useState as Qr}from"react";var Ir=(e,t,o)=>{let n=ue(e);if(t.operator==="between"||t.operator==="notBetween"){let r=[n,n];return o?r:ht(r.map(l=>l??""),",")}return n},Lr=e=>{let[t]=Qr(fe),{fields:o,baseField:n,operators:r,baseOperator:l,combinators:a=qe,baseCombinator:p,translations:f,enableMountQueryChange:s=!0,controlClassnames:m,controlElements:u,getDefaultField:c,getDefaultOperator:y,getDefaultValue:R,getOperators:i,getValueEditorType:d,getValueSources:k,getInputType:D,getValues:S,autoSelectField:G=!0,autoSelectOperator:h=!0,addRuleToNewGroups:b=!1,enableDragAndDrop:A,listsAsArrays:v=!1,debugMode:w=!1,idGenerator:g=fe}=e,$=r??Ko,[I]=Qr(e.query??e.defaultQuery),H=It({controlClassnames:m,controlElements:u,debugMode:w,enableDragAndDrop:A,enableMountQueryChange:s,translations:f,initialQuery:I,qbId:t,finalize:!0}),{translations:x}=H,ne=At(()=>({id:x.fields.placeholderName,name:x.fields.placeholderName,value:x.fields.placeholderName,label:x.fields.placeholderLabel}),[x.fields.placeholderLabel,x.fields.placeholderName]),K=At(()=>o??[ne],[ne,o]),z=At(()=>{let N=Array.isArray(K)?je(K,n):po($o(K,n)).map(C=>({...K[C],name:C,value:C})).sort((C,P)=>C.label.localeCompare(P.label));return Se(N)?G?Xt(N):Xt([{label:x.fields.placeholderGroupLabel,options:[ne]},...N]):G?at(N):at([ne,...N])},[G,n,ne,K,x.fields.placeholderGroupLabel]),O=At(()=>{if(!Array.isArray(K)){let C=$o(K,n);return G?C:{...C,[x.fields.placeholderName]:ne}}let N={};return Se(z)?z.forEach(C=>C.options.forEach(P=>{N[P.value??P.name]=be(P,n)})):z.forEach(C=>{N[C.value??C.name]=be(C,n)}),N},[G,n,ne,z,K,x.fields.placeholderName]),T=At(()=>je(a,p),[p,a]),de=At(()=>({id:x.operators.placeholderName,name:x.operators.placeholderName,value:x.operators.placeholderName,label:x.operators.placeholderLabel}),[x.operators.placeholderLabel,x.operators.placeholderName]),ke=tt((N,{fieldData:C})=>{let P=je($,l);if(C?.operators)P=je(C.operators,l);else if(i){let le=i(N,{fieldData:C});le&&(P=je(le,l))}return h||(Se(P)?P=[{label:x.operators.placeholderGroupLabel,options:[de]},...P]:P=[de,...P]),dr(P)},[h,l,de,i,$,x.operators.placeholderGroupLabel]),Ce=tt(N=>{let C=O[N];if(C?.defaultOperator)return C.defaultOperator;if(y)return typeof y=="function"?y(N,{fieldData:C}):y;let P=ke(N,{fieldData:C})??[];return ue(P)??""},[O,y,ke]),De=tt((N,C,{fieldData:P})=>P.valueEditorType?typeof P.valueEditorType=="function"?P.valueEditorType(C):P.valueEditorType:d?.(N,C,{fieldData:P})??"text",[d]),Be=tt((N,C)=>Gr(O[N],C,k),[O,k]),Qe=tt((N,C,{fieldData:P})=>P?.values?je(P.values):S?je(S(N,C,{fieldData:P})):[],[S]),Ie=tt(N=>{let C=O[N.field]??{};if(C?.defaultValue!==void 0&&C.defaultValue!==null)return C.defaultValue;if(R)return R(N,{fieldData:C});let P="",le=Qe(N.field,N.operator,{fieldData:C});if(N.valueSource==="field"){let ae=Zt(C,z,N.operator);ae.length>0?P=Ir(ae,N,v):P=""}else if(le.length){let ae=De(N.field,N.operator,{fieldData:C});ae==="multiselect"?P=v?[]:"":(ae==="select"||ae==="radio")&&(P=Ir(le,N,v))}else De(N.field,N.operator,{fieldData:C})==="checkbox"&&(P=!1);return P},[O,z,R,De,Qe,v]),q=tt((N,C,{fieldData:P})=>{if(D){let le=D(N,C,{fieldData:P});if(le)return le}return"text"},[D]),xe=tt(()=>{let N="",C=z;if(C?.length>0&&C[0]){let Te=ue(C);Te&&(N=Te)}if(c)if(typeof c=="function"){let Te=c(C);Te&&(N=Te)}else N=c;let P=Ce(N),le=Be(N,P)[0]??"value",ae={id:g(),field:N,operator:P,valueSource:le,value:""},Ke=Ie(ae);return{...ae,value:Ke}},[z,c,Ce,Ie,Be,g]),Le=tt(N=>N?{id:g(),rules:b?[xe()]:[],not:!1}:{id:g(),rules:b?[xe()]:[],combinator:ue(T)??"",not:!1},[b,T,xe,g]);return{qbId:t,rqbContext:H,fields:z,fieldMap:O,combinators:T,getOperatorsMain:ke,getRuleDefaultOperator:Ce,getValueEditorTypeMain:De,getValueSourcesMain:Be,getValuesMain:Qe,getRuleDefaultValue:Ie,getInputTypeMain:q,createRule:xe,createRuleGroup:Le}};var Vr=e=>Br(e,Lr(e));var ho=(e,t)=>{};import{clsx as He}from"clsx";import{useCallback as Ct,useMemo as he}from"react";var qr=e=>{let{id:t,path:o,rule:n,schema:r,actions:{moveRule:l,onPropChange:a,onRuleRemove:p},disabled:f,parentDisabled:s,shiftUpDisabled:m,shiftDownDisabled:u,field:c,operator:y,value:R,valueSource:i,dragMonitorId:d="",dropMonitorId:k="",dndRef:D=null,dragRef:S=null,isDragging:G=!1,isOver:h=!1}=e,{classNames:b,fields:A,fieldMap:v,getInputType:w,getOperators:g,getValueEditorType:$,getValueEditorSeparator:I,getValueSources:H,getValues:x,validationMap:ne,enableDragAndDrop:K,getRuleClassname:z}=r;bt("rule",!n),ho(K,!!(d||k||D||S));let O=!!s||!!f,T=he(()=>n||{id:t,field:c??"",operator:y??"",value:R,valueSource:i},[c,t,y,n,R,i]),de=he(()=>({shiftActions:He(E.shiftActions,b.shiftActions),dragHandle:He(E.dragHandle,b.dragHandle),fields:He(E.fields,b.valueSelector,b.fields),operators:He(E.operators,b.valueSelector,b.operators),valueSource:He(E.valueSource,b.valueSelector,b.valueSource),value:He(E.value,b.value),cloneRule:He(E.cloneRule,b.actionElement,b.cloneRule),lockRule:He(E.lockRule,b.actionElement,b.lockRule),removeRule:He(E.removeRule,b.actionElement,b.removeRule)}),[b.shiftActions,b.dragHandle,b.valueSelector,b.fields,b.operators,b.valueSource,b.value,b.actionElement,b.cloneRule,b.lockRule,b.removeRule]),ke=Ct(ye=>(ze,Z)=>{O||a(ye,ze,o)},[O,a,o]),Ce=Ct((ye,ze)=>{if(!O){let Z=[...oe(o),o[o.length-1]+1];l(o,Z,!0)}},[O,l,o]),De=Ct((ye,ze)=>{a("disabled",!O,o)},[O,a,o]),Be=Ct((ye,ze)=>{O||p(o)},[O,p,o]),Qe=Ct((ye,ze)=>{!O&&!m&&l(o,"up",ye?.altKey)},[O,l,o,m]),Ie=Ct((ye,ze)=>{!O&&!u&&l(o,"down",ye?.altKey)},[O,l,o,u]),q=he(()=>v?.[T.field]??{name:T.field,value:T.field,label:T.field},[v,T.field]),xe=he(()=>q.inputType??w(T.field,T.operator,{fieldData:q}),[q,w,T.field,T.operator]),Le=he(()=>g(T.field,{fieldData:q}),[q,g,T.field]),N=he(()=>Oe(Le,T.operator),[Le,T.operator]),C=N?.arity,P=typeof C=="string"&&C==="unary"||typeof C=="number"&&C<2,le=he(()=>typeof q.valueSources=="function"?q.valueSources(T.operator):q.valueSources??H(T.field,T.operator,{fieldData:q}),[q,H,T.field,T.operator]),ae=he(()=>T.valueSource==="field"?"select":$(T.field,T.operator,{fieldData:q}),[q,$,T.field,T.operator,T.valueSource]),Ke=he(()=>I(T.field,T.operator,{fieldData:q}),[q,I,T.field,T.operator]),Te=he(()=>T.valueSource==="field"?Zt(q,A,T.operator):q.values??x(T.field,T.operator,{fieldData:q}),[q,A,x,T.field,T.operator,T.valueSource]),pt=he(()=>le.map(ye=>({name:ye,value:ye,label:ye})),[le]),ot=he(()=>ne[t??""]??(typeof q.validator=="function"?q.validator(T):null),[q,t,T,ne]),X=he(()=>uo(ot),[ot]),Y=he(()=>q?.className??"",[q?.className]),Re=he(()=>N?.className??"",[N?.className]),ct=He(z(T,{fieldData:q}),Y,Re,E.rule,b.rule,{[E.disabled]:O,[E.dndDragging]:G,[E.dndOver]:h},X);return{...e,classNames:de,cloneRule:Ce,disabled:O,dndRef:D,dragMonitorId:d,dragRef:S,dropMonitorId:k,fieldData:q,generateOnChangeHandler:ke,hideValueControls:P,inputType:xe,operators:Le,outerClassName:ct,removeRule:Be,rule:T,shiftRuleUp:Qe,shiftRuleDown:Ie,toggleLockRule:De,validationResult:ot,valueEditorSeparator:Ke,valueEditorType:ae,values:Te,valueSourceOptions:pt,valueSources:le}};import{clsx as Fe}from"clsx";import{useCallback as _e,useMemo as Je}from"react";var Mr=e=>{let{id:t,path:o,ruleGroup:n,schema:{qbId:r,accessibleDescriptionGenerator:l,classNames:a,combinators:p,createRule:f,createRuleGroup:s,disabledPaths:m,independentCombinators:u,validationMap:c,enableDragAndDrop:y,getRuleGroupClassname:R},actions:{onGroupAdd:i,onGroupRemove:d,onPropChange:k,onRuleAdd:D,moveRule:S},disabled:G,parentDisabled:h,shiftUpDisabled:b,shiftDownDisabled:A,combinator:v,rules:w,not:g,dragMonitorId:$="",dropMonitorId:I="",previewRef:H=null,dragRef:x=null,dropRef:ne=null,isDragging:K=!1,isOver:z=!1}=e;bt("ruleGroup",!n),ho(y,!!($||I||H||x||ne));let O=!!h||!!G,T=Je(()=>n&&J(n)?n.combinator:n?ue(p):v??ue(p),[v,p,n]),de=Je(()=>n?{...n,...u?{}:{combinator:T}}:{rules:w,not:g},[T,u,g,n,w]),ke=Je(()=>({header:Fe(E.header,a.header,{[E.dndOver]:z}),shiftActions:Fe(E.shiftActions,a.shiftActions),dragHandle:Fe(E.dragHandle,a.dragHandle),combinators:Fe(E.combinators,a.valueSelector,a.combinators),notToggle:Fe(E.notToggle,a.notToggle),addRule:Fe(E.addRule,a.actionElement,a.addRule),addGroup:Fe(E.addGroup,a.actionElement,a.addGroup),cloneGroup:Fe(E.cloneGroup,a.actionElement,a.cloneGroup),lockGroup:Fe(E.lockGroup,a.actionElement,a.lockGroup),removeGroup:Fe(E.removeGroup,a.actionElement,a.removeGroup),body:Fe(E.body,a.body)}),[a.actionElement,a.addGroup,a.addRule,a.body,a.cloneGroup,a.combinators,a.dragHandle,a.header,a.lockGroup,a.notToggle,a.removeGroup,a.shiftActions,a.valueSelector,z]),Ce=_e((X,Y)=>{O||k("combinator",X,o)},[O,k,o]),De=_e((X,Y,Re)=>{O||k("combinator",X,o.concat([Y]))},[O,k,o]),Be=_e((X,Y)=>{O||k("not",X,o)},[O,k,o]),Qe=_e((X,Y)=>{if(!O){let Re=f();D(Re,o,Y)}},[f,O,D,o]),Ie=_e((X,Y)=>{if(!O){let Re=s(u);i(Re,o,Y)}},[s,O,u,i,o]),q=_e((X,Y)=>{if(!O){let Re=[...oe(o),o[o.length-1]+1];S(o,Re,!0)}},[O,S,o]),xe=_e((X,Y)=>{!O&&!b&&S(o,"up",X?.altKey)},[O,S,o,b]),Le=_e((X,Y)=>{!O&&!A&&S(o,"down",X?.altKey)},[O,S,o,A]),N=_e((X,Y)=>{k("disabled",!O,o)},[O,k,o]),C=_e((X,Y)=>{O||d(o)},[O,d,o]),P=Je(()=>c[t??""],[t,c]),le=Je(()=>uo(P),[P]),ae=Je(()=>u?null:Oe(p,T)?.className??"",[T,p,u]),Ke=Je(()=>R(de),[R,de]),Te=Je(()=>Fe(Ke,ae,E.ruleGroup,a.ruleGroup,{[E.disabled]:O,[E.dndDragging]:K},le),[a.ruleGroup,ae,O,Ke,K,le]),pt=Je(()=>{let X=[];for(let Y=0;Y<de.rules.length;Y++){let Re=[...o,Y];X[Y]={path:Re,disabled:O||m.some(ct=>Ue(Re,ct))}}return X},[O,o,de.rules.length,m]),ot=Je(()=>l({path:o,qbId:r}),[l,o,r]);return{...e,addGroup:Ie,addRule:Qe,accessibleDescription:ot,classNames:ke,cloneGroup:q,combinator:T,disabled:O,dragMonitorId:$,dragRef:x,dropMonitorId:I,dropRef:ne,isDragging:K,isOver:z,onCombinatorChange:Ce,onGroupAdd:i,onIndependentCombinatorChange:De,onNotToggleChange:Be,outerClassName:Te,parentDisabled:h,pathsMemo:pt,previewRef:H,removeGroup:C,ruleGroup:de,shiftGroupUp:xe,shiftGroupDown:Le,toggleLockGroup:N,validationClassName:le,validationResult:P}};import{useMemo as Yn}from"react";var Wr=e=>{let{multiple:t,onChange:o}=e;return Yn(()=>t?r=>o(Array.from(r.target.selectedOptions).map(l=>l.value)):r=>o(r.target.value),[t,o])};import{useCallback as Zn}from"react";var Ge=e=>Zn((t,o)=>{t?.preventDefault(),t?.stopPropagation(),e(t,o)},[e]);import{produce as el}from"immer";import{useCallback as tl,useEffect as ol,useMemo as rl}from"react";var jr=e=>{let{handleOnChange:t,inputType:o,operator:n,value:r,listsAsArrays:l,parseNumbers:a,values:p,type:f,skipHook:s}=e;ol(()=>{!s&&f!=="multiselect"&&!["between","notBetween","in","notIn"].includes(n)&&(Array.isArray(r)||o==="number"&&typeof r=="string"&&r.includes(","))&&t(V(r)[0]??"")},[t,o,n,s,f,r]);let m=rl(()=>V(r),[r]),u=tl((c,y)=>{let R=el(m,i=>{i[y]=j(c,{parseNumbers:a}),y===0&&(n==="between"||n==="notBetween")&&(i.length<2||typeof i[1]>"u")&&(i[1]=ue(p))});t(l?R:ht(R,","))},[t,l,n,a,m,p]);return{valueAsArray:m,multiValueHandler:u}};import{useCallback as nl,useMemo as ll}from"react";var Ur=e=>{let{handleOnChange:t,listsAsArrays:o=!1,multiple:n=!1,value:r}=e,l=nl(p=>{if(n){let f=V(p);t(o?f:ht(f,","))}else t(p)},[t,o,n]),a=ll(()=>n?V(r):r,[n,r]);return{onChange:l,val:a}};import{createContext as al}from"react";var Me=al({});var il=[],ul=e=>ut.createElement(sl,{context:ft,store:Zo},e.children),pl=({props:e})=>{let t=Vr(e),o=t.schema.controls.ruleGroup;return ut.createElement(Me.Provider,{key:t.dndEnabledAttr,value:t.rqbContext},ut.createElement("div",{role:"form",className:t.wrapperClassName,"data-dnd":t.dndEnabledAttr,"data-inlinecombinators":t.inlineCombinatorsAttr},ut.createElement(o,{translations:t.translations,ruleGroup:t.rootGroup,rules:t.rootGroup.rules,...t.combinatorPropObject,not:!!t.rootGroup.not,schema:t.schema,actions:t.actions,id:t.rootGroup.id,path:il,disabled:t.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:t.queryDisabled,context:e.context})))},cl=e=>ut.createElement(ul,null,ut.createElement(pl,{props:e}));import*as re from"react";var Hr=re.memo(e=>{let t=qr(e),o=Ge(t.cloneRule),n=Ge(t.toggleLockRule),r=Ge(t.removeRule),l=Ge(t.shiftRuleUp),a=Ge(t.shiftRuleDown);return re.createElement("div",{ref:t.dndRef,"data-testid":L.rule,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,className:t.outerClassName,"data-rule-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},re.createElement(dl,{...t,cloneRule:o,toggleLockRule:n,removeRule:r,shiftRuleUp:l,shiftRuleDown:a}))}),dl=re.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,fieldSelector:n,operatorSelector:r,valueSourceSelector:l,valueEditor:a,cloneRuleAction:p,lockRuleAction:f,removeRuleAction:s}},combinator:m}=e;return re.createElement(re.Fragment,null,e.schema.showShiftActions&&re.createElement(t,{testID:L.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftRuleUp,shiftDown:e.shiftRuleDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),e.schema.enableDragAndDrop&&re.createElement(o,{testID:L.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),m,re.createElement(n,{testID:L.fields,options:e.schema.fields,title:e.translations.fields.title,value:e.rule.field,operator:e.rule.operator,className:e.classNames.fields,handleOnChange:e.generateOnChangeHandler("field"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectField||e.rule.field!==e.translations.fields.placeholderName)&&re.createElement(re.Fragment,null,re.createElement(r,{testID:L.operators,field:e.rule.field,fieldData:e.fieldData,title:e.translations.operators.title,options:e.operators,value:e.rule.operator,className:e.classNames.operators,handleOnChange:e.generateOnChangeHandler("operator"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectOperator||e.rule.operator!==e.translations.operators.placeholderName)&&!e.hideValueControls&&re.createElement(re.Fragment,null,!["null","notNull"].includes(e.rule.operator)&&e.valueSources.length>1&&re.createElement(l,{testID:L.valueSourceSelector,field:e.rule.field,fieldData:e.fieldData,title:e.translations.valueSourceSelector.title,options:e.valueSourceOptions,value:e.rule.valueSource??"value",className:e.classNames.valueSource,handleOnChange:e.generateOnChangeHandler("valueSource"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),re.createElement(a,{testID:L.valueEditor,field:e.rule.field,fieldData:e.fieldData,title:e.translations.value.title,operator:e.rule.operator,value:e.rule.value,valueSource:e.rule.valueSource??"value",type:e.valueEditorType,inputType:e.inputType,values:e.values,listsAsArrays:e.schema.listsAsArrays,parseNumbers:e.schema.parseNumbers,separator:e.valueEditorSeparator,className:e.classNames.value,handleOnChange:e.generateOnChangeHandler("value"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}))),e.schema.showCloneButtons&&re.createElement(p,{testID:L.cloneRule,label:e.translations.cloneRule.label,title:e.translations.cloneRule.title,className:e.classNames.cloneRule,handleOnClick:e.cloneRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),e.schema.showLockButtons&&re.createElement(f,{testID:L.lockRule,label:e.translations.lockRule.label,title:e.translations.lockRule.title,className:e.classNames.lockRule,handleOnClick:e.toggleLockRule,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockRuleDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),re.createElement(s,{testID:L.removeRule,label:e.translations.removeRule.label,title:e.translations.removeRule.title,className:e.classNames.removeRule,handleOnClick:e.removeRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}))});import*as M from"react";import{Fragment as ml}from"react";var _r=M.memo(e=>{let t=Mr(e),o=Ge(t.addRule),n=Ge(t.addGroup),r=Ge(t.cloneGroup),l=Ge(t.toggleLockGroup),a=Ge(t.removeGroup),p=Ge(t.shiftGroupUp),f=Ge(t.shiftGroupDown);return M.createElement("div",{ref:t.previewRef,title:t.accessibleDescription,className:t.outerClassName,"data-testid":L.ruleGroup,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,"data-rule-group-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},M.createElement("div",{ref:t.dropRef,className:t.classNames.header},M.createElement(fl,{...t,addRule:o,addGroup:n,cloneGroup:r,toggleLockGroup:l,removeGroup:a,shiftGroupUp:p,shiftGroupDown:f})),M.createElement("div",{className:t.classNames.body},M.createElement(yl,{...t,addRule:o,addGroup:n,cloneGroup:r,toggleLockGroup:l,removeGroup:a,shiftGroupUp:p,shiftGroupDown:f})))}),fl=M.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,combinatorSelector:n,notToggle:r,addRuleAction:l,addGroupAction:a,cloneGroupAction:p,lockGroupAction:f,removeGroupAction:s}}}=e;return M.createElement(M.Fragment,null,e.schema.showShiftActions&&e.path.length>0&&M.createElement(t,{key:L.shiftActions,testID:L.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftGroupUp,shiftDown:e.shiftGroupDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&e.schema.enableDragAndDrop&&M.createElement(o,{key:L.dragHandle,testID:L.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&M.createElement("span",{className:"statement"},"Any of the following are true..."),!e.schema.showCombinatorsBetweenRules&&!e.schema.independentCombinators&&M.createElement(n,{key:L.combinators,testID:L.combinators,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema}),e.schema.showNotToggle&&M.createElement(r,{key:L.notToggle,testID:L.notToggle,className:e.classNames.notToggle,title:e.translations.notToggle.title,label:e.translations.notToggle.label,checked:e.ruleGroup.not,handleOnChange:e.onNotToggleChange,level:e.path.length,disabled:e.disabled,path:e.path,context:e.context,validation:e.validationResult,schema:e.schema,ruleGroup:e.ruleGroup}),M.createElement(l,{key:L.addRule,testID:L.addRule,label:e.translations.addRule.label,title:e.translations.addRule.title,className:e.classNames.addRule,handleOnClick:e.addRule,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),M.createElement(a,{key:L.addGroup,testID:L.addGroup,label:e.translations.addGroup.label,title:e.translations.addGroup.title,className:e.classNames.addGroup,handleOnClick:e.addGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showCloneButtons&&e.path.length>=1&&M.createElement(p,{key:L.cloneGroup,testID:L.cloneGroup,label:e.translations.cloneRuleGroup.label,title:e.translations.cloneRuleGroup.title,className:e.classNames.cloneGroup,handleOnClick:e.cloneGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showLockButtons&&M.createElement(f,{key:L.lockGroup,testID:L.lockGroup,label:e.translations.lockGroup.label,title:e.translations.lockGroup.title,className:e.classNames.lockGroup,handleOnClick:e.toggleLockGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockGroupDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.path.length>0&&M.createElement(s,{key:L.removeGroup,testID:L.removeGroup,label:e.translations.removeGroup.label,title:e.translations.removeGroup.title,className:e.classNames.removeGroup,handleOnClick:e.removeGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}))}),yl=M.memo(e=>{let{schema:{controls:{combinatorSelector:t,inlineCombinator:o,ruleGroup:n,rule:r}}}=e;return M.createElement(M.Fragment,null,e.ruleGroup.rules.map((l,a,{length:p})=>{let f=e.pathsMemo[a],s=f.path,m=f.disabled||typeof l!="string"&&l.disabled,u=Ue([0],s),c=e.path.length===0&&a===p-1,y=typeof l=="string"?[...s,l].join("-"):l.id,R=!e.schema.independentCombinators&&e.schema.showCombinatorsBetweenRules;return M.createElement(ml,{key:y},typeof l=="string"?M.createElement(o,{key:`${L.inlineCombinator}-independent`,options:e.schema.combinators,value:l,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:i=>e.onIndependentCombinatorChange(i,a),rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:s,disabled:m,schema:e.schema}):F(l)?M.createElement(n,{key:L.ruleGroup,id:l.id,schema:e.schema,actions:e.actions,path:s,translations:e.translations,ruleGroup:l,rules:l.rules,combinator:J(l)?l.combinator:void 0,not:!!l.not,disabled:m,parentDisabled:e.parentDisabled||e.disabled,shiftUpDisabled:u,shiftDownDisabled:c,context:e.context}):M.createElement(r,{key:L.rule,id:l.id,rule:l,field:l.field,operator:l.operator,value:l.value,valueSource:l.valueSource,schema:e.schema,actions:e.actions,path:s,disabled:m,parentDisabled:e.parentDisabled||e.disabled,translations:e.translations,shiftUpDisabled:u,shiftDownDisabled:c,context:e.context,combinator:a===1&&R?M.createElement(o,{key:L.inlineCombinator,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:s,disabled:e.disabled,schema:e.schema}):a>1&&R?M.createElement("span",{className:e.classNames.combinators},e.combinator):e.path.length===0&&R?M.createElement("span",{className:e.classNames.combinators},"Where"):M.createElement("span",{className:e.classNames.combinators})}))}))});import*as Ro from"react";var Jr=e=>Ro.createElement("div",{"data-testid":e.testID,className:e.className},Ro.createElement("button",{disabled:e.disabled||e.shiftUpDisabled,onClick:e.shiftUp,title:e.titles?.shiftUp},e.labels?.shiftUp),Ro.createElement("button",{disabled:e.disabled||e.shiftDownDisabled,onClick:e.shiftDown,title:e.titles?.shiftDown},e.labels?.shiftDown));import*as Ee from"react";var Kr=e=>{let{operator:t,value:o,handleOnChange:n,title:r,className:l,type:a="text",inputType:p="text",values:f=[],listsAsArrays:s,parseNumbers:m,fieldData:u,disabled:c,separator:y=null,testID:R,selectorComponent:i=e.schema.controls.valueSelector,...d}=e,{valueAsArray:k,multiValueHandler:D}=jr(e);if(t==="null"||t==="notNull")return null;let S=u?.placeholder??"",G=["in","notIn"].includes(t)?"text":p||"text";if((t==="between"||t==="notBetween")&&(a==="select"||a==="text")){let h=["from","to"].map((b,A)=>a==="text"?Ee.createElement("input",{key:b,type:G,placeholder:S,value:k[A]??"",className:E.valueListItem,disabled:c,onChange:v=>D(v.target.value,A)}):Ee.createElement(i,{...d,schema:e.schema,key:b,className:E.valueListItem,handleOnChange:v=>D(v,A),disabled:c,value:k[A]??ue(f),options:f,listsAsArrays:s}));return Ee.createElement("span",{"data-testid":R,className:l,title:r},h[0],y,h[1])}switch(a){case"select":case"multiselect":return Ee.createElement(i,{...d,schema:e.schema,testID:R,className:l,title:r,handleOnChange:n,disabled:c,value:o,options:f,multiple:a==="multiselect",listsAsArrays:s});case"textarea":return Ee.createElement("textarea",{"data-testid":R,placeholder:S,value:o,title:r,className:l,disabled:c,onChange:h=>n(h.target.value)});case"switch":case"checkbox":return Ee.createElement("input",{"data-testid":R,type:"checkbox",className:l,title:r,onChange:h=>n(h.target.checked),checked:!!o,disabled:c});case"radio":return Ee.createElement("span",{"data-testid":R,className:l,title:r},f.map(h=>Ee.createElement("label",{key:h.name},Ee.createElement("input",{type:"radio",value:h.name,disabled:c,checked:o===h.name,onChange:b=>n(b.target.value)}),h.label)))}return Ee.createElement("input",{"data-testid":R,type:G,placeholder:S,value:o,title:r,className:l,disabled:c,onChange:h=>n(j(h.target.value,{parseNumbers:m}))})};import*as zr from"react";var Tt=e=>{let{onChange:t,val:o}=Ur(e),n=Wr({multiple:e.multiple,onChange:t});return zr.createElement("select",{"data-testid":e.testID,className:e.className,value:o,title:e.title,disabled:e.disabled,multiple:!!e.multiple,onChange:n},Fr(e.options))};var qt={actionElement:Ve,addGroupAction:Ve,addRuleAction:Ve,cloneGroupAction:Ve,cloneRuleAction:Ve,combinatorSelector:Tt,dragHandle:_o,fieldSelector:Tt,inlineCombinator:Xo,lockGroupAction:Ve,lockRuleAction:Ve,notToggle:Yo,operatorSelector:Tt,removeGroupAction:Ve,removeRuleAction:Ve,rule:Hr,ruleGroup:_r,shiftActions:Jr,valueEditor:Kr,valueSelector:Tt,valueSourceSelector:Tt};export{Ve as ActionElement,_o as DragHandle,Xo as InlineCombinator,me as LogType,Yo as NotToggle,cl as QueryBuilder,Me as QueryBuilderContext,ft as QueryBuilderStateContext,ul as QueryBuilderStateProvider,Hr as Rule,dl as RuleComponents,_r as RuleGroup,yl as RuleGroupBodyComponents,fl as RuleGroupHeaderComponents,Jr as ShiftActions,L as TestID,Kr as ValueEditor,Tt as ValueSelector,Eo as add,Rt as convertFromIC,ia as convertQuery,ir as convertToIC,cl as default,Hs as defaultCELValueProcessor,qe as defaultCombinators,xl as defaultCombinatorsExtended,zo as defaultControlClassnames,qt as defaultControlElements,_t as defaultJoinChar,Us as defaultMongoDBValueProcessor,Gl as defaultOperatorNegationMap,Ko as defaultOperators,sn as defaultPlaceholderFieldGroupLabel,an as defaultPlaceholderFieldLabel,Ut as defaultPlaceholderFieldName,pn as defaultPlaceholderOperatorGroupLabel,un as defaultPlaceholderOperatorLabel,Ht as defaultPlaceholderOperatorName,gt as defaultRuleProcessorCEL,no as defaultRuleProcessorElasticSearch,ao as defaultRuleProcessorJSONata,so as defaultRuleProcessorJsonLogic,Gt as defaultRuleProcessorMongoDB,kt as defaultRuleProcessorParameterized,wo as defaultRuleProcessorSQL,xt as defaultRuleProcessorSpEL,_s as defaultSpELValueProcessor,Jt as defaultTranslations,da as defaultValidator,js as defaultValueProcessor,et as defaultValueProcessorByRule,Js as defaultValueProcessorCELByRule,Ks as defaultValueProcessorMongoDBByRule,zs as defaultValueProcessorSpELByRule,Zt as filterFieldsByComparator,ce as findPath,Is as formatQuery,gr as generateAccessibleDescription,fe as generateID,Rr as getCommonAncestorPath,fi as getCompatContextProvider,ue as getFirstOption,Oe as getOption,oe as getParentPath,rt as getQuerySelectorById,uo as getValidationClassNames,Gr as getValueSourcesUtil,Kt as groupInvalidReasons,ji as insert,si as isAncestor,Se as isFlexibleOptionGroupArray,Aa as isFullOptionGroupArray,Yt as isOptionGroupArray,se as isPojo,F as isRuleGroup,J as isRuleGroupType,We as isRuleGroupTypeIC,pe as isRuleOrGroupValid,hr as isValidationResult,ht as joinWith,An as jsonLogicAdditionalOperators,vr as mergeClassnames,ie as mergeTranslation,Ti as mergeTranslations,Ye as messages,Pr as move,ta as nullFreeArray,lr as numericRegex,Or as objectEntries,po as objectKeys,j as parseNumber,vt as pathIsDisabled,Ue as pathsAreEqual,Ln as preferProp,Cr as prepareRule,co as prepareRuleGroup,Tr as prepareRuleOrGroup,Zo as queryBuilderStore,$r as regenerateID,Lt as regenerateIDs,Sr as remove,il as rootPath,xn as splitBy,E as standardClassnames,V as toArray,mr as toFlatOptionArray,be as toFullOption,je as toFullOptionList,$o as toFullOptionMap,Fr as toOptions,zi as transformQuery,W as trimIfString,at as uniqByIdentifier,Ga as uniqByName,Xt as uniqOptGroups,dr as uniqOptList,Nr as update,nr as useControlledOrUncontrolled,bt as useDeprecatedProps,It as useMergedContext,Yi as usePreferAnyProp,fo as usePreferProp,rr as usePrevious,Vr as useQueryBuilder,Ql as useQueryBuilderQuery,Br as useQueryBuilderSchema,tr as useQueryBuilderSelector,Lr as useQueryBuilderSetup,ho as useReactDndWarning,qr as useRule,Mr as useRuleGroup,Wr as useSelectElementChangeHandler,Ge as useStopEventPropagation,jr as useValueEditor,Ur as useValueSelector};
//# sourceMappingURL=react-querybuilder.production.mjs.map