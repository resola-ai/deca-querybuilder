import*as wo from"react";var Qe=e=>wo.createElement("button",{type:"button","data-testid":e.testID,disabled:e.disabled&&!e.disabledTranslation,className:e.className,title:e.disabledTranslation&&e.disabled?e.disabledTranslation.title:e.title,onClick:t=>e.handleOnClick(t)},e.disabledTranslation&&e.disabled?e.disabledTranslation.label:e.label);import*as Bo from"react";import{forwardRef as zn}from"react";var Io=zn((e,t)=>Bo.createElement("span",{"data-testid":e.testID,ref:t,className:e.className,title:e.title},e.label));import*as yo from"react";var ko="~",wt="------",Bt=ko,Kn=wt,Xn=wt,It=ko,Yn=wt,Zn=wt,kt=",",Qo={fields:{title:"Fields",placeholderName:Bt,placeholderLabel:Kn,placeholderGroupLabel:Xn},operators:{title:"Operators",placeholderName:It,placeholderLabel:Yn,placeholderGroupLabel:Zn},value:{title:"Value"},removeRule:{label:"\u2A2F",title:"Remove rule"},removeGroup:{label:"\u2A2F",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"\u29C9",title:"Clone rule"},cloneRuleGroup:{label:"\u29C9",title:"Clone group"},shiftActionUp:{label:"\u02C4",title:"Shift up"},shiftActionDown:{label:"\u02C5",title:"Shift down"},dragHandle:{label:"\u205E\u205E",title:"Drag handle"},lockRule:{label:"\u{1F513}",title:"Lock rule"},lockGroup:{label:"\u{1F513}",title:"Lock group"},lockRuleDisabled:{label:"\u{1F512}",title:"Unlock rule"},lockGroupDisabled:{label:"\u{1F512}",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},Vo=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],cl={"=":"!=","!=":"=","<":">=","<=":">",">":"<=",">=":"<",beginsWith:"doesNotBeginWith",doesNotBeginWith:"beginsWith",endsWith:"doesNotEndWith",doesNotEndWith:"endsWith",contains:"doesNotContain",doesNotContain:"contains",between:"notBetween",notBetween:"between",in:"notIn",notIn:"in",notNull:"null",null:"notNull"},Ue=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}],pl=[...Ue,{name:"xor",value:"xor",label:"XOR"}],w={queryBuilder:"queryBuilder",ruleGroup:"ruleGroup",header:"ruleGroup-header",body:"ruleGroup-body",combinators:"ruleGroup-combinators",addRule:"ruleGroup-addRule",addGroup:"ruleGroup-addGroup",cloneRule:"rule-cloneRule",cloneGroup:"ruleGroup-cloneGroup",removeGroup:"ruleGroup-remove",notToggle:"ruleGroup-notToggle",rule:"rule",fields:"rule-fields",operators:"rule-operators",value:"rule-value",removeRule:"rule-remove",betweenRules:"betweenRules",valid:"queryBuilder-valid",invalid:"queryBuilder-invalid",shiftActions:"shiftActions",dndDragging:"dndDragging",dndOver:"dndOver",dndCopy:"dndCopy",dragHandle:"queryBuilder-dragHandle",disabled:"queryBuilder-disabled",lockRule:"rule-lock",lockGroup:"ruleGroup-lock",valueSource:"rule-valueSource",valueListItem:"rule-value-list-item",branches:"queryBuilder-branches"},Lo={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:""},Qt={empty:"empty",invalidCombinator:"invalid combinator",invalidIndependentCombinators:"invalid independent combinators"},Q={rule:"rule",ruleGroup:"rule-group",inlineCombinator:"inline-combinator",addGroup:"add-group",removeGroup:"remove-group",cloneGroup:"clone-group",cloneRule:"clone-rule",addRule:"add-rule",removeRule:"remove-rule",combinators:"combinators",fields:"fields",operators:"operators",valueEditor:"value-editor",notToggle:"not-toggle",shiftActions:"shift-actions",dragHandle:"drag-handle",lockRule:"lock-rule",lockGroup:"lock-group",valueSourceSelector:"value-source-selector"},Re={parentPathDisabled:"action aborted: parent path disabled",pathDisabled:"action aborted: path is disabled",queryUpdate:"query updated",onAddRuleFalse:"onAddRule callback returned false",onAddGroupFalse:"onAddGroup callback returned false",onRemoveFalse:"onRemove callback returned false",add:"rule or group added",remove:"rule or group removed",update:"rule or group updated",move:"rule or group moved"};var qo=e=>{let{component:t,...o}=e;return yo.createElement("div",{className:w.betweenRules,"data-testid":Q.inlineCombinator},yo.createElement(t,{...o,testID:Q.combinators}))};import*as ho from"react";var Mo=e=>ho.createElement("label",{"data-testid":e.testID,className:e.className,title:e.title},ho.createElement("input",{type:"checkbox",onChange:t=>e.handleOnChange(t.target.checked),checked:!!e.checked,disabled:e.disabled}),e.label);import*as lt from"react";import{Provider as Yr}from"react-redux";var _e={errorInvalidIndependentCombinatorsProp:"QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorUnnecessaryIndependentCombinatorsProp:"QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorDeprecatedRuleGroupProps:"A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",errorDeprecatedRuleProps:"A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",errorBothQueryDefaultQuery:"QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",errorUncontrolledToControlled:"QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorControlledToUncontrolled:"QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorEnabledDndWithoutReactDnD:"QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd."};import{createDispatchHook as ar,createStoreHook as ir}from"react-redux";import{configureStore as rr}from"@reduxjs/toolkit";import*as Wo from"react";import{createSelectorHook as lr}from"react-redux";import{createSlice as er}from"@reduxjs/toolkit";var tr={},ct=er({name:"queries",initialState:tr,reducers:{setQueryState:(e,{payload:{qbId:t,query:o}})=>{e[t]=o}},selectors:{getQuerySelectorById:(e,t)=>e[t]}});import{createSlice as or}from"@reduxjs/toolkit";var nr={[_e.errorInvalidIndependentCombinatorsProp]:!1,[_e.errorUnnecessaryIndependentCombinatorsProp]:!1,[_e.errorDeprecatedRuleGroupProps]:!1,[_e.errorDeprecatedRuleProps]:!1,[_e.errorBothQueryDefaultQuery]:!1,[_e.errorUncontrolledToControlled]:!1,[_e.errorControlledToUncontrolled]:!1,[_e.errorEnabledDndWithoutReactDnD]:!1},$t=or({name:"warnings",initialState:nr,reducers:{rqbWarn:(e,{payload:t})=>{e[t]||(console.error(t),e[t]=!0)}}});var sr={queries:ct.getInitialState(),warnings:$t.getInitialState()},jo=rr({reducer:{queries:ct.reducer,warnings:$t.reducer},preloadedState:sr,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),pt=Wo.createContext(null),Uo=lr(pt),Ze=e=>t=>ct.selectors.getQuerySelectorById({queries:t.queries},e);var Vt=({payload:e,onQueryChange:t})=>o=>{o(ct.actions.setQueryState(e)),typeof t=="function"&&t(e.query)},dt=ar(pt),_o=ir(pt),{rqbWarn:Pl}=$t.actions;import{useRef as ur}from"react";var Ho=e=>{let t=ur({value:e,prev:null}),o=t.current.value;return e!==o&&(t.current={value:e,prev:o}),t.current.prev};var Jo=e=>{let t=dt(),{defaultQuery:o,queryProp:n}=e,r=Ho(!!n)};function mt(e,t,o){let n=dt()}import{forwardRef as Er,useContext as Pr,useMemo as $o}from"react";var cr=(e,t=kt)=>typeof e=="string"?e.split(`\\${t}`).map(o=>o.split(t)).reduce((o,n,r)=>r===0?n:[...o.slice(0,o.length-1),`${o[o.length-1]}${t}${n[0]}`,...n.slice(1)],[]):[],ft=(e,t=kt)=>e.map(o=>`${o??""}`.replaceAll(t,`\\${t}`)).join(t),_=e=>typeof e=="string"?e.trim():e,M=e=>Array.isArray(e)?e.map(_):typeof e=="string"?cr(e,kt).filter(t=>!/^\s*$/.test(t)).map(t=>t.trim()):typeof e=="number"?[e]:[],Hl=e=>e.every(t=>t===!1||(t??!1)!==!1);import{numericRegex as pr}from"numeric-quantity";var zo=new RegExp(pr.source.replace(/^\^/,"^\\s*").replace(/\$$/,"\\s*$")),le=e=>e===null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype;var D=e=>le(e)&&"rules"in e&&Array.isArray(e.rules),J=e=>D(e)&&typeof e.combinator=="string",Xe=e=>D(e)&&typeof e.combinator>"u";var Ko=e=>D(e)?Xo(e):e,Xo=e=>{let t=[],o=r=>t.push(Ko(r)),n=0;for(let r=0;r<e.rules.length;r+=2)if(e.rules.length===1)o(e.rules[0]);else if(e.rules[r+1]==="and"){n=r;let l=1;for(;e.rules[n+l]==="and";)r+=2,l+=2;t.push({rules:e.rules.slice(n,r+1).map(Ko)}),r-=2}else e.rules[r+1]==="or"&&(r===0||r===e.rules.length-3?((r===0||e.rules[r-1]==="or")&&o(e.rules[r]),o(e.rules[r+1]),r===e.rules.length-3&&o(e.rules[r+2])):(e.rules[r-1]==="and"||o(e.rules[r]),o(e.rules[r+1])));return t.length===1&&typeof t[0]=="object"&&D(t[0])?{...e,...t[0]}:{...e,rules:t}},yt=e=>{if(J(e))return e;let t=Xo(e),o=t.rules.map(l=>typeof l=="string"||!D(l)?l:yt(l)),n=o.length<2?"and":o[1],r=o.filter(l=>typeof l!="string");return{...t,combinator:n,rules:r}},Yo=e=>{if(Xe(e))return e;let{combinator:t,...o}=e,n=[],{length:r}=e.rules;return e.rules.forEach((l,s)=>{D(l)?n.push(Yo(l)):n.push(l),t&&s<r-1&&n.push(t)}),{...o,rules:n}};function es(e){return Xe(e)?yt(e):Yo(e)}var rs=e=>{let t={},o=r=>{},n=r=>{let l=[];if(r.rules.length===0)l.push(Qt.empty);else if(!J(r)){let s=!1;for(let a=0;a<r.rules.length&&!s;a++)(a%2===0&&typeof r.rules[a]=="string"||a%2===1&&typeof r.rules[a]!="string"||a%2===1&&typeof r.rules[a]=="string"&&!Ue.map(i=>i.name).includes(r.rules[a]))&&(s=!0);s&&l.push(Qt.invalidIndependentCombinators)}J(r)&&!Ue.map(s=>s.name).includes(r.combinator)&&r.rules.length>1&&l.push(Qt.invalidCombinator),r.id&&(l.length?t[r.id]={valid:!1,reasons:l}:t[r.id]=!0),r.rules.forEach(s=>{typeof s=="string"||(D(s)?n(s):o(s))})};return n(e),t};import{produce as tn}from"immer";var Zo=e=>le(e)&&"name"in e&&typeof e.name=="string",en=e=>le(e)&&"value"in e&&typeof e.value=="string";function me(e,t){return tn(n=>{let r={},l=!!t;if(Zo(n)&&!en(n)?(r.value=n.name,l=!0):!Zo(n)&&en(n)&&(r.name=n.value,l=!0),l)return Object.assign({},t,n,r)})(e)}function Ve(e,t){return Array.isArray(e)?tn(n=>{if(Te(n))for(let r of n)r.options.forEach((l,s)=>r.options[s]=me(l,t));else n.forEach((r,l)=>n[l]=me(r,t))})(e):[]}function bo(e,t){return Object.fromEntries(Object.entries(e).map(([o,n])=>[o,me(n,t)]))}var ds=e=>et(e),et=e=>{let t=new Set,o=[];return e.forEach(n=>{t.has(n.value??n.name)||(t.add(n.value??n.name),o.push(n))}),e.length===o.length?e:o},Lt=e=>{let t=new Set,o=new Set,n=[];return e.forEach(r=>{if(!t.has(r.label)){t.add(r.label);let l=[];r.options.forEach(s=>{o.has(s.value??s.name)||(o.add(s.value??s.name),l.push(me(s)))}),n.push({...r,options:l})}}),n},on=e=>Te(e)?Lt(e):et(e.map(t=>me(t)));var qt=e=>Array.isArray(e)&&e.length>0&&le(e[0])&&"options"in e[0],Te=e=>Array.isArray(e)&&e.length>0&&le(e[0])&&"options"in e[0]&&le(e[0].options[0])&&("name"in e[0].options[0]||"value"in e[0].options[0]),hs=e=>Array.isArray(e)&&e.length>0&&le(e[0])&&"options"in e[0]&&le(e[0].options[0])&&"name"in e[0].options[0]&&le(e[0].options[0])&&"value"in e[0].options[0],ve=(e,t)=>(qt(e)?e.flatMap(o=>o.options):e).find(o=>o.name===t),de=e=>!Array.isArray(e)||e.length===0?null:Te(e)?e[0].options[0].value??e[0].options[0].name:e[0].value??e[0].name,nn=e=>et(qt(e)?e.flatMap(t=>t.options):e);var rn=(e,t,o)=>{let n=me(e),r=me(o);return n.value===r.value?!1:typeof n.comparator=="string"?n[n.comparator]===r[n.comparator]:n.comparator?.(r,t)??!1},Mt=(e,t,o)=>{if(!e.comparator){let n=r=>(r.value??r.name)!==(e.value??e.name);return Te(t)?t.map(r=>({...r,options:r.options.filter(n)})):t.filter(n)}return Te(t)?t.map(n=>({...n,options:n.options.filter(r=>rn(e,o,r))})).filter(n=>n.options.length>0):t.filter(n=>rn(e,o,n))};import{numericQuantity as dr}from"numeric-quantity";var H=(e,t={})=>{if(!t.parseNumbers||typeof e=="bigint"||typeof e=="number")return e;if(t.parseNumbers==="native")return parseFloat(e);let o=dr(e,{allowTrailingInvalid:t.parseNumbers==="enhanced",romanNumerals:!0,round:!1});return isNaN(o)?e:o};var Wt=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},Ro={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},go={and:"&&",or:"||"},mr={startsWith:(e,t)=>typeof e=="string"&&e.startsWith(t),endsWith:(e,t)=>typeof e=="string"&&e.endsWith(t)},xo=e=>({...e,rules:e.rules.map(t=>{if(typeof t=="string")return t;if(D(t))return xo(t);let{value:o}=t;return typeof o=="string"&&(o=H(o,{parseNumbers:!0})),{...t,value:o}})}),Se=e=>typeof e=="string"&&e.length>0||typeof e=="number"&&!isNaN(e)||typeof e!="string"&&typeof e!="number",I=(e,t)=>t&&(typeof e=="number"||typeof e=="bigint"||typeof e=="string"&&zo.test(e)),ln=e=>e.length>=3,Ye=(e=["",""])=>Array.isArray(e)?e:typeof e=="string"?[e,e]:e??["",""],He=e=>e===null||typeof e>"u"||e==="";var jt=e=>/^(does)?not/i.test(e),tt=(e,t)=>typeof e!="string"||!t?e:e.replaceAll('"','\\"'),ht=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l}={})=>{let s=n==="field",a=t.replace(/^=$/,"=="),i=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||i?_(o):`"${tt(o,r)}"`}`;case"contains":case"doesNotContain":return`${jt(a)?"!":""}${e}.contains(${s?_(o):`"${tt(o,r)}"`})`;case"beginsWith":case"doesNotBeginWith":return`${jt(a)?"!":""}${e}.startsWith(${s?_(o):`"${tt(o,r)}"`})`;case"endsWith":case"doesNotEndWith":return`${jt(a)?"!":""}${e}.endsWith(${s?_(o):`"${tt(o,r)}"`})`;case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let u=jt(a),c=M(o);return`${u?"!(":""}${e} in [${c.map(p=>s||I(p,l)?`${_(p)}`:`"${tt(p,r)}"`).join(", ")}]${u?")":""}`}case"between":case"notBetween":{let u=M(o);if(u.length>=2&&!He(u[0])&&!He(u[1])){let[c,p]=u,y=I(c,!0)?H(c,{parseNumbers:!0}):NaN,f=I(p,!0)?H(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`"${tt(c,r)}"`:y,b=isNaN(f)?s?`${p}`:`"${tt(p,r)}"`:f;if(h===y&&b===f&&f<y){let N=f;b=y,h=N}return t==="between"?`(${e} >= ${h} && ${e} <= ${b})`:`(${e} < ${h} || ${e} > ${b})`}else return""}}return""};var Fe=e=>typeof e!="string"?e:e.replaceAll("\\","\\\\").replaceAll('"','\\"'),bt=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{let l=n==="field",s=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,r);if(t==="="&&!l)return`{"${e}":${s?_(o):`"${Fe(o)}"`}}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{let a=Ro[t];return l?`{"$expr":{"${a}":["$${e}","$${o}"]}}`:`{"${e}":{"${a}":${s?_(o):`"${Fe(o)}"`}}}`}case"contains":return l?`{"$where":"this.${e}.includes(this.${o})"}`:`{"${e}":{"$regex":"${Fe(o)}"}}`;case"beginsWith":return l?`{"$where":"this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$regex":"^${Fe(o)}"}}`;case"endsWith":return l?`{"$where":"this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$regex":"${Fe(o)}$"}}`;case"doesNotContain":return l?`{"$where":"!this.${e}.includes(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${Fe(o)}"}}}`;case"doesNotBeginWith":return l?`{"$where":"!this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"^${Fe(o)}"}}}`;case"doesNotEndWith":return l?`{"$where":"!this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${Fe(o)}$"}}}`;case"null":return`{"${e}":null}`;case"notNull":return`{"${e}":{"$ne":null}}`;case"in":case"notIn":{let a=M(o);return l?`{"$where":"${t==="notIn"?"!":""}[${a.map(i=>`this.${i}`).join(",")}].includes(this.${e})"}`:`{"${e}":{"${Ro[t]}":[${a.map(i=>I(i,r)?`${_(i)}`:`"${Fe(i)}"`).join(",")}]}}`}case"between":case"notBetween":{let a=M(o);if(a.length>=2&&Se(a[0])&&Se(a[1])){let[i,u]=a,c=I(i,!0)?H(i,{parseNumbers:!0}):NaN,p=I(u,!0)?H(u,{parseNumbers:!0}):NaN,y=l||!isNaN(c)?`${i}`:`"${Fe(i)}"`,f=l||!isNaN(p)?`${u}`:`"${Fe(u)}"`;return t==="between"?l?`{"$and":[{"$expr":{"$gte":["$${e}","$${y}"]}},{"$expr":{"$lte":["$${e}","$${f}"]}}]}`:`{"${e}":{"$gte":${y},"$lte":${f}}}`:l?`{"$or":[{"$expr":{"$lt":["$${e}","$${y}"]}},{"$expr":{"$gt":["$${e}","$${f}"]}}]}`:`{"$or":[{"${e}":{"$lt":${y}}},{"${e}":{"$gt":${f}}}]}`}else return""}}return""};var Ut=e=>/^(does)?not/i.test(e),Go=(e,t)=>t?`!(${e})`:`${e}`,ot=(e,t)=>typeof e!="string"||!t?e:e.replaceAll("'","\\'"),Rt=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l}={})=>{let s=n==="field",a=t.replace(/^=$/,"=="),i=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||i?_(o):`'${ot(o,r)}'`}`;case"contains":case"doesNotContain":return Go(`${e} matches ${s||i?_(o):`'${ot(o,r)}'`}`,Ut(a));case"beginsWith":case"doesNotBeginWith":{let u=s?`'^'.concat(${_(o)})`:`'${typeof o=="string"&&!o.startsWith("^")||i?"^":""}${ot(o,r)}'`;return Go(`${e} matches ${u}`,Ut(a))}case"endsWith":case"doesNotEndWith":{let u=s?`${_(o)}.concat('$')`:`'${ot(o,r)}${typeof o=="string"&&!o.endsWith("$")||i?"$":""}'`;return Go(`${e} matches ${u}`,Ut(a))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let u=Ut(a)?"!":"",c=M(o);return c.length>0?`${u}(${c.map(p=>`${e} == ${s||I(p,l)?`${_(p)}`:`'${ot(p,r)}'`}`).join(" or ")})`:""}case"between":case"notBetween":{let u=M(o);if(u.length>=2&&!He(u[0])&&!He(u[1])){let[c,p]=u,y=I(c,!0)?H(c,{parseNumbers:!0}):NaN,f=I(p,!0)?H(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`'${ot(c,r)}'`:y,b=isNaN(f)?s?`${p}`:`'${ot(p,r)}'`:f;if(h===y&&b===f&&f<y){let N=f;b=y,h=N}return t==="between"?`(${e} >= ${h} and ${e} <= ${b})`:`(${e} < ${h} or ${e} > ${b})`}else return""}}return""};var fr=(e,t,o)=>o&&typeof e=="string"?e.replaceAll(`${t}`,`${t}${t}`):e,Je=({operator:e,value:t,valueSource:o},{escapeQuotes:n,parseNumbers:r,quoteFieldNamesWith:l,quoteValuesWith:s}={})=>{let a=o==="field",[i,u]=Ye(l),c=e.toLowerCase(),p=s||"'",y=b=>fr(b,p,n),f=b=>`${p}${y(b)}${p}`,h=b=>`${i}${b}${u}`;switch(c){case"null":case"notnull":return"";case"in":case"notin":{let b=M(t);return b.length>0?`(${b.map(N=>a?h(N):I(N,r)?`${_(N)}`:`${f(N)}`).join(", ")})`:""}case"between":case"notbetween":{let b=M(t);if(b.length>=2&&Se(b[0])&&Se(b[1])){let[N,k]=b;return a?`${h(N)} and ${h(k)}`:I(N,r)&&I(k,r)?`${_(N)} and ${_(k)}`:`${f(N)} and ${f(k)}`}return""}case"contains":case"doesnotcontain":return a?`${p}%${p} || ${h(t)} || ${p}%${p}`:`${p}%${y(t)}%${p}`;case"beginswith":case"doesnotbeginwith":return a?`${h(t)} || ${p}%${p}`:`${p}${y(t)}%${p}`;case"endswith":case"doesnotendwith":return a?`${p}%${p} || ${h(t)}`:`${p}%${y(t)}${p}`}return typeof t=="boolean"?t?"TRUE":"FALSE":a?h(t):I(t,r)?`${_(t)}`:`${f(t)}`};var yr={"<":"lt","<=":"lte",">":"gt",">=":"gte"},_t=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,Ao=e=>e?.replace(/('|\\)/g,"\\$1"),hr={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},br=(e,t,o)=>{let n=`doc['${e}'].${hr[t]??t}(doc['${o}'])`;return t.startsWith("d")?`!${n}`:n},Tt=(e,t)=>typeof e=="boolean"?e:I(e,t)?H(e,{parseNumbers:t}):e,Ht=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{if(n==="field"){if(M(o).some(s=>typeof s!="string"))return!1;let l=Ao(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{let s=t==="="?"==":t,a=Ao(o);return a?{bool:{filter:{script:{script:`doc['${l}'] ${s} doc['${a}']`}}}}:!1}case"in":case"notIn":{let s=M(o);if(s.length>0){let a=s.map(i=>({bool:{filter:{script:{script:`doc['${l}'] == doc['${i}']`}}}}));return{bool:t==="in"?{should:a}:{must_not:a}}}return!1}case"between":case"notBetween":{let s=M(o);if(s.length>=2&&s[0]&&s[1]){let a=`doc['${l}'] >= doc['${s[0]}'] && doc['${l}'] <= doc['${s[1]}']`;return{bool:{filter:{script:{script:t==="notBetween"?`!(${a})`:a}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{let s=Ao(o);return s?{bool:{filter:{script:{script:br(l,t,s)}}}}:!1}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[yr[t]]:Tt(o,r)}}};case"=":return{term:{[e]:Tt(o,r)}};case"!=":return{bool:{must_not:{term:{[e]:Tt(o,r)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{let l=M(o).map(s=>Tt(s,r));if(l.length>0){let s=l.map(a=>({term:{[e]:Tt(a,r)}}));return{bool:t==="in"?{should:s}:{must_not:s}}}return!1}case"between":case"notBetween":{let l=M(o);if(l.length>=2&&Se(l[0])&&Se(l[1])){let[s,a]=l;if(I(s,!0)&&I(a,!0)){let i=H(s,{parseNumbers:!0}),u=H(a,{parseNumbers:!0});if(u<i){let c=u;a=i,s=c}else s=i,a=u}return _t(t,{range:{[e]:{gte:s,lte:a}}})}return!1}case"contains":case"doesNotContain":return _t(t,{regexp:{[e]:{value:o}}});case"beginsWith":case"doesNotBeginWith":return _t(t,{regexp:{[e]:{value:`^${o}`}}});case"endsWith":case"doesNotEndWith":return _t(t,{regexp:{[e]:{value:`${o}$`}}})}return!1};var Jt=e=>/^(does)?not/i.test(e),St=(e,t)=>`"${typeof e!="string"||!t?e:e.replaceAll('"','\\"')}"`,Nt=(e,t)=>t?`$not(${e})`:`${e}`,sn=e=>`${e}`.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),zt=({field:e,operator:t,value:o,valueSource:n},{escapeQuotes:r,parseNumbers:l=!0,quoteFieldNamesWith:s=["",""]}={})=>{let a=n==="field",i=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l),[u,c]=Ye(s),p=y=>`${u}${y}${c}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return`${p(e)} ${t} ${a?p(_(o)):i?_(o):St(o,r)}`;case"contains":case"doesNotContain":return Nt(`$contains(${p(e)}, ${a?p(_(o)):St(o,r)})`,Jt(t));case"beginsWith":case"doesNotBeginWith":return Nt(a?`$substring(${p(e)}, 0, $length(${p(_(o))})) = ${p(_(o))}`:`$contains(${p(e)}, /^${sn(o)}/)`,Jt(t));case"endsWith":case"doesNotEndWith":return Nt(a?`$substring(${p(e)}, $length(${p(e)}) - $length(${p(_(o))})) = ${p(_(o))}`:`$contains(${p(e)}, /${sn(o)}$/)`,Jt(t));case"null":return`${p(e)} = null`;case"notNull":return`${p(e)} != null`;case"in":case"notIn":{let y=M(o);return Nt(`${p(e)} in [${y.map(f=>a?`${p(_(f))}`:I(f,l)?`${_(f)}`:St(f,r)).join(", ")}]`,Jt(t))}case"between":case"notBetween":{let y=M(o);if(y.length>=2&&!He(y[0])&&!He(y[1])){let[f,h]=y,b=I(f,!0)?H(f,{parseNumbers:!0}):NaN,N=I(h,!0)?H(h,{parseNumbers:!0}):NaN,k=isNaN(b)?a?`${f}`:f:b,V=isNaN(N)?a?`${h}`:h:N;if(k===b&&V===N&&N<b){let m=N;V=b,k=m}let F=I(f,l)&&I(h,l),g=`${p(e)} >= ${a?p(f):F?k:St(k,r)} and ${p(e)} <= ${a?p(h):F?V:St(V,r)}`;return t==="between"?`(${g})`:Nt(g,!0)}else return""}}return""};var Rr=e=>e.replace(/^(=)$/,"$1=").replace(/^notNull$/i,"!=").replace(/^null$/i,"=="),Et=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,Kt=({field:e,operator:t,value:o,valueSource:n},{parseNumbers:r}={})=>{let l=n==="field",s={var:e},a=i=>l?{var:`${i}`}:I(i,r)?H(i,{parseNumbers:r}):i;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[Rr(t)]:[s,a(o)]};case"null":case"notNull":return{[`${t==="notNull"?"!":"="}=`]:[s,null]};case"in":case"notIn":{let i=M(o).map(a);return Et(t,{in:[s,i]})}case"between":case"notBetween":{let i=M(o);if(i.length>=2&&Se(i[0])&&Se(i[1])){let[u,c]=i;if(!l&&I(u,!0)&&I(c,!0)){let y=H(u,{parseNumbers:!0}),f=H(c,{parseNumbers:!0});if(f<y){let h=f;c=y,u=h}else u=y,c=f}else l&&(u={var:u},c={var:c});return Et(t,{"<=":[u,s,c]})}return!1}case"contains":case"doesNotContain":{let i={in:[a(o),s]};return Et(t,i)}case"beginsWith":case"doesNotBeginWith":{let i={startsWith:[s,a(o)]};return Et(t,i)}case"endsWith":case"doesNotEndWith":{let i={endsWith:[s,a(o)]};return Et(t,i)}}return!1};var Pt=(e,t,o)=>{let{fieldData:n,format:r,getNextNamedParam:l,parseNumbers:s,paramPrefix:a,paramsKeepPrefix:i,numberedParams:u,quoteFieldNamesWith:c=["",""],valueProcessor:p=Je}=t??{},{processedParams:y=[]}=o??{},f=r==="parameterized",h=[],b={},N=d=>f?{sql:d,params:h}:{sql:d,params:b},k=p(e,{parseNumbers:s,quoteFieldNamesWith:c,fieldData:n,format:r}),V=Wt(e.operator),F=V.toLowerCase();if((F==="in"||F==="not in"||F==="between"||F==="not between")&&!k)return N("");if(F==="is null"||F==="is not null")return N(`${c[0]}${e.field}${c[1]} ${V}`);if(e.valueSource==="field")return N(`${c[0]}${e.field}${c[1]} ${V} ${k}`.trim());if(F==="in"||F==="not in"){let d=M(e.value);if(f)return d.forEach(x=>h.push(I(x,s)?H(x,{parseNumbers:s}):x)),N(`${c[0]}${e.field}${c[1]} ${V} (${d.map((x,O)=>u?`${a}${y.length+1+d.length-(d.length-O)}`:"?").join(", ")})`);let G=[];return d.forEach(x=>{let O=l(e.field);G.push(`${a}${O}`),b[`${i?a:""}${O}`]=I(x,s)?H(x,{parseNumbers:s}):x}),N(`${c[0]}${e.field}${c[1]} ${V} (${G.join(", ")})`)}else if(F==="between"||F==="not between"){let d=M(e.value),[G,x]=d.slice(0,2).map(T=>I(T,s)?H(T,{parseNumbers:s}):T);if(f)return h.push(G),h.push(x),N(`${c[0]}${e.field}${c[1]} ${V} ${u?`${a}${y.length+1}`:"?"} and ${u?`${a}${y.length+2}`:"?"}`);let O=l(e.field),R=l(e.field);return b[`${i?a:""}${O}`]=G,b[`${i?a:""}${R}`]=x,N(`${c[0]}${e.field}${c[1]} ${V} ${a}${O} and ${a}${R}`)}let g=e.value;typeof e.value=="string"&&(I(e.value,s)?g=H(e.value,{parseNumbers:s}):g=/^'.*'$/g.test(k)?k.replace(/(^'|'$)/g,""):k);let m="";return f?h.push(g):(m=l(e.field),b[`${i?a:""}${m}`]=g),N(`${c[0]}${e.field}${c[1]} ${V} ${f?u?`${a}${y.length+1}`:"?":`${a}${m}`}`.trim())};var Oo=(e,t)=>{let{parseNumbers:o,escapeQuotes:n,quoteFieldNamesWith:r=["",""],quoteValuesWith:l="'",valueProcessor:s=Je}=t??{},a=s(e,{parseNumbers:o,escapeQuotes:n,quoteFieldNamesWith:r,quoteValuesWith:l}),i=Wt(e.operator),u=i.toLowerCase();if((u==="in"||u==="not in"||u==="between"||u==="not between")&&!a)return"";let[c,p]=Ye(r);return`${c}${e.field}${p} ${i} ${a}`.trim()};var an=e=>le(e)&&typeof e.valid=="boolean",pe=(e,t,o)=>{if(typeof t=="boolean")return t;if(an(t))return t.valid;if(typeof o=="function"&&!D(e)){let n=o(e);if(typeof n=="boolean")return n;if(an(n))return n.valid}return!0};function Sa(e,t={}){let o="json",n=Je,r=null,l=["",""],s=()=>!0,a=[],i={},u="",c=":",p=!1,y=!1,f=!1,h=Bt,b=It,N="'";if(typeof t=="string")o=t.toLowerCase(),o==="mongodb"?r=bt:o==="parameterized"?r=Pt:o==="parameterized_named"?r=Pt:o==="cel"?r=ht:o==="spel"?r=Rt:o==="jsonlogic"?r=Kt:o==="elasticsearch"?r=Ht:o==="jsonata"&&(r=zt);else{o=(t.format??"json").toLowerCase();let{valueProcessor:g=null,ruleProcessor:m=null}=t;typeof m=="function"&&(r=m),n=typeof g=="function"?(d,G)=>ln(g)?g(d.field,d.operator,d.value,d.valueSource):g(d,G):o==="mongodb"?r??bt:o==="cel"?r??ht:o==="spel"?r??Rt:o==="jsonlogic"?r??Kt:o==="elasticsearch"?r??Ht:o==="jsonata"?r??zt:Je,l=Ye(t.quoteFieldNamesWith),s=t.validator??(()=>!0),a=Ve(t.fields??[]),u=t.fallbackExpression??"",c=t.paramPrefix??":",p=!!t.paramsKeepPrefix,y=!!t.numberedParams,f=!!t.parseNumbers,h=t.placeholderFieldName??Bt,b=t.placeholderOperatorName??It,N=t.quoteValuesWith??"'"}if(u||(u=o==="mongodb"?'"$and":[{"$expr":true}]':o==="cel"||o==="spel"?"1 == 1":"(1 = 1)"),o==="json"||o==="json_without_ids"){let g=f?xo(e):e;return o==="json"?JSON.stringify(g,null,2):JSON.stringify(g,(m,d)=>m==="id"||m==="path"?void 0:d)}if(typeof s=="function"){let g=s(e);if(typeof g=="boolean"){if(g===!1)return o==="parameterized"?{sql:u,params:[]}:o==="parameterized_named"?{sql:u,params:{}}:o==="mongodb"?`{${u}}`:o==="jsonlogic"?!1:o==="elasticsearch"?{}:u}else i=g}let k={},V=nn(a);V.forEach(g=>{typeof g.validator=="function"&&(k[g.value??g.name]=g.validator)});let F=g=>{let m,d;if(g.id&&(m=i[g.id]),V.length){let G=V.filter(x=>x.name===g.field);if(G.length){let x=G[0];typeof x.validator=="function"&&(d=x.validator)}}return[m,d]};if(o==="sql"){let g=(m,d)=>{if(!pe(m,i[m.id??""]))return d?u:"";let G=m.rules.map(x=>{if(typeof x=="string")return x;if(D(x))return g(x,m.rules.length===1);let[O,R]=F(x);if(!pe(x,O,R)||x.field===h||x.operator===b)return"";let T=(x.valueSource??"value")==="value",v=ve(a,x.field);return typeof r=="function"?r(x,{parseNumbers:f,escapeQuotes:T,quoteFieldNamesWith:l,fieldData:v,format:o,quoteValuesWith:N}):Oo(x,{parseNumbers:f,escapeQuotes:T,valueProcessor:n,quoteFieldNamesWith:l,fieldData:v,format:o,quoteValuesWith:N})});return G.length===0?u:`${m.not?"NOT ":""}(${G.filter(Boolean).join(J(m)?` ${m.combinator} `:" ")})`};return g(e,!0)}if(o==="parameterized"||o==="parameterized_named"){let g=o==="parameterized",m=[],d={},G=new Map,x=T=>{G.has(T)||G.set(T,new Set);let v=`${T}_${G.get(T).size+1}`;return G.get(T).add(v),v},O=T=>{let[v,B]=F(T);if(!pe(T,v,B)||T.field===h||T.operator===b)return"";let z=ve(a,T.field),oe=Object.fromEntries(Array.from(G.entries()).map(([C,ue])=>[C,Array.from(ue)])),j=(typeof r=="function"?r:Pt)(T,{getNextNamedParam:x,fieldParamNames:oe,parseNumbers:f,quoteFieldNamesWith:l,fieldData:z,format:o,paramPrefix:c,paramsKeepPrefix:p,numberedParams:y,fallbackExpression:u,valueProcessor:n,fields:a,placeholderFieldName:h,placeholderOperatorName:b,validator:s},{processedParams:m});if(!le(j))return"";let{sql:ae,params:E}=j;return typeof ae!="string"||!ae?"":(o==="parameterized"&&Array.isArray(E)?m.push(...E):o==="parameterized_named"&&le(E)&&(Object.assign(d,E),Object.keys(E).forEach(C=>G.get(T.field)?.add(C))),ae)},R=(T,v)=>{if(!pe(T,i[T.id??""]))return v?u:"";let B=T.rules.map(z=>typeof z=="string"?z:D(z)?R(z,T.rules.length===1):O(z));return B.length===0?u:`${T.not?"NOT ":""}(${B.filter(Boolean).join(J(T)?` ${T.combinator} `:" ")})`};return g?{sql:R(e,!0),params:m}:{sql:R(e,!0),params:d}}if(o==="mongodb"){let g=(G,x)=>{if(!pe(G,i[G.id??""]))return x?u:"";let O=`"$${G.combinator.toLowerCase()}"`,R=!1,T=G.rules.map(v=>{if(D(v)){let j=g(v);return j?(R=!0,/^\{.+\}$/.test(j)?j:`{${j}}`):""}let[B,z]=F(v);if(!pe(v,B,z)||v.field===h||v.operator===b)return"";let oe=ve(a,v.field);return(r??n)(v,{parseNumbers:f,fieldData:oe,format:o})}).filter(Boolean);return T.length>0?T.length===1&&!R?T[0]:`${O}:[${T.join(",")}]`:u},m=J(e)?e:yt(e),d=g(m,!0);return/^\{.+\}$/.test(d)?d:`{${d}}`}if(o==="cel"){let g=(m,d)=>{if(!pe(m,i[m.id??""]))return d?u:"";let G=m.rules.map(R=>{if(typeof R=="string")return go[R];if(D(R))return g(R);let[T,v]=F(R);if(!pe(R,T,v)||R.field===h||R.operator===b)return"";let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:B,format:o})}).filter(Boolean).join(J(m)?` ${go[m.combinator]} `:" "),[x,O]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${O}`:u};return g(e,!0)}if(o==="spel"){let g=(m,d)=>{if(!pe(m,i[m.id??""]))return d?u:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[T,v]=F(R);if(!pe(R,T,v)||R.field===h||R.operator===b)return"";let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:B,format:o})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,O]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${O}`:u};return g(e,!0)}if(o==="jsonata"){let g=(m,d)=>{if(!pe(m,i[m.id??""]))return d?u:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[T,v]=F(R);if(!pe(R,T,v)||R.field===h||R.operator===b)return"";let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:B,format:o,quoteFieldNamesWith:l})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,O]=m.not||!d?[`${m.not?"$not":""}(`,")"]:["",""];return G?`${x}${G}${O}`:u};return g(e,!0)}if(o==="jsonlogic"){let g=J(e)?e:yt(e),m=(d,G)=>{if(!pe(d,i[d.id??""]))return!1;let x=d.rules.map(R=>{if(D(R))return m(R);let[T,v]=F(R);if(!pe(R,T,v)||R.field===h||R.operator===b)return!1;let B=ve(a,R.field);return(r??n)(R,{parseNumbers:f,fieldData:B,format:o})}).filter(Boolean);if(x.length===0)return!1;let O={[d.combinator]:x};return d.not?{"!":O}:O};return m(g,!0)}if(o==="elasticsearch"){let g=J(e)?e:yt(e),m=G=>{if(!pe(G,i[G.id??""]))return!1;let x=G.rules.map(O=>{if(D(O))return m(O);let[R,T]=F(O);if(!pe(O,R,T)||O.field===h||O.operator===b)return!1;let v=ve(a,O.field);return(r??n)(O,{parseNumbers:f,fieldData:v,format:o})}).filter(Boolean);return x.length===0?!1:{bool:G.not?{must_not:G.combinator==="or"?{bool:{should:x}}:x}:{[G.combinator==="or"?"should":"must"]:x}}},d=m(g);return d===!1?{}:d}return""}var gr={default:Je,mongodb:bt,cel:ht,spel:Rt},Xt=e=>(t,o,n,r)=>gr[e]({field:t,operator:o,value:n,valueSource:r},{parseNumbers:!1}),wa=Xt("default"),Ba=Xt("mongodb"),Ia=Xt("cel"),ka=Xt("spel");var Qa=ht,Va=bt,La=Rt;var fe=(e,t)=>{let o=t,n=0;for(;n<e.length&&o&&D(o);){let r=o.rules[e[n]];typeof r!="string"?o=r:o=null,n++}return o},se=e=>e.slice(0,e.length-1),Le=(e,t)=>e.length===t.length&&e.every((o,n)=>o===t[n]),Xa=(e,t)=>e.length<t.length&&RegExp(`^${e.join("-")}`).test(t.join("-")),un=(e,t)=>{let o=[],n=se(e),r=se(t),l=0;for(;l<n.length&&l<r.length&&n[l]===r[l];)o.push(r[l]),l++;return o},gt=(e,t)=>{let o=!!t.disabled,n=t,r=0;for(;r<e.length&&!o&&D(n);){let l=n.rules[e[r]];le(l)&&(D(l)||"field"in l&&l.field)&&(o=!!l.disabled,n=l),r++}return o};var cn=e=>Le([],e.path)?"Query builder":`Rule group at path ${e.path.join("-")}`;var Ft=globalThis.crypto,ye=()=>"00-0-4-2-000".replace(/[^-]/g,e=>((Math.random()+~~e)*65536>>parseInt(e)).toString(16).padStart(4,"0"));if(Ft){if(typeof Ft.randomUUID=="function")ye=()=>Ft.randomUUID();else if(typeof Ft.getRandomValues=="function"){let e="89ab",t=new Uint32Array(32);ye=()=>{Ft.getRandomValues(t);let o=(t[0]%16).toString(16);for(let n=1;n<32;n++)n===12?o=`${o}4`:n===16?o=`${o}${e[t[17]%4]}`:o=`${o}${(t[n]%16).toString(16)}`,(n===7||n===11||n===15||n===19)&&(o=`${o}-`);return o}}}import*as dn from"react";import{useContext as Ar,useMemo as vo}from"react";import pn from"clsx";var Yt=(...e)=>{let t=o=>pn(e.filter(Boolean).map(n=>pn(n[o])));return{queryBuilder:t("queryBuilder"),ruleGroup:t("ruleGroup"),header:t("header"),body:t("body"),combinators:t("combinators"),addRule:t("addRule"),addGroup:t("addGroup"),cloneRule:t("cloneRule"),cloneGroup:t("cloneGroup"),removeGroup:t("removeGroup"),rule:t("rule"),fields:t("fields"),operators:t("operators"),value:t("value"),removeRule:t("removeRule"),notToggle:t("notToggle"),shiftActions:t("shiftActions"),dragHandle:t("dragHandle"),lockRule:t("lockRule"),lockGroup:t("lockGroup"),valueSource:t("valueSource"),actionElement:t("actionElement"),valueSelector:t("valueSelector")}};import{produce as xr}from"immer";var Zt=Object.keys,ri=Object.entries;var Gr={},eo=(...e)=>{let[t,...o]=e;return xr(t??Gr,n=>{for(let r of o)r&&Zt(r).forEach(l=>{n[l]={...n[l],...r[l]}})})};var mi=e=>{let{key:t,controlClassnames:o,controlElements:n,translations:r}=e;return l=>{let s=Ar(nt),a=vo(()=>o?{controlClassnames:Yt(s.controlClassnames,l.controlClassnames,o)}:{},[l.controlClassnames,s.controlClassnames]),i=vo(()=>eo(s.translations,r,l.translations),[l.translations,s.translations]),u=vo(()=>({...s,...a,controlElements:{...s.controlElements,...n,...l.controlElements},translations:i}),[a,i,l.controlElements,s]);return dn.createElement(nt.Provider,{value:u,key:t},l.children)}};var to=e=>{let t=typeof e=="boolean"?e:typeof e=="object"&&e!==null?e.valid:null;return typeof t=="boolean"?t?w.valid:w.invalid:""};var Or=["value"],vr={name:"name",value:"name",valueSources:null,label:"label"},mn=(e,t,o)=>{let n=e?me(e):vr;if(n.valueSources)return typeof n.valueSources=="function"?n.valueSources(t):n.valueSources;if(o){let r=o(n.value,t,{fieldData:me(n)});if(r)return r}return Or};import{produce as fn}from"immer";var yn=(e,{idGenerator:t=ye}={})=>fn(e,o=>{o.id||(o.id=t())}),oo=(e,{idGenerator:t=ye}={})=>fn(e,o=>{o.id||(o.id=t()),o.rules=o.rules.map(n=>typeof n=="string"?n:D(n)?oo(n,{idGenerator:t}):yn(n,{idGenerator:t}))}),hn=(e,{idGenerator:t=ye}={})=>D(e)?oo(e,{idGenerator:t}):yn(e,{idGenerator:t});import{produce as lo}from"immer";var no=(e,{idGenerator:t=ye}={})=>JSON.parse(JSON.stringify({...e,id:t()})),ro=(e,{idGenerator:t=ye}={})=>{if(!le(e))return e;if(!D(e))return JSON.parse(JSON.stringify({...e,id:t()}));if(J(e)){let n=e.rules.map(r=>D(r)?ro(r,{idGenerator:t}):no(r,{idGenerator:t}));return{...e,id:t(),rules:n}}let o=e.rules.map(n=>typeof n=="string"?n:D(n)?ro(n,{idGenerator:t}):no(n,{idGenerator:t}));return{...e,id:t(),rules:o}};var Co=(e,t,o,{combinators:n=Ue,combinatorPreceding:r,idGenerator:l=ye}={})=>lo(e,s=>{let a=fe(o,s);if(!(!a||!D(a))){if(!J(a)&&a.rules.length>0){let i=a.rules[a.rules.length-2];a.rules.push(r??(typeof i=="string"?i:de(n)))}a.rules.push(hn(t,{idGenerator:l}))}}),bn=(e,t,o,n,{resetOnFieldChange:r=!0,resetOnOperatorChange:l=!1,getRuleDefaultOperator:s=()=>"=",getValueSources:a=()=>["value"],getRuleDefaultValue:i=()=>""}={})=>lo(e,u=>{if(t==="combinator"&&!J(u)){let b=fe(se(n),u).rules;n[n.length-1]%2===1&&(b[n[n.length-1]]=o);return}let c=fe(n,u);if(!c)return;let p=D(c);if(c[t]===o||(t!=="valueSource"&&(c[t]=o),p))return;let y=!1,f=!1;r&&t==="field"&&(c.operator=s(o),y=!0,f=!0),l&&t==="operator"&&(y=!0,f=!0);let h=a(c.field,c.operator)[0];(y&&c.valueSource&&h!==c.valueSource||t==="valueSource"&&o!==c.valueSource)&&(f=!!c.valueSource||!c.valueSource&&o!==h,c.valueSource=y?h:o),f&&(c.value=i(c))}),Rn=(e,t)=>t.length===0||!J(e)&&!fe(t,e)?e:lo(e,o=>{let n=t[t.length-1],r=fe(se(t),o);if(r&&D(r))if(!J(r)&&r.rules.length>1){let l=n===0?0:n-1;r.rules.splice(l,2)}else r.rules.splice(n,1)}),Cr=(e,t,o)=>{if(Array.isArray(o))return o;let n=Xe(e);if(o==="up"){if(Le(t,[0]))return t;if(t.at(-1)===0){let r=se(t);return[...se(r),Math.max(0,r.at(-1)-(n?1:0))]}else{let r=[...se(t),Math.max(0,t.at(-1)-(n?2:1))],l=fe(r,e);return D(l)?[...r,l.rules.length]:[...se(t),Math.max(0,t.at(-1)-(n?3:1))]}}else if(o==="down"){if(Le([e.rules.length-1],t))return t;if(t.at(-1)===fe(se(t),e).rules.length-1){let r=se(t);return[...se(r),r.at(-1)+1]}else{let r=[...se(t),t.at(-1)+(n?2:1)],l=fe(r,e);return D(l)?[...r,0]:[...se(t),t.at(-1)+(n?3:2)]}}return t},gn=(e,t,o,{clone:n=!1,combinators:r=Ue,idGenerator:l=ye}={})=>{let s=Cr(e,t,o);if(t.length===0||Le(t,s)||!fe(se(s),e))return e;let a=fe(t,e);if(!a)return e;let i=n?D(a)?ro(a,{idGenerator:l}):no(a,{idGenerator:l}):a;return lo(e,u=>{let c=Xe(u),p=fe(se(t),u),y=t[t.length-1],f=c&&y>0?p.rules[y-1]:null,h=c&&y<p.rules.length-1?p.rules[y+1]:null;if(!n){let m=c?Math.max(0,y-1):y,d=c?2:1;p.rules.splice(m,d)}let b=[...s],N=un(t,s);!n&&t.length===N.length+1&&s[N.length]>t[N.length]&&(b[N.length]-=c?2:1);let k=se(b),V=fe(k,u),F=b[b.length-1],g=(...m)=>V.rules.splice(F,0,...m);if(V.rules.length===0||!c)g(i);else if(F===0)if(y===0&&h)g(i,h);else{let m=V.rules[1]||f||de(r);g(i,m)}else if(f)g(f,i);else{let m=V.rules[F-2]||h||de(r);g(m,i)}})};import*as so from"react";var xn=e=>qt(e)?e.map(t=>so.createElement("optgroup",{key:t.label,label:t.label},t.options.map(o=>so.createElement("option",{key:o.name,value:o.name,disabled:o.disabled},o.label)))):Array.isArray(e)?e.map(t=>so.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label)):null;import{produce as $r}from"immer";var Gn=(e,t,o)=>$r(e,n=>{for(let[r,l]of Object.entries(t))l===!1?delete n[r]:l&&r!==l&&r in n&&(n[l]=n[r],o&&delete n[r])});function Li(e,t={}){let{ruleProcessor:o=c=>c,ruleGroupProcessor:n=c=>c,propertyMap:r={},combinatorMap:l={},operatorMap:s={},omitPath:a=!1,deleteRemappedProperties:i=!0}=t,u=c=>({...n(Gn({...c,...J(c)?{combinator:l[c.combinator]??c.combinator}:{}},r,i)),...r.rules===!1?null:{[r.rules??"rules"]:c.rules.map((p,y)=>{let f=a?null:{path:[...c.path,y]};return typeof p=="string"?l[p]??p:D(p)?u({...p,...f}):o(Gn({...p,...f,..."operator"in p?{operator:s[p.operator]??p.operator}:{}},r,i))})}});return u({...e,...a?null:{path:[]}})}import{useMemo as An}from"react";var Tr=(e,t)=>e===!1?!1:e?!0:t!==!1,Sr=(e,t)=>e?!0:e===!1?!1:!!t,Nr=(e,t,o)=>e?Tr(t,o):Sr(t,o),ao=(e,t,o)=>An(()=>Nr(e,t,o),[o,e,t]),hu=(e,t,o)=>An(()=>typeof t<"u"&&t!=null?t:typeof o<"u"&&o!=null?o:e,[o,e,t]);var A=()=>null,On=Er(A),vn=e=>{let t=Pr(nt),o=ao(!0,e.enableMountQueryChange,t.enableMountQueryChange),n=ao(!1,e.enableDragAndDrop,t.enableDragAndDrop)&&t.enableDragAndDrop!==!1,r=ao(!1,e.debugMode,t.debugMode),l=$o(()=>Yt(Lo,t.controlClassnames,e.controlClassnames),[t.controlClassnames,e.controlClassnames]),s=$o(()=>{let b={...t.controlElements,...t.controlElements?.dragHandle===null?{dragHandle:On}:{},...t.controlElements?.inlineCombinator===null?{inlineCombinator:A}:{},...t.controlElements?.notToggle===null?{notToggle:A}:{},...t.controlElements?.shiftActions===null?{shiftActions:A}:{},...t.controlElements?.valueEditor===null?{valueEditor:A}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...t.controlElements?.addGroupAction===null?{addGroupAction:A}:{},...t.controlElements?.addRuleAction===null?{addRuleAction:A}:{},...t.controlElements?.cloneGroupAction===null?{cloneGroupAction:A}:{},...t.controlElements?.cloneRuleAction===null?{cloneRuleAction:A}:{},...t.controlElements?.lockGroupAction===null?{lockGroupAction:A}:{},...t.controlElements?.lockRuleAction===null?{lockRuleAction:A}:{},...t.controlElements?.removeGroupAction===null?{removeGroupAction:A}:{},...t.controlElements?.removeRuleAction===null?{removeRuleAction:A}:{},...t.controlElements?.combinatorSelector===null?{combinatorSelector:A}:{},...t.controlElements?.fieldSelector===null?{fieldSelector:A}:{},...t.controlElements?.operatorSelector===null?{operatorSelector:A}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...t.controlElements?.actionElement?{addGroupAction:t.controlElements?.addGroupAction===null?A:t.controlElements?.addGroupAction??t.controlElements.actionElement,addRuleAction:t.controlElements?.addRuleAction===null?A:t.controlElements?.addRuleAction??t.controlElements.actionElement,cloneGroupAction:t.controlElements?.cloneGroupAction===null?A:t.controlElements?.cloneGroupAction??t.controlElements.actionElement,cloneRuleAction:t.controlElements?.cloneRuleAction===null?A:t.controlElements?.cloneRuleAction??t.controlElements.actionElement,lockGroupAction:t.controlElements?.lockGroupAction===null?A:t.controlElements?.lockGroupAction??t.controlElements.actionElement,lockRuleAction:t.controlElements?.lockRuleAction===null?A:t.controlElements?.lockRuleAction??t.controlElements.actionElement,removeGroupAction:t.controlElements?.removeGroupAction===null?A:t.controlElements?.removeGroupAction??t.controlElements.actionElement,removeRuleAction:t.controlElements?.removeRuleAction===null?A:t.controlElements?.removeRuleAction??t.controlElements.actionElement}:{},...t.controlElements?.valueSelector?{combinatorSelector:t.controlElements?.combinatorSelector===null?A:t.controlElements?.combinatorSelector??t.controlElements.valueSelector,fieldSelector:t.controlElements?.fieldSelector===null?A:t.controlElements?.fieldSelector??t.controlElements.valueSelector,operatorSelector:t.controlElements?.operatorSelector===null?A:t.controlElements?.operatorSelector??t.controlElements.valueSelector,valueSourceSelector:t.controlElements?.valueSourceSelector===null?A:t.controlElements?.valueSourceSelector??t.controlElements.valueSelector}:{}},N={...e.controlElements,...e.controlElements?.dragHandle===null?{dragHandle:On}:{},...e.controlElements?.inlineCombinator===null?{inlineCombinator:A}:{},...e.controlElements?.notToggle===null?{notToggle:A}:{},...e.controlElements?.shiftActions===null?{shiftActions:A}:{},...e.controlElements?.valueEditor===null?{valueEditor:A}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...e.controlElements?.addGroupAction===null?{addGroupAction:A}:{},...e.controlElements?.addRuleAction===null?{addRuleAction:A}:{},...e.controlElements?.cloneGroupAction===null?{cloneGroupAction:A}:{},...e.controlElements?.cloneRuleAction===null?{cloneRuleAction:A}:{},...e.controlElements?.lockGroupAction===null?{lockGroupAction:A}:{},...e.controlElements?.lockRuleAction===null?{lockRuleAction:A}:{},...e.controlElements?.removeGroupAction===null?{removeGroupAction:A}:{},...e.controlElements?.removeRuleAction===null?{removeRuleAction:A}:{},...e.controlElements?.combinatorSelector===null?{combinatorSelector:A}:{},...e.controlElements?.fieldSelector===null?{fieldSelector:A}:{},...e.controlElements?.operatorSelector===null?{operatorSelector:A}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:A}:{},...e.controlElements?.actionElement?{addGroupAction:e.controlElements?.addGroupAction===null?A:e.controlElements?.addGroupAction??e.controlElements.actionElement,addRuleAction:e.controlElements?.addRuleAction===null?A:e.controlElements?.addRuleAction??e.controlElements.actionElement,cloneGroupAction:e.controlElements?.cloneGroupAction===null?A:e.controlElements?.cloneGroupAction??e.controlElements.actionElement,cloneRuleAction:e.controlElements?.cloneRuleAction===null?A:e.controlElements?.cloneRuleAction??e.controlElements.actionElement,lockGroupAction:e.controlElements?.lockGroupAction===null?A:e.controlElements?.lockGroupAction??e.controlElements.actionElement,lockRuleAction:e.controlElements?.lockRuleAction===null?A:e.controlElements?.lockRuleAction??e.controlElements.actionElement,removeGroupAction:e.controlElements?.removeGroupAction===null?A:e.controlElements?.removeGroupAction??e.controlElements.actionElement,removeRuleAction:e.controlElements?.removeRuleAction===null?A:e.controlElements?.removeRuleAction??e.controlElements.actionElement}:{},...e.controlElements?.valueSelector?{combinatorSelector:e.controlElements?.combinatorSelector===null?A:e.controlElements?.combinatorSelector??e.controlElements.valueSelector,fieldSelector:e.controlElements?.fieldSelector===null?A:e.controlElements?.fieldSelector??e.controlElements.valueSelector,operatorSelector:e.controlElements?.operatorSelector===null?A:e.controlElements?.operatorSelector??e.controlElements.valueSelector,valueSourceSelector:e.controlElements?.valueSourceSelector===null?A:e.controlElements?.valueSourceSelector??e.controlElements.valueSelector}:{}};return{...Cn,...b,...N}},[e.controlElements,t.controlElements]),a=$o(()=>eo(Qo,t.translations,e.translations),[e.translations,t.translations]),{controlClassnames:i,controlElements:u,debugMode:c,enableDragAndDrop:p,enableMountQueryChange:y,translations:f,...h}=t;return{controlClassnames:l,controlElements:s,debugMode:r,enableDragAndDrop:n,enableMountQueryChange:o,translations:a,...h}};import{clsx as $n}from"clsx";import{useCallback as rt,useEffect as Tn,useMemo as Ne,useRef as Fr}from"react";var Dr={},wr={},Br=()=>null,Ir=()=>"",kr=()=>"",Qr=e=>e,Vr=e=>e,Lr=()=>!0,qr=(...e)=>{console.log(...e)};function Sn(e,t){let{query:o,defaultQuery:n,getValueEditorSeparator:r=Br,getRuleClassname:l=Ir,getRuleGroupClassname:s=kr,onAddRule:a=Qr,onAddGroup:i=Vr,onRemove:u=Lr,onQueryChange:c,showCombinatorsBetweenRules:p=!1,showNotToggle:y=!1,showShiftActions:f=!1,showCloneButtons:h=!1,showLockButtons:b=!1,resetOnFieldChange:N=!0,resetOnOperatorChange:k=!1,autoSelectField:V=!0,autoSelectOperator:F=!0,addRuleToNewGroups:g=!1,listsAsArrays:m=!1,parseNumbers:d=!1,disabled:G=!1,validator:x,onLog:O=qr,idGenerator:R,accessibleDescriptionGenerator:T=cn}=e,{qbId:v,rqbContext:B,fields:z,fieldMap:oe,combinators:j,getOperatorsMain:ae,getRuleDefaultOperator:E,getValueEditorTypeMain:C,getValueSourcesMain:ue,getValuesMain:we,getRuleDefaultValue:Pe,getInputTypeMain:Be,createRule:Ie,createRuleGroup:Ce}=t,{controlClassnames:ke,controlElements:L,debugMode:X,enableDragAndDrop:$,enableMountQueryChange:S,translations:P}=B,ne=!!p,re=!!y,je=!!f,xe=!!h,st=!!b,at=!!N,Ke=!!k,Z=!!V,ee=!!F,be=!!g,it=!!m;Jo({defaultQuery:n,queryProp:o});let K=_o(),Ge=dt(),ut=Ne(()=>Ze(t.qbId),[t.qbId]),co=Uo(ut),To=rt(()=>ut(K.getState()),[K,ut]),qn=Ne(()=>Ce(),[Ce]),po=o??co??n??qn,Ae=po.id?po:oo(po,{idGenerator:R});Tn(()=>{o&&o!==co&&Ge(Vt({payload:{qbId:v,query:o},onQueryChange:void 0}))},[o,v,co,Ge]);let Ot=Ne(()=>Xe(Ae),[Ae]),mo=!!e.independentCombinators&&!Ot;mt("independentCombinators",mo||!mo&&(e.independentCombinators??"not present")!=="not present",mo?"invalid":"unnecessary");let So=Fr(!1);Tn(()=>{So.current||(So.current=!0,Ge(Vt({payload:{qbId:v,query:Ae},onQueryChange:S&&typeof c=="function"?c:void 0})))},[S,c,v,Ge,Ae]);let $e=rt(q=>{Ge(Vt({payload:{qbId:v,query:q},onQueryChange:c}))},[c,v,Ge]),Dt=Ne(()=>Array.isArray(G)&&G||[],[G]),Oe=G===!0,Mn=Ne(()=>Ae.disabled||Dt.some(q=>q.length===0),[Dt,Ae.disabled]),No=rt((q,Y,ie)=>{let U=Ze(v)(K.getState());if(!U)return;if(gt(Y,U)||Oe){X&&O({type:Re.parentPathDisabled,rule:q,parentPath:Y,query:U});return}let ce=a(q,Y,U,ie);if(!ce){X&&O({type:Re.onAddRuleFalse,rule:q,parentPath:Y,query:U});return}let Ct=Co(U,ce,Y,{combinators:j,combinatorPreceding:ce.combinatorPreceding??void 0});X&&O({type:Re.add,query:U,newQuery:Ct,newRule:ce,parentPath:Y}),$e(Ct)},[j,X,$e,a,O,v,Oe,K]),Eo=rt((q,Y,ie)=>{let U=Ze(v)(K.getState());if(!U)return;if(gt(Y,U)||Oe){X&&O({type:Re.parentPathDisabled,ruleGroup:q,parentPath:Y,query:U});return}let ce=i(q,Y,U,ie);if(!ce){X&&O({type:Re.onAddGroupFalse,ruleGroup:q,parentPath:Y,query:U});return}let Ct=Co(U,ce,Y,{combinators:j,combinatorPreceding:ce.combinatorPreceding??void 0});X&&O({type:Re.add,query:U,newQuery:Ct,newGroup:ce,parentPath:Y}),$e(Ct)},[j,X,$e,i,O,v,Oe,K]),Po=rt((q,Y,ie)=>{let U=Ze(v)(K.getState());if(!U)return;if(gt(ie,U)&&q!=="disabled"||Oe){X&&O({type:Re.pathDisabled,path:ie,prop:q,value:Y,query:U});return}let ce=bn(U,q,Y,ie,{resetOnFieldChange:at,resetOnOperatorChange:Ke,getRuleDefaultOperator:E,getValueSources:ue,getRuleDefaultValue:Pe});X&&O({type:Re.update,query:U,newQuery:ce,prop:q,value:Y,path:ie}),$e(ce)},[X,$e,E,Pe,ue,O,v,Oe,K,at,Ke]),fo=rt((q,Y)=>{let ie=Ze(v)(K.getState());if(!ie)return;if(gt(q,ie)||Oe){X&&O({type:Re.pathDisabled,path:q,query:ie});return}let U=fe(q,ie);if(U)if(u(U,q,ie,Y)){let ce=Rn(ie,q);X&&O({type:Re.remove,query:ie,newQuery:ce,path:q,ruleOrGroup:U}),$e(ce)}else X&&O({type:Re.onRemoveFalse,ruleOrGroup:U,path:q,query:ie})},[X,$e,O,u,v,Oe,K]),Fo=rt((q,Y,ie)=>{let U=Ze(v)(K.getState());if(!U)return;if(gt(q,U)||Oe){X&&O({type:Re.pathDisabled,oldPath:q,newPath:Y,query:U});return}let ce=gn(U,q,Y,{clone:ie,combinators:j});X&&O({type:Re.move,query:U,newQuery:ce,oldPath:q,newPath:Y,clone:ie}),$e(ce)},[j,X,$e,O,v,Oe,K]),Wn=Ne(()=>$?"enabled":"disabled",[$]),jn=Ne(()=>Ot||ne?"enabled":"disabled",[Ot,ne]),Un=Ne(()=>J(Ae)?{combinator:Ae.combinator}:{},[Ae]),{validationResult:vt,validationMap:Do}=Ne(()=>{let q=typeof x=="function"&&Ae?x(Ae):Dr;return{validationResult:q,validationMap:typeof q=="boolean"?wr:q}},[Ae,x]),_n=Ne(()=>({addRuleToNewGroups:be,accessibleDescriptionGenerator:T,autoSelectField:Z,autoSelectOperator:ee,classNames:ke,combinators:j,controls:L,createRule:Ie,createRuleGroup:Ce,disabledPaths:Dt,enableDragAndDrop:$,fieldMap:oe,fields:z,dispatchQuery:$e,getQuery:To,getInputType:Be,getOperators:ae,getRuleClassname:l,getRuleGroupClassname:s,getValueEditorSeparator:r,getValueEditorType:C,getValues:we,getValueSources:ue,independentCombinators:Ot,listsAsArrays:it,parseNumbers:d,qbId:v,showCloneButtons:xe,showCombinatorsBetweenRules:ne,showLockButtons:st,showNotToggle:re,showShiftActions:je,validationMap:Do}),[be,T,Z,ee,j,ke,L,Ie,Ce,Dt,$,oe,z,$e,To,Be,ae,l,s,C,we,ue,r,Ot,it,d,v,xe,ne,st,re,je,Do]),Hn=Ne(()=>({moveRule:Fo,onGroupAdd:Eo,onGroupRemove:fo,onPropChange:Po,onRuleAdd:No,onRuleRemove:fo}),[Fo,Eo,Po,No,fo]),Jn=Ne(()=>$n(w.queryBuilder,$n(ke.queryBuilder),{[w.disabled]:Oe,[w.valid]:typeof vt=="boolean"&&vt,[w.invalid]:typeof vt=="boolean"&&!vt}),[ke.queryBuilder,Oe,vt]);return{...e,actions:Hn,rootGroup:Ae,rootGroupDisabled:Mn,queryDisabled:Oe,rqbContext:B,schema:_n,translations:P,wrapperClassName:Jn,dndEnabledAttr:Wn,inlineCombinatorsAttr:jn,combinatorPropObject:Un}}import{useCallback as ze,useMemo as xt,useState as Mr}from"react";var Nn=(e,t,o)=>{let n=de(e);if(t.operator==="between"||t.operator==="notBetween"){let r=[n,n];return o?r:ft(r.map(l=>l??""),",")}return n},En=e=>{let[t]=Mr(ye),{fields:o,baseField:n,operators:r,baseOperator:l,combinators:s=Ue,baseCombinator:a,translations:i,enableMountQueryChange:u=!0,controlClassnames:c,controlElements:p,getDefaultField:y,getDefaultOperator:f,getDefaultValue:h,getOperators:b,getValueEditorType:N,getValueSources:k,getInputType:V,getValues:F,autoSelectField:g=!0,autoSelectOperator:m=!0,addRuleToNewGroups:d=!1,enableDragAndDrop:G,listsAsArrays:x=!1,debugMode:O=!1,idGenerator:R=ye}=e,T=r??Vo,v=vn({controlClassnames:c,controlElements:p,debugMode:O,enableDragAndDrop:G,enableMountQueryChange:u,translations:i}),{translations:B}=v,z=xt(()=>({id:B.fields.placeholderName,name:B.fields.placeholderName,value:B.fields.placeholderName,label:B.fields.placeholderLabel}),[B.fields.placeholderLabel,B.fields.placeholderName]),oe=xt(()=>o??[z],[z,o]),j=xt(()=>{let $=Array.isArray(oe)?Ve(oe,n):Zt(bo(oe,n)).map(S=>({...oe[S],name:S,value:S})).sort((S,P)=>S.label.localeCompare(P.label));return Te($)?g?Lt($):Lt([{label:B.fields.placeholderGroupLabel,options:[z]},...$]):g?et($):et([z,...$])},[g,n,z,oe,B.fields.placeholderGroupLabel]),ae=xt(()=>{if(!Array.isArray(oe)){let S=bo(oe,n);return g?S:{...S,[B.fields.placeholderName]:z}}let $={};return Te(j)?j.forEach(S=>S.options.forEach(P=>{$[P.value??P.name]=me(P,n)})):j.forEach(S=>{$[S.value??S.name]=me(S,n)}),$},[g,n,z,j,oe,B.fields.placeholderName]),E=xt(()=>Ve(s,a),[a,s]),C=xt(()=>({id:B.operators.placeholderName,name:B.operators.placeholderName,value:B.operators.placeholderName,label:B.operators.placeholderLabel}),[B.operators.placeholderLabel,B.operators.placeholderName]),ue=ze(($,{fieldData:S})=>{let P=Ve(T,l);if(S?.operators)P=Ve(S.operators,l);else if(b){let ne=b($,{fieldData:S});ne&&(P=Ve(ne,l))}return m||(Te(P)?P=[{label:B.operators.placeholderGroupLabel,options:[C]},...P]:P=[C,...P]),on(P)},[m,l,C,b,T,B.operators.placeholderGroupLabel]),we=ze($=>{let S=ae[$];if(S?.defaultOperator)return S.defaultOperator;if(f)return typeof f=="function"?f($,{fieldData:S}):f;let P=ue($,{fieldData:S})??[];return de(P)??""},[ae,f,ue]),Pe=ze(($,S,{fieldData:P})=>P.valueEditorType?typeof P.valueEditorType=="function"?P.valueEditorType(S):P.valueEditorType:N?.($,S,{fieldData:P})??"text",[N]),Be=ze(($,S)=>mn(ae[$],S,k),[ae,k]),Ie=ze(($,S,{fieldData:P})=>P?.values?Ve(P.values):F?Ve(F($,S,{fieldData:P})):[],[F]),Ce=ze($=>{let S=ae[$.field]??{};if(S?.defaultValue!==void 0&&S.defaultValue!==null)return S.defaultValue;if(h)return h($,{fieldData:S});let P="",ne=Ie($.field,$.operator,{fieldData:S});if($.valueSource==="field"){let re=Mt(S,j,$.operator);re.length>0?P=Nn(re,$,x):P=""}else if(ne.length){let re=Pe($.field,$.operator,{fieldData:S});re==="multiselect"?P=x?[]:"":(re==="select"||re==="radio")&&(P=Nn(ne,$,x))}else Pe($.field,$.operator,{fieldData:S})==="checkbox"&&(P=!1);return P},[ae,j,h,Pe,Ie,x]),ke=ze(($,S,{fieldData:P})=>{if(V){let ne=V($,S,{fieldData:P});if(ne)return ne}return"text"},[V]),L=ze(()=>{let $="",S=j;if(S?.length>0&&S[0]){let xe=de(S);xe&&($=xe)}if(y)if(typeof y=="function"){let xe=y(S);xe&&($=xe)}else $=y;let P=we($),ne=Be($,P)[0]??"value",re={id:R(),field:$,operator:P,valueSource:ne,value:""},je=Ce(re);return{...re,value:je}},[j,y,we,Ce,Be,R]),X=ze($=>$?{id:R(),rules:d?[L()]:[],not:!1}:{id:R(),rules:d?[L()]:[],combinator:de(E)??"",not:!1},[d,E,L,R]);return{qbId:t,rqbContext:v,fields:j,fieldMap:ae,combinators:E,getOperatorsMain:ue,getRuleDefaultOperator:we,getValueEditorTypeMain:Pe,getValueSourcesMain:Be,getValuesMain:Ie,getRuleDefaultValue:Ce,getInputTypeMain:ke,createRule:L,createRuleGroup:X}};var io=(e,t)=>{};import{clsx as qe}from"clsx";import{useCallback as Gt,useMemo as he}from"react";var Pn=e=>{let{id:t,path:o,rule:n,schema:r,actions:{moveRule:l,onPropChange:s,onRuleRemove:a},disabled:i,parentDisabled:u,shiftUpDisabled:c,shiftDownDisabled:p,field:y,operator:f,value:h,valueSource:b,dragMonitorId:N="",dropMonitorId:k="",dndRef:V=null,dragRef:F=null,isDragging:g=!1,isOver:m=!1}=e,{classNames:d,fields:G,fieldMap:x,getInputType:O,getOperators:R,getValueEditorType:T,getValueEditorSeparator:v,getValueSources:B,getValues:z,validationMap:oe,enableDragAndDrop:j,getRuleClassname:ae}=r;mt("rule",!n),io(j,!!(N||k||V||F));let E=!!u||!!i,C=he(()=>n||{id:t,field:y??"",operator:f??"",value:h,valueSource:b},[y,t,f,n,h,b]),ue=he(()=>({shiftActions:qe(w.shiftActions,d.shiftActions),dragHandle:qe(w.dragHandle,d.dragHandle),fields:qe(w.fields,d.valueSelector,d.fields),operators:qe(w.operators,d.valueSelector,d.operators),valueSource:qe(w.valueSource,d.valueSelector,d.valueSource),value:qe(w.value,d.value),cloneRule:qe(w.cloneRule,d.actionElement,d.cloneRule),lockRule:qe(w.lockRule,d.actionElement,d.lockRule),removeRule:qe(w.removeRule,d.actionElement,d.removeRule)}),[d.shiftActions,d.dragHandle,d.valueSelector,d.fields,d.operators,d.valueSource,d.value,d.actionElement,d.cloneRule,d.lockRule,d.removeRule]),we=Gt(K=>(Ge,ut)=>{E||s(K,Ge,o)},[E,s,o]),Pe=Gt((K,Ge)=>{if(!E){let ut=[...se(o),o[o.length-1]+1];l(o,ut,!0)}},[E,l,o]),Be=Gt((K,Ge)=>{s("disabled",!E,o)},[E,s,o]),Ie=Gt((K,Ge)=>{E||a(o)},[E,a,o]),Ce=Gt((K,Ge)=>{!E&&!c&&l(o,"up",K?.altKey)},[E,l,o,c]),ke=Gt((K,Ge)=>{!E&&!p&&l(o,"down",K?.altKey)},[E,l,o,p]),L=he(()=>x?.[C.field]??{name:C.field,value:C.field,label:C.field},[x,C.field]),X=he(()=>L.inputType??O(C.field,C.operator,{fieldData:L}),[L,O,C.field,C.operator]),$=he(()=>R(C.field,{fieldData:L}),[L,R,C.field]),S=he(()=>ve($,C.operator),[$,C.operator]),P=S?.arity,ne=typeof P=="string"&&P==="unary"||typeof P=="number"&&P<2,re=he(()=>typeof L.valueSources=="function"?L.valueSources(C.operator):L.valueSources??B(C.field,C.operator,{fieldData:L}),[L,B,C.field,C.operator]),je=he(()=>C.valueSource==="field"?"select":T(C.field,C.operator,{fieldData:L}),[L,T,C.field,C.operator,C.valueSource]),xe=he(()=>v(C.field,C.operator,{fieldData:L}),[L,v,C.field,C.operator]),st=he(()=>C.valueSource==="field"?Mt(L,G,C.operator):L.values??z(C.field,C.operator,{fieldData:L}),[L,G,z,C.field,C.operator,C.valueSource]),at=he(()=>re.map(K=>({name:K,value:K,label:K})),[re]),Ke=he(()=>oe[t??""]??(typeof L.validator=="function"?L.validator(C):null),[L,t,C,oe]),Z=he(()=>to(Ke),[Ke]),ee=he(()=>L?.className??"",[L?.className]),be=he(()=>S?.className??"",[S?.className]),it=qe(ae(C,{fieldData:L}),ee,be,w.rule,d.rule,{[w.disabled]:E,[w.dndDragging]:g,[w.dndOver]:m},Z);return{...e,classNames:ue,cloneRule:Pe,disabled:E,dndRef:V,dragMonitorId:N,dragRef:F,dropMonitorId:k,fieldData:L,generateOnChangeHandler:we,hideValueControls:ne,inputType:X,operators:$,outerClassName:it,removeRule:Ie,rule:C,shiftRuleUp:Ce,shiftRuleDown:ke,toggleLockRule:Be,validationResult:Ke,valueEditorSeparator:xe,valueEditorType:je,values:st,valueSourceOptions:at,valueSources:re}};import{clsx as Ee}from"clsx";import{useCallback as Me,useMemo as We}from"react";var Fn=e=>{let{id:t,path:o,ruleGroup:n,schema:{qbId:r,accessibleDescriptionGenerator:l,classNames:s,combinators:a,createRule:i,createRuleGroup:u,disabledPaths:c,independentCombinators:p,validationMap:y,enableDragAndDrop:f,getRuleGroupClassname:h},actions:{onGroupAdd:b,onGroupRemove:N,onPropChange:k,onRuleAdd:V,moveRule:F},disabled:g,parentDisabled:m,shiftUpDisabled:d,shiftDownDisabled:G,combinator:x,rules:O,not:R,dragMonitorId:T="",dropMonitorId:v="",previewRef:B=null,dragRef:z=null,dropRef:oe=null,isDragging:j=!1,isOver:ae=!1}=e;mt("ruleGroup",!n),io(f,!!(T||v||B||z||oe));let E=!!m||!!g,C=We(()=>n&&J(n)?n.combinator:n?de(a):x??de(a),[x,a,n]),ue=We(()=>n?{...n,...p?{}:{combinator:C}}:{rules:O,not:R},[C,p,R,n,O]),we=We(()=>({header:Ee(w.header,s.header,{[w.dndOver]:ae}),shiftActions:Ee(w.shiftActions,s.shiftActions),dragHandle:Ee(w.dragHandle,s.dragHandle),combinators:Ee(w.combinators,s.valueSelector,s.combinators),notToggle:Ee(w.notToggle,s.notToggle),addRule:Ee(w.addRule,s.actionElement,s.addRule),addGroup:Ee(w.addGroup,s.actionElement,s.addGroup),cloneGroup:Ee(w.cloneGroup,s.actionElement,s.cloneGroup),lockGroup:Ee(w.lockGroup,s.actionElement,s.lockGroup),removeGroup:Ee(w.removeGroup,s.actionElement,s.removeGroup),body:Ee(w.body,s.body)}),[s.actionElement,s.addGroup,s.addRule,s.body,s.cloneGroup,s.combinators,s.dragHandle,s.header,s.lockGroup,s.notToggle,s.removeGroup,s.shiftActions,s.valueSelector,ae]),Pe=Me((Z,ee)=>{E||k("combinator",Z,o)},[E,k,o]),Be=Me((Z,ee,be)=>{E||k("combinator",Z,o.concat([ee]))},[E,k,o]),Ie=Me((Z,ee)=>{E||k("not",Z,o)},[E,k,o]),Ce=Me((Z,ee)=>{if(!E){let be=i();V(be,o,ee)}},[i,E,V,o]),ke=Me((Z,ee)=>{if(!E){let be=u(p);b(be,o,ee)}},[u,E,p,b,o]),L=Me((Z,ee)=>{if(!E){let be=[...se(o),o[o.length-1]+1];F(o,be,!0)}},[E,F,o]),X=Me((Z,ee)=>{!E&&!d&&F(o,"up",Z?.altKey)},[E,F,o,d]),$=Me((Z,ee)=>{!E&&!G&&F(o,"down",Z?.altKey)},[E,F,o,G]),S=Me((Z,ee)=>{k("disabled",!E,o)},[E,k,o]),P=Me((Z,ee)=>{E||N(o)},[E,N,o]),ne=We(()=>y[t??""],[t,y]),re=We(()=>to(ne),[ne]),je=We(()=>p?null:ve(a,C)?.className??"",[C,a,p]),xe=We(()=>h(ue),[h,ue]),st=We(()=>Ee(xe,je,w.ruleGroup,s.ruleGroup,{[w.disabled]:E,[w.dndDragging]:j},re),[s.ruleGroup,je,E,xe,j,re]),at=We(()=>{let Z=[];for(let ee=0;ee<ue.rules.length;ee++){let be=[...o,ee];Z[ee]={path:be,disabled:E||c.some(it=>Le(be,it))}}return Z},[E,o,ue.rules.length,c]),Ke=We(()=>l({path:o,qbId:r}),[l,o,r]);return{...e,addGroup:ke,addRule:Ce,accessibleDescription:Ke,classNames:we,cloneGroup:L,combinator:C,disabled:E,dragMonitorId:T,dragRef:z,dropMonitorId:v,dropRef:oe,isDragging:j,isOver:ae,onCombinatorChange:Pe,onGroupAdd:b,onIndependentCombinatorChange:Be,onNotToggleChange:Ie,outerClassName:st,parentDisabled:m,pathsMemo:at,previewRef:B,removeGroup:P,ruleGroup:ue,shiftGroupUp:X,shiftGroupDown:$,toggleLockGroup:S,validationClassName:re,validationResult:ne}};import{useMemo as Wr}from"react";var Dn=e=>{let{multiple:t,onChange:o}=e;return Wr(()=>t?r=>o(Array.from(r.target.selectedOptions).map(l=>l.value)):r=>o(r.target.value),[t,o])};import{useCallback as jr}from"react";var ge=e=>jr((t,o)=>{t?.preventDefault(),t?.stopPropagation(),e(t,o)},[e]);import{produce as Ur}from"immer";import{useCallback as _r,useEffect as Hr,useMemo as Jr}from"react";var wn=e=>{let{handleOnChange:t,inputType:o,operator:n,value:r,listsAsArrays:l,parseNumbers:s,values:a,type:i,skipHook:u}=e;Hr(()=>{!u&&i!=="multiselect"&&!["between","notBetween","in","notIn"].includes(n)&&(Array.isArray(r)||o==="number"&&typeof r=="string"&&r.includes(","))&&t(M(r)[0]??"")},[t,o,n,u,i,r]);let c=Jr(()=>M(r),[r]),p=_r((y,f)=>{let h=Ur(c,b=>{b[f]=H(y,{parseNumbers:s}),f===0&&(n==="between"||n==="notBetween")&&(b.length<2||typeof b[1]>"u")&&(b[1]=de(a))});t(l?h:ft(h,","))},[t,l,n,s,c,a]);return{valueAsArray:c,multiValueHandler:p}};import{useCallback as zr,useMemo as Kr}from"react";var Bn=e=>{let{handleOnChange:t,listsAsArrays:o=!1,multiple:n=!1,value:r}=e,l=zr(a=>{if(n){let i=M(a);t(o?i:ft(i,","))}else t(a)},[t,o,n]),s=Kr(()=>n?M(r):r,[n,r]);return{onChange:l,val:s}};import{createContext as Xr}from"react";var nt=Xr({});var Zr=[],el=e=>lt.createElement(Yr,{context:pt,store:jo},e.children),tl=e=>{let{setup:t,props:o}=e,n=Sn(o,t),r=n.schema.controls.ruleGroup;return lt.createElement(nt.Provider,{key:n.dndEnabledAttr,value:n.rqbContext},lt.createElement("div",{role:"form",className:n.wrapperClassName,"data-dnd":n.dndEnabledAttr,"data-inlinecombinators":n.inlineCombinatorsAttr},lt.createElement(r,{translations:n.translations,ruleGroup:n.rootGroup,rules:n.rootGroup.rules,...n.combinatorPropObject,not:!!n.rootGroup.not,schema:n.schema,actions:n.actions,id:n.rootGroup.id,path:Zr,disabled:n.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:n.queryDisabled,context:n.context})))},ol=e=>{let t=En(e);return lt.createElement(el,null,lt.createElement(tl,{props:e,setup:t}))};import*as te from"react";var In=te.memo(e=>{let t=Pn(e),o=ge(t.cloneRule),n=ge(t.toggleLockRule),r=ge(t.removeRule),l=ge(t.shiftRuleUp),s=ge(t.shiftRuleDown);return te.createElement("div",{ref:t.dndRef,"data-testid":Q.rule,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,className:t.outerClassName,"data-rule-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},te.createElement(nl,{...t,cloneRule:o,toggleLockRule:n,removeRule:r,shiftRuleUp:l,shiftRuleDown:s}))}),nl=te.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,fieldSelector:n,operatorSelector:r,valueSourceSelector:l,valueEditor:s,cloneRuleAction:a,lockRuleAction:i,removeRuleAction:u}},combinator:c}=e;return te.createElement(te.Fragment,null,e.schema.showShiftActions&&te.createElement(t,{testID:Q.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftRuleUp,shiftDown:e.shiftRuleDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),e.schema.enableDragAndDrop&&te.createElement(o,{testID:Q.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),c,te.createElement(n,{testID:Q.fields,options:e.schema.fields,title:e.translations.fields.title,value:e.rule.field,operator:e.rule.operator,className:e.classNames.fields,handleOnChange:e.generateOnChangeHandler("field"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectField||e.rule.field!==e.translations.fields.placeholderName)&&te.createElement(te.Fragment,null,te.createElement(r,{testID:Q.operators,field:e.rule.field,fieldData:e.fieldData,title:e.translations.operators.title,options:e.operators,value:e.rule.operator,className:e.classNames.operators,handleOnChange:e.generateOnChangeHandler("operator"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectOperator||e.rule.operator!==e.translations.operators.placeholderName)&&!e.hideValueControls&&te.createElement(te.Fragment,null,!["null","notNull"].includes(e.rule.operator)&&e.valueSources.length>1&&te.createElement(l,{testID:Q.valueSourceSelector,field:e.rule.field,fieldData:e.fieldData,title:e.translations.valueSourceSelector.title,options:e.valueSourceOptions,value:e.rule.valueSource??"value",className:e.classNames.valueSource,handleOnChange:e.generateOnChangeHandler("valueSource"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),te.createElement(s,{testID:Q.valueEditor,field:e.rule.field,fieldData:e.fieldData,title:e.translations.value.title,operator:e.rule.operator,value:e.rule.value,valueSource:e.rule.valueSource??"value",type:e.valueEditorType,inputType:e.inputType,values:e.values,listsAsArrays:e.schema.listsAsArrays,parseNumbers:e.schema.parseNumbers,separator:e.valueEditorSeparator,className:e.classNames.value,handleOnChange:e.generateOnChangeHandler("value"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}))),e.schema.showCloneButtons&&te.createElement(a,{testID:Q.cloneRule,label:e.translations.cloneRule.label,title:e.translations.cloneRule.title,className:e.classNames.cloneRule,handleOnClick:e.cloneRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),e.schema.showLockButtons&&te.createElement(i,{testID:Q.lockRule,label:e.translations.lockRule.label,title:e.translations.lockRule.title,className:e.classNames.lockRule,handleOnClick:e.toggleLockRule,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockRuleDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),te.createElement(u,{testID:Q.removeRule,label:e.translations.removeRule.label,title:e.translations.removeRule.title,className:e.classNames.removeRule,handleOnClick:e.removeRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}))});import*as W from"react";import{Fragment as rl}from"react";var kn=W.memo(e=>{let t=Fn(e),o=ge(t.addRule),n=ge(t.addGroup),r=ge(t.cloneGroup),l=ge(t.toggleLockGroup),s=ge(t.removeGroup),a=ge(t.shiftGroupUp),i=ge(t.shiftGroupDown);return W.createElement("div",{ref:t.previewRef,title:t.accessibleDescription,className:t.outerClassName,"data-testid":Q.ruleGroup,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,"data-rule-group-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},W.createElement("div",{ref:t.dropRef,className:t.classNames.header},W.createElement(ll,{...t,addRule:o,addGroup:n,cloneGroup:r,toggleLockGroup:l,removeGroup:s,shiftGroupUp:a,shiftGroupDown:i})),W.createElement("div",{className:t.classNames.body},W.createElement(sl,{...t,addRule:o,addGroup:n,cloneGroup:r,toggleLockGroup:l,removeGroup:s,shiftGroupUp:a,shiftGroupDown:i})))}),ll=W.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,combinatorSelector:n,notToggle:r,addRuleAction:l,addGroupAction:s,cloneGroupAction:a,lockGroupAction:i,removeGroupAction:u}}}=e;return W.createElement(W.Fragment,null,e.schema.showShiftActions&&e.path.length>0&&W.createElement(t,{key:Q.shiftActions,testID:Q.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftGroupUp,shiftDown:e.shiftGroupDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&e.schema.enableDragAndDrop&&W.createElement(o,{key:Q.dragHandle,testID:Q.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&W.createElement("span",{className:"statement"},"Any of the following are true..."),!e.schema.showCombinatorsBetweenRules&&!e.schema.independentCombinators&&W.createElement(n,{key:Q.combinators,testID:Q.combinators,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema}),e.schema.showNotToggle&&W.createElement(r,{key:Q.notToggle,testID:Q.notToggle,className:e.classNames.notToggle,title:e.translations.notToggle.title,label:e.translations.notToggle.label,checked:e.ruleGroup.not,handleOnChange:e.onNotToggleChange,level:e.path.length,disabled:e.disabled,path:e.path,context:e.context,validation:e.validationResult,schema:e.schema,ruleGroup:e.ruleGroup}),W.createElement(l,{key:Q.addRule,testID:Q.addRule,label:e.translations.addRule.label,title:e.translations.addRule.title,className:e.classNames.addRule,handleOnClick:e.addRule,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),W.createElement(s,{key:Q.addGroup,testID:Q.addGroup,label:e.translations.addGroup.label,title:e.translations.addGroup.title,className:e.classNames.addGroup,handleOnClick:e.addGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showCloneButtons&&e.path.length>=1&&W.createElement(a,{key:Q.cloneGroup,testID:Q.cloneGroup,label:e.translations.cloneRuleGroup.label,title:e.translations.cloneRuleGroup.title,className:e.classNames.cloneGroup,handleOnClick:e.cloneGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showLockButtons&&W.createElement(i,{key:Q.lockGroup,testID:Q.lockGroup,label:e.translations.lockGroup.label,title:e.translations.lockGroup.title,className:e.classNames.lockGroup,handleOnClick:e.toggleLockGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockGroupDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.path.length>0&&W.createElement(u,{key:Q.removeGroup,testID:Q.removeGroup,label:e.translations.removeGroup.label,title:e.translations.removeGroup.title,className:e.classNames.removeGroup,handleOnClick:e.removeGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}))}),sl=W.memo(e=>{let{schema:{controls:{combinatorSelector:t,inlineCombinator:o,ruleGroup:n,rule:r}}}=e;return W.createElement(W.Fragment,null,e.ruleGroup.rules.map((l,s,{length:a})=>{let i=e.pathsMemo[s],u=i.path,c=i.disabled||typeof l!="string"&&l.disabled,p=Le([0],u),y=e.path.length===0&&s===a-1,f=typeof l=="string"?[...u,l].join("-"):l.id,h=!e.schema.independentCombinators&&e.schema.showCombinatorsBetweenRules;return W.createElement(rl,{key:f},typeof l=="string"?W.createElement(o,{key:`${Q.inlineCombinator}-independent`,options:e.schema.combinators,value:l,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:b=>e.onIndependentCombinatorChange(b,s),rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:u,disabled:c,schema:e.schema}):D(l)?W.createElement(n,{key:Q.ruleGroup,id:l.id,schema:e.schema,actions:e.actions,path:u,translations:e.translations,ruleGroup:l,rules:l.rules,combinator:J(l)?l.combinator:void 0,not:!!l.not,disabled:c,parentDisabled:e.parentDisabled||e.disabled,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context}):W.createElement(r,{key:Q.rule,id:l.id,rule:l,field:l.field,operator:l.operator,value:l.value,valueSource:l.valueSource,schema:e.schema,actions:e.actions,path:u,disabled:c,parentDisabled:e.parentDisabled||e.disabled,translations:e.translations,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context,combinator:s===1&&h?W.createElement(o,{key:Q.inlineCombinator,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:u,disabled:e.disabled,schema:e.schema}):s>1&&h?W.createElement("span",{className:e.classNames.combinators},e.combinator):e.path.length===0&&h?W.createElement("span",{className:e.classNames.combinators},"Where"):W.createElement("span",{className:e.classNames.combinators})}))}))});import*as uo from"react";var Qn=e=>uo.createElement("div",{"data-testid":e.testID,className:e.className},uo.createElement("button",{disabled:e.disabled||e.shiftUpDisabled,onClick:e.shiftUp,title:e.titles?.shiftUp},e.labels?.shiftUp),uo.createElement("button",{disabled:e.disabled||e.shiftDownDisabled,onClick:e.shiftDown,title:e.titles?.shiftDown},e.labels?.shiftDown));import*as De from"react";var Vn=e=>{let{operator:t,value:o,handleOnChange:n,title:r,className:l,type:s="text",inputType:a="text",values:i=[],listsAsArrays:u,parseNumbers:c,fieldData:p,disabled:y,separator:f=null,testID:h,selectorComponent:b=e.schema.controls.valueSelector,...N}=e,{valueAsArray:k,multiValueHandler:V}=wn(e);if(t==="null"||t==="notNull")return null;let F=p?.placeholder??"",g=["in","notIn"].includes(t)?"text":a||"text";if((t==="between"||t==="notBetween")&&(s==="select"||s==="text")){let m=["from","to"].map((d,G)=>s==="text"?De.createElement("input",{key:d,type:g,placeholder:F,value:k[G]??"",className:w.valueListItem,disabled:y,onChange:x=>V(x.target.value,G)}):De.createElement(b,{...N,schema:e.schema,key:d,className:w.valueListItem,handleOnChange:x=>V(x,G),disabled:y,value:k[G]??de(i),options:i,listsAsArrays:u}));return De.createElement("span",{"data-testid":h,className:l,title:r},m[0],f,m[1])}switch(s){case"select":case"multiselect":return De.createElement(b,{...N,schema:e.schema,testID:h,className:l,title:r,handleOnChange:n,disabled:y,value:o,options:i,multiple:s==="multiselect",listsAsArrays:u});case"textarea":return De.createElement("textarea",{"data-testid":h,placeholder:F,value:o,title:r,className:l,disabled:y,onChange:m=>n(m.target.value)});case"switch":case"checkbox":return De.createElement("input",{"data-testid":h,type:"checkbox",className:l,title:r,onChange:m=>n(m.target.checked),checked:!!o,disabled:y});case"radio":return De.createElement("span",{"data-testid":h,className:l,title:r},i.map(m=>De.createElement("label",{key:m.name},De.createElement("input",{type:"radio",value:m.name,disabled:y,checked:o===m.name,onChange:d=>n(d.target.value)}),m.label)))}return De.createElement("input",{"data-testid":h,type:g,placeholder:F,value:o,title:r,className:l,disabled:y,onChange:m=>n(H(m.target.value,{parseNumbers:c}))})};import*as Ln from"react";var At=e=>{let{onChange:t,val:o}=Bn(e),n=Dn({multiple:e.multiple,onChange:t});return Ln.createElement("select",{"data-testid":e.testID,className:e.className,value:o,title:e.title,disabled:e.disabled,multiple:!!e.multiple,onChange:n},xn(e.options))};var Cn={actionElement:Qe,addGroupAction:Qe,addRuleAction:Qe,cloneGroupAction:Qe,cloneRuleAction:Qe,combinatorSelector:At,dragHandle:Io,fieldSelector:At,inlineCombinator:qo,lockGroupAction:Qe,lockRuleAction:Qe,notToggle:Mo,operatorSelector:At,removeGroupAction:Qe,removeRuleAction:Qe,rule:In,ruleGroup:kn,shiftActions:Qn,valueEditor:Vn,valueSelector:At,valueSourceSelector:At};export{Qe as ActionElement,Io as DragHandle,qo as InlineCombinator,Re as LogType,Mo as NotToggle,ol as QueryBuilder,nt as QueryBuilderContext,pt as QueryBuilderStateContext,el as QueryBuilderStateProvider,In as Rule,nl as RuleComponents,kn as RuleGroup,sl as RuleGroupBodyComponents,ll as RuleGroupHeaderComponents,Qn as ShiftActions,Q as TestID,Vn as ValueEditor,At as ValueSelector,Co as add,yt as convertFromIC,es as convertQuery,Yo as convertToIC,ol as default,Ia as defaultCELValueProcessor,Ue as defaultCombinators,pl as defaultCombinatorsExtended,Lo as defaultControlClassnames,Cn as defaultControlElements,kt as defaultJoinChar,Ba as defaultMongoDBValueProcessor,cl as defaultOperatorNegationMap,Vo as defaultOperators,Xn as defaultPlaceholderFieldGroupLabel,Kn as defaultPlaceholderFieldLabel,Bt as defaultPlaceholderFieldName,Zn as defaultPlaceholderOperatorGroupLabel,Yn as defaultPlaceholderOperatorLabel,It as defaultPlaceholderOperatorName,ht as defaultRuleProcessorCEL,Ht as defaultRuleProcessorElasticSearch,zt as defaultRuleProcessorJSONata,Kt as defaultRuleProcessorJsonLogic,bt as defaultRuleProcessorMongoDB,Pt as defaultRuleProcessorParameterized,Oo as defaultRuleProcessorSQL,Rt as defaultRuleProcessorSpEL,ka as defaultSpELValueProcessor,Qo as defaultTranslations,rs as defaultValidator,wa as defaultValueProcessor,Je as defaultValueProcessorByRule,Qa as defaultValueProcessorCELByRule,Va as defaultValueProcessorMongoDBByRule,La as defaultValueProcessorSpELByRule,Mt as filterFieldsByComparator,fe as findPath,Sa as formatQuery,cn as generateAccessibleDescription,ye as generateID,un as getCommonAncestorPath,mi as getCompatContextProvider,de as getFirstOption,ve as getOption,se as getParentPath,Ze as getQuerySelectorById,to as getValidationClassNames,mn as getValueSourcesUtil,Qt as groupInvalidReasons,Xa as isAncestor,Te as isFlexibleOptionGroupArray,hs as isFullOptionGroupArray,qt as isOptionGroupArray,le as isPojo,D as isRuleGroup,J as isRuleGroupType,Xe as isRuleGroupTypeIC,pe as isRuleOrGroupValid,an as isValidationResult,ft as joinWith,mr as jsonLogicAdditionalOperators,Yt as mergeClassnames,eo as mergeTranslations,_e as messages,gn as move,Hl as nullFreeArray,zo as numericRegex,ri as objectEntries,Zt as objectKeys,H as parseNumber,gt as pathIsDisabled,Le as pathsAreEqual,yn as prepareRule,oo as prepareRuleGroup,hn as prepareRuleOrGroup,jo as queryBuilderStore,no as regenerateID,ro as regenerateIDs,Rn as remove,Zr as rootPath,cr as splitBy,w as standardClassnames,M as toArray,nn as toFlatOptionArray,me as toFullOption,Ve as toFullOptionList,bo as toFullOptionMap,xn as toOptions,Li as transformQuery,_ as trimIfString,et as uniqByIdentifier,ds as uniqByName,Lt as uniqOptGroups,on as uniqOptList,bn as update,Jo as useControlledOrUncontrolled,mt as useDeprecatedProps,vn as useMergedContext,hu as usePreferAnyProp,ao as usePreferProp,Ho as usePrevious,Sn as useQueryBuilderSchema,Uo as useQueryBuilderSelector,En as useQueryBuilderSetup,io as useReactDndWarning,Pn as useRule,Fn as useRuleGroup,Dn as useSelectElementChangeHandler,ge as useStopEventPropagation,wn as useValueEditor,Bn as useValueSelector};
//# sourceMappingURL=react-querybuilder.production.mjs.map